(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("crystal",function(f){function A(C,B){return new RegExp((B?"":"^")+"(?:"+C.join("|")+")"+(B?"$":"\\b"))}function d(D,C,B){B.tokenize.push(D);return D(C,B)}var r=/^(?:[-+/%|&^]|\*\*?|[<>]{2})/;var e=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/;var n=/^(?:\[\][?=]?)/;var b=/^(?:\.(?:\.{2})?|->|[?:])/;var k=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var z=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var o=A(["abstract","alias","as","asm","begin","break","case","class","def","do","else","elsif","end","ensure","enum","extend","for","fun","if","ifdef","include","instance_sizeof","lib","macro","module","next","of","out","pointerof","private","protected","rescue","return","require","sizeof","struct","super","then","type","typeof","union","unless","until","when","while","with","yield","__DIR__","__FILE__","__LINE__"]);var c=A(["true","false","nil","self"]);var m=["def","fun","macro","class","module","struct","lib","enum","union","if","unless","case","while","until","begin","then","do","for","ifdef"];var l=A(m);var h=["end","else","elsif","rescue","ensure"];var g=A(h);var j=["\\)","\\}","\\]"];var i=new RegExp("^(?:"+j.join("|")+")$");var q={def:t,fun:t,macro:w,"class":u,module:u,struct:u,lib:u,"enum":u,union:u};var p={"[":"]","{":"}","(":")","<":">"};function s(F,E){if(F.eatSpace()){return null}if(E.lastToken!="\\"&&F.match("{%",false)){return d(v("%","%"),F,E)}if(E.lastToken!="\\"&&F.match("{{",false)){return d(v("{","}"),F,E)}if(F.peek()=="#"){F.skipToEnd();return"comment"}var D;if(F.match(k)){F.eat(/[?!]/);D=F.current();if(F.eat(":")){return"atom"}else{if(E.lastToken=="."){return"property"}else{if(o.test(D)){if(E.lastToken!="abstract"&&l.test(D)){if(!(D=="fun"&&E.blocks.indexOf("lib")>=0)){E.blocks.push(D);E.currentIndent+=1}}else{if(g.test(D)){E.blocks.pop();E.currentIndent-=1}}if(q.hasOwnProperty(D)){E.tokenize.push(q[D])}return"keyword"}else{if(c.test(D)){return"atom"}}}}return"variable"}if(F.eat("@")){if(F.peek()=="["){return d(x("[","]","meta"),F,E)}F.eat("@");F.match(k)||F.match(z);return"variable-2"}if(F.eat("$")){F.eat(/[0-9]+|\?/)||F.match(k)||F.match(z);return"variable-3"}if(F.match(z)){return"tag"}if(F.eat(":")){if(F.eat('"')){return d(y('"',"atom",false),F,E)}else{if(F.match(k)||F.match(z)||F.match(r)||F.match(e)||F.match(n)){return"atom"}}F.eat(":");return"operator"}if(F.eat('"')){return d(y('"',"string",true),F,E)}if(F.peek()=="%"){var G="string";var C=true;var B;if(F.match("%r")){G="string-2";B=F.next()}else{if(F.match("%w")){C=false;B=F.next()}else{if(B=F.match(/^%([^\w\s=])/)){B=B[1]}else{if(F.match(/^%[a-zA-Z0-9_\u009F-\uFFFF]*/)){return"meta"}else{return"operator"}}}}if(p.hasOwnProperty(B)){B=p[B]}return d(y(B,G,C),F,E)}if(F.eat("'")){F.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/);F.eat("'");return"atom"}if(F.eat("0")){if(F.eat("x")){F.match(/^[0-9a-fA-F]+/)}else{if(F.eat("o")){F.match(/^[0-7]+/)}else{if(F.eat("b")){F.match(/^[01]+/)}}}return"number"}if(F.eat(/\d/)){F.match(/^\d*(?:\.\d+)?(?:[eE][+-]?\d+)?/);return"number"}if(F.match(r)){F.eat("=");return"operator"}if(F.match(e)||F.match(b)){return"operator"}if(D=F.match(/[({[]/,false)){D=D[0];return d(x(D,p[D],null),F,E)}if(F.eat("\\")){F.next();return"meta"}F.next();return null}function x(B,C,E,D){return function(H,G){if(!D&&H.match(B)){G.tokenize[G.tokenize.length-1]=x(B,C,E,true);G.currentIndent+=1;return E}var F=s(H,G);if(H.current()===C){G.tokenize.pop();G.currentIndent-=1;F=E}return F}}function v(B,C,D){return function(F,E){if(!D&&F.match("{"+B)){E.currentIndent+=1;E.tokenize[E.tokenize.length-1]=v(B,C,true);return"meta"}if(F.match(C+"}")){E.currentIndent-=1;E.tokenize.pop();return"meta"}return s(F,E)}}function w(D,C){if(D.eatSpace()){return null}var B;if(B=D.match(k)){if(B=="def"){return"keyword"}D.eat(/[?!]/)}C.tokenize.pop();return"def"}function t(C,B){if(C.eatSpace()){return null}if(C.match(k)){C.eat(/[!?]/)}else{C.match(r)||C.match(e)||C.match(n)}B.tokenize.pop();return"def"}function u(C,B){if(C.eatSpace()){return null}C.match(z);B.tokenize.pop();return"def"}function y(C,D,B){return function(H,G){var F=false;while(H.peek()){if(!F){if(H.match("{%",false)){G.tokenize.push(v("%","%"));return D}if(H.match("{{",false)){G.tokenize.push(v("{","}"));return D}if(B&&H.match("#{",false)){G.tokenize.push(x("#{","}","meta"));return D}var E=H.next();if(E==C){G.tokenize.pop();return D}F=E=="\\"}else{H.next();F=false}}return D}}return{startState:function(){return{tokenize:[s],currentIndent:0,lastToken:null,blocks:[]}},token:function(C,B){var D=B.tokenize[B.tokenize.length-1](C,B);var E=C.current();if(D&&D!="comment"){B.lastToken=E}return D},indent:function(B,C){C=C.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,"");if(g.test(C)||i.test(C)){return f.indentUnit*(B.currentIndent-1)}return f.indentUnit*B.currentIndent},fold:"indent",electricInput:A(j.concat(h),true),lineComment:"#"}});a.defineMIME("text/x-crystal","crystal")});