(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("ruby",function(c){function o(s){var r={};for(var q=0,p=s.length;q<p;++q){r[s[q]]=true}return r}var g=o(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"]);var f=o(["def","class","case","for","while","until","module","then","catch","loop","proc","begin"]);var e=o(["end","until"]);var h={"[":"]","{":"}","(":")"};var d;function b(p,r,q){q.tokenize.push(p);return p(r,q)}function l(z,y){if(z.sol()&&z.match("=begin")&&z.eol()){y.tokenize.push(i);return"comment"}if(z.eatSpace()){return null}var q=z.next(),v;if(q=="`"||q=="'"||q=='"'){return b(k(q,"string",q=='"'||q=="`"),z,y)}else{if(q=="/"){var s=z.current().length;if(z.skipTo("/")){var x=z.current().length;z.backUp(z.current().length-s);var p=0;while(z.current().length<x){var r=z.next();if(r=="("){p+=1}else{if(r==")"){p-=1}}if(p<0){break}}z.backUp(z.current().length-s);if(p==0){return b(k(q,"string-2",true),z,y)}}return"operator"}else{if(q=="%"){var A="string",u=true;if(z.eat("s")){A="atom"}else{if(z.eat(/[WQ]/)){A="string"}else{if(z.eat(/[r]/)){A="string-2"}else{if(z.eat(/[wxq]/)){A="string";u=false}}}}var t=z.eat(/[^\w\s=]/);if(!t){return"operator"}if(h.propertyIsEnumerable(t)){t=h[t]}return b(k(t,A,u,true),z,y)}else{if(q=="#"){z.skipToEnd();return"comment"}else{if(q=="<"&&(v=z.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/))){return b(j(v[1]),z,y)}else{if(q=="0"){if(z.eat("x")){z.eatWhile(/[\da-fA-F]/)}else{if(z.eat("b")){z.eatWhile(/[01]/)}else{z.eatWhile(/[0-7]/)}}return"number"}else{if(/\d/.test(q)){z.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/);return"number"}else{if(q=="?"){while(z.match(/^\\[CM]-/)){}if(z.eat("\\")){z.eatWhile(/\w/)}else{z.next()}return"string"}else{if(q==":"){if(z.eat("'")){return b(k("'","atom",false),z,y)}if(z.eat('"')){return b(k('"',"atom",true),z,y)}if(z.eat(/[\<\>]/)){z.eat(/[\<\>]/);return"atom"}if(z.eat(/[\+\-\*\/\&\|\:\!]/)){return"atom"}if(z.eat(/[a-zA-Z$@_\xa1-\uffff]/)){z.eatWhile(/[\w$\xa1-\uffff]/);z.eat(/[\?\!\=]/);return"atom"}return"operator"}else{if(q=="@"&&z.match(/^@?[a-zA-Z_\xa1-\uffff]/)){z.eat("@");z.eatWhile(/[\w\xa1-\uffff]/);return"variable-2"}else{if(q=="$"){if(z.eat(/[a-zA-Z_]/)){z.eatWhile(/[\w]/)}else{if(z.eat(/\d/)){z.eat(/\d/)}else{z.next()}}return"variable-3"}else{if(/[a-zA-Z_\xa1-\uffff]/.test(q)){z.eatWhile(/[\w\xa1-\uffff]/);z.eat(/[\?\!]/);if(z.eat(":")){return"atom"}return"ident"}else{if(q=="|"&&(y.varList||y.lastTok=="{"||y.lastTok=="do")){d="|";return null}else{if(/[\(\)\[\]{}\\;]/.test(q)){d=q;return null}else{if(q=="-"&&z.eat(">")){return"arrow"}else{if(/[=+\-\/*:\.^%<>~|]/.test(q)){var w=z.eatWhile(/[=+\-\/*:\.^%<>~|]/);if(q=="."&&!w){d="."}return"operator"}else{return null}}}}}}}}}}}}}}}}}function n(p){if(!p){p=1}return function(r,q){if(r.peek()=="}"){if(p==1){q.tokenize.pop();return q.tokenize[q.tokenize.length-1](r,q)}else{q.tokenize[q.tokenize.length-1]=n(p-1)}}else{if(r.peek()=="{"){q.tokenize[q.tokenize.length-1]=n(p+1)}}return l(r,q)}}function m(){var p=false;return function(r,q){if(p){q.tokenize.pop();return q.tokenize[q.tokenize.length-1](r,q)}p=true;return l(r,q)}}function k(q,r,p,s){return function(w,v){var u=false,t;if(v.context.type==="read-quoted-paused"){v.context=v.context.prev;w.eat("}")}while((t=w.next())!=null){if(t==q&&(s||!u)){v.tokenize.pop();break}if(p&&t=="#"&&!u){if(w.eat("{")){if(q=="}"){v.context={prev:v.context,type:"read-quoted-paused"}}v.tokenize.push(n());break}else{if(/[@\$]/.test(w.peek())){v.tokenize.push(m());break}}}u=!u&&t=="\\"}return r}}function j(p){return function(r,q){if(r.match(p)){q.tokenize.pop()}else{r.skipToEnd()}return"string"}}function i(q,p){if(q.sol()&&q.match("=end")&&q.eol()){p.tokenize.pop()}q.skipToEnd();return"comment"}return{startState:function(){return{tokenize:[l],indented:0,context:{type:"top",indented:-c.indentUnit},continuedLine:false,lastTok:null,varList:false}},token:function(r,q){d=null;if(r.sol()){q.indented=r.indentation()}var s=q.tokenize[q.tokenize.length-1](r,q),p;var t=d;if(s=="ident"){var u=r.current();s=q.lastTok=="."?"property":g.propertyIsEnumerable(r.current())?"keyword":/^[A-Z]/.test(u)?"tag":(q.lastTok=="def"||q.lastTok=="class"||q.varList)?"def":"variable";if(s=="keyword"){t=u;if(f.propertyIsEnumerable(u)){p="indent"}else{if(e.propertyIsEnumerable(u)){p="dedent"}else{if((u=="if"||u=="unless")&&r.column()==r.indentation()){p="indent"}else{if(u=="do"&&q.context.indented<q.indented){p="indent"}}}}}}if(d||(s&&s!="comment")){q.lastTok=t}if(d=="|"){q.varList=!q.varList}if(p=="indent"||/[\(\[\{]/.test(d)){q.context={prev:q.context,type:d||s,indented:q.indented}}else{if((p=="dedent"||/[\)\]\}]/.test(d))&&q.context.prev){q.context=q.context.prev}}if(r.eol()){q.continuedLine=(d=="\\"||s=="operator")}return s},indent:function(s,t){if(s.tokenize[s.tokenize.length-1]!=l){return 0}var r=t&&t.charAt(0);var q=s.context;var p=q.type==h[r]||q.type=="keyword"&&/^(?:end|until|else|elsif|when|rescue)\b/.test(t);return q.indented+(p?0:c.indentUnit)+(s.continuedLine?c.indentUnit:0)},electricInput:/^\s*(?:end|rescue|\})$/,lineComment:"#"}});a.defineMIME("text/x-ruby","ruby")});