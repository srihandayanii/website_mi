(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed"],a)}else{a(CodeMirror)}}})(function(a){var b=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];a.defineMode("soy",function(c){var f=a.getMode(c,"text/plain");var e={html:a.getMode(c,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:false}),attributes:f,text:f,uri:f,css:a.getMode(c,"text/css"),js:a.getMode(c,{name:"text/javascript",statementIndent:2*c.indentUnit})};function d(h){return h[h.length-1]}function g(l,k,m){var i=l.string;var h=m.exec(i.substr(l.pos));if(h){l.string=i.substr(0,l.pos+h.index)}var j=l.hideFirstChars(k.indent,function(){return k.localMode.token(l,k.localState)});l.string=i;return j}return{startState:function(){return{kind:[],kindTag:[],soyState:[],indent:0,localMode:e.html,localState:a.startState(e.html)}},copyState:function(h){return{tag:h.tag,kind:h.kind.concat([]),kindTag:h.kindTag.concat([]),soyState:h.soyState.concat([]),indent:h.indent,localMode:h.localMode,localState:a.copyState(h.localMode,h.localState)}},token:function(k,j){var i;switch(d(j.soyState)){case"comment":if(k.match(/^.*?\*\//)){j.soyState.pop()}else{k.skipToEnd()}return"comment";case"variable":if(k.match(/^}/)){j.indent-=2*c.indentUnit;j.soyState.pop();return"variable-2"}k.next();return null;case"tag":if(k.match(/^\/?}/)){if(j.tag=="/template"||j.tag=="/deltemplate"){j.indent=0}else{j.indent-=(k.current()=="/}"||b.indexOf(j.tag)==-1?2:1)*c.indentUnit}j.soyState.pop();return"keyword"}else{if(k.match(/^([\w?]+)(?==)/)){if(k.current()=="kind"&&(i=k.match(/^="([^"]+)/,false))){var h=i[1];j.kind.push(h);j.kindTag.push(j.tag);j.localMode=e[h]||e.html;j.localState=a.startState(j.localMode)}return"attribute"}else{if(k.match(/^"/)){j.soyState.push("string");return"string"}}}k.next();return null;case"literal":if(k.match(/^(?=\{\/literal})/)){j.indent-=c.indentUnit;j.soyState.pop();return this.token(k,j)}return g(k,j,/\{\/literal}/);case"string":var i=k.match(/^.*?("|\\[\s\S])/);if(!i){k.skipToEnd()}else{if(i[1]=='"'){j.soyState.pop()}}return"string"}if(k.match(/^\/\*/)){j.soyState.push("comment");return"comment"}else{if(k.match(k.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)){return"comment"}else{if(k.match(/^\{\$[\w?]*/)){j.indent+=2*c.indentUnit;j.soyState.push("variable");return"variable-2"}else{if(k.match(/^\{literal}/)){j.indent+=c.indentUnit;j.soyState.push("literal");return"keyword"}else{if(i=k.match(/^\{([\/@\\]?[\w?]*)/)){if(i[1]!="/switch"){j.indent+=(/^(\/|(else|elseif|case|default)$)/.test(i[1])&&j.tag!="switch"?1:2)*c.indentUnit}j.tag=i[1];if(j.tag=="/"+d(j.kindTag)){j.kind.pop();j.kindTag.pop();j.localMode=e[d(j.kind)]||e.html;j.localState=a.startState(j.localMode)}j.soyState.push("tag");return"keyword"}}}}}return g(k,j,/\{|\s+\/\/|\/\*/)},indent:function(i,j){var h=i.indent,k=d(i.soyState);if(k=="comment"){return a.Pass}if(k=="literal"){if(/^\{\/literal}/.test(j)){h-=c.indentUnit}}else{if(/^\s*\{\/(template|deltemplate)\b/.test(j)){return 0}if(/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(j)){h-=c.indentUnit}if(i.tag!="switch"&&/^\{(case|default)\b/.test(j)){h-=c.indentUnit}if(/^\{\/switch\b/.test(j)){h-=c.indentUnit}}if(h&&i.localMode.indent){h+=i.localMode.indent(i.localState,j)}return h},innerMode:function(h){if(h.soyState.length&&d(h.soyState)!="literal"){return null}else{return{state:h.localState,mode:h.localMode}}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed");a.registerHelper("hintWords","soy",b.concat(["delpackage","namespace","alias","print","css","debugger"]));a.defineMIME("text/x-soy","soy")});