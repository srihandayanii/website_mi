(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("haml",function(b){var d=a.getMode(b,{name:"htmlmixed"});var g=a.getMode(b,"ruby");function f(h){return function(k,j){var i=k.peek();if(i==h&&j.rubyState.tokenize.length==1){k.next();j.tokenize=c;return"closeAttributeTag"}else{return e(k,j)}}}function e(i,h){if(i.match("-#")){i.skipToEnd();return"comment"}return g.token(i,h.rubyState)}function c(j,i){var h=j.peek();if(i.previousToken.style=="comment"){if(i.indented>i.previousToken.indented){j.skipToEnd();return"commentLine"}}if(i.startOfLine){if(h=="!"&&j.match("!!")){j.skipToEnd();return"tag"}else{if(j.match(/^%[\w:#\.]+=/)){i.tokenize=e;return"hamlTag"}else{if(j.match(/^%[\w:]+/)){return"hamlTag"}else{if(h=="/"){j.skipToEnd();return"comment"}}}}}if(i.startOfLine||i.previousToken.style=="hamlTag"){if(h=="#"||h=="."){j.match(/[\w-#\.]*/);return"hamlAttribute"}}if(i.startOfLine&&!j.match("-->",false)&&(h=="="||h=="-")){i.tokenize=e;return i.tokenize(j,i)}if(i.previousToken.style=="hamlTag"||i.previousToken.style=="closeAttributeTag"||i.previousToken.style=="hamlAttribute"){if(h=="("){i.tokenize=f(")");return i.tokenize(j,i)}else{if(h=="{"){if(!j.match(/^\{%.*/)){i.tokenize=f("}");return i.tokenize(j,i)}}}}return d.token(j,i.htmlState)}return{startState:function(){var h=a.startState(d);var i=a.startState(g);return{htmlState:h,rubyState:i,indented:0,previousToken:{style:null,indented:0},tokenize:c}},copyState:function(h){return{htmlState:a.copyState(d,h.htmlState),rubyState:a.copyState(g,h.rubyState),indented:h.indented,previousToken:h.previousToken,tokenize:h.tokenize}},token:function(j,i){if(j.sol()){i.indented=j.indentation();i.startOfLine=true}if(j.eatSpace()){return null}var k=i.tokenize(j,i);i.startOfLine=false;if(k&&k!="commentLine"){i.previousToken={style:k,indented:i.indented}}if(j.eol()&&i.tokenize==e){j.backUp(1);var h=j.peek();j.next();if(h&&h!=","){i.tokenize=c}}if(k=="hamlTag"){k="tag"}else{if(k=="commentLine"){k="comment"}else{if(k=="hamlAttribute"){k="attribute"}else{if(k=="closeAttributeTag"){k=null}}}}return k}}},"htmlmixed","ruby");a.defineMIME("text/x-haml","haml")});