(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("velocity",function(){function f(n){var m={},o=n.split(" ");for(var l=0;l<o.length;++l){m[o[l]]=true}return m}var e=f("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}");var c=f("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}");var g=f("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent");var d=/[+\-*&%=<>!?:\/|]/;function b(n,m,l){m.tokenize=l;return l(n,m)}function h(o,n){var l=n.beforeParams;n.beforeParams=false;var m=o.next();if((m=="'")&&!n.inString&&n.inParams){n.lastTokenWasBuiltin=false;return b(o,n,j(m))}else{if((m=='"')){n.lastTokenWasBuiltin=false;if(n.inString){n.inString=false;return"string"}else{if(n.inParams){return b(o,n,j(m))}}}else{if(/[\[\]{}\(\),;\.]/.test(m)){if(m=="("&&l){n.inParams=true}else{if(m==")"){n.inParams=false;n.lastTokenWasBuiltin=true}}return null}else{if(/\d/.test(m)){n.lastTokenWasBuiltin=false;o.eatWhile(/[\w\.]/);return"number"}else{if(m=="#"&&o.eat("*")){n.lastTokenWasBuiltin=false;return b(o,n,i)}else{if(m=="#"&&o.match(/ *\[ *\[/)){n.lastTokenWasBuiltin=false;return b(o,n,k)}else{if(m=="#"&&o.eat("#")){n.lastTokenWasBuiltin=false;o.skipToEnd();return"comment"}else{if(m=="$"){o.eatWhile(/[\w\d\$_\.{}]/);if(g&&g.propertyIsEnumerable(o.current())){return"keyword"}else{n.lastTokenWasBuiltin=true;n.beforeParams=true;return"builtin"}}else{if(d.test(m)){n.lastTokenWasBuiltin=false;o.eatWhile(d);return"operator"}else{o.eatWhile(/[\w\$_{}@]/);var p=o.current();if(e&&e.propertyIsEnumerable(p)){return"keyword"}if(c&&c.propertyIsEnumerable(p)||(o.current().match(/^#@?[a-z0-9_]+ *$/i)&&o.peek()=="(")&&!(c&&c.propertyIsEnumerable(p.toLowerCase()))){n.beforeParams=true;n.lastTokenWasBuiltin=false;return"keyword"}if(n.inString){n.lastTokenWasBuiltin=false;return"string"}if(o.pos>p.length&&o.string.charAt(o.pos-p.length-1)=="."&&n.lastTokenWasBuiltin){return"builtin"}n.lastTokenWasBuiltin=false;return null}}}}}}}}}}function j(l){return function(q,p){var n=false,o,m=false;while((o=q.next())!=null){if((o==l)&&!n){m=true;break}if(l=='"'&&q.peek()=="$"&&!n){p.inString=true;m=true;break}n=!n&&o=="\\"}if(m){p.tokenize=h}return"string"}}function i(o,n){var m=false,l;while(l=o.next()){if(l=="#"&&m){n.tokenize=h;break}m=(l=="*")}return"comment"}function k(o,n){var m=0,l;while(l=o.next()){if(l=="#"&&m==2){n.tokenize=h;break}if(l=="]"){m++}else{if(l!=" "){m=0}}}return"meta"}return{startState:function(){return{tokenize:h,beforeParams:false,inParams:false,inString:false,lastTokenWasBuiltin:false}},token:function(m,l){if(m.eatSpace()){return null}return l.tokenize(m,l)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}});a.defineMIME("text/velocity","velocity")});