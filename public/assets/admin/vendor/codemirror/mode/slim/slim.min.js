(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("slim",function(m){var x=a.getMode(m,{name:"htmlmixed"});var I=a.getMode(m,"ruby");var B={html:x,ruby:I};var q={ruby:"ruby",javascript:"javascript",css:"text/css",sass:"text/x-sass",scss:"text/x-scss",less:"text/x-less",styl:"text/x-styl",coffee:"coffeescript",asciidoc:"text/x-asciidoc",markdown:"text/x-markdown",textile:"text/x-textile",creole:"text/x-creole",wiki:"text/x-wiki",mediawiki:"text/x-mediawiki",rdoc:"text/x-rdoc",builder:"text/x-builder",nokogiri:"text/x-nokogiri",erb:"application/x-erb"};var r=function(ad){var ab=[];for(var ac in ad){ab.push(ac)}return new RegExp("^("+ab.join("|")+"):")}(q);var Y={commentLine:"comment",slimSwitch:"operator special",slimTag:"tag",slimId:"attribute def",slimClass:"attribute qualifier",slimAttribute:"attribute",slimSubmode:"keyword special",closeAttributeTag:null,slimDoctype:null,lineContinuation:null};var i={"{":"}","[":"]","(":")"};var E="_a-zA-Z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD";var C=E+"\\-0-9\xB7\u0300-\u036F\u203F-\u2040";var D=new RegExp("^[:"+E+"](?::["+C+"]|["+C+"]*)");var b=new RegExp("^[:"+E+"][:\\."+C+"]*(?=\\s*=)");var aa=new RegExp("^[:"+E+"][:\\."+C+"]*");var h=/^\.-?[_a-zA-Z]+[\w\-]*/;var g=/^#[_a-zA-Z]+[\w\-]*/;function f(ab,ae,ad){var ac=function(ag,af){af.tokenize=ae;if(ag.pos<ab){ag.pos=ab;return ad}return af.tokenize(ag,af)};return function(ag,af){af.tokenize=ac;return ae(ag,af)}}function z(ag,af,ae,ad,ah){var ab=ag.current();var ac=ab.search(ae);if(ac>-1){af.tokenize=f(ag.pos,af.tokenize,ah);ag.backUp(ab.length-ac-ad)}return ah}function n(ac,ab){ac.stack={parent:ac.stack,style:"continuation",indented:ab,tokenize:ac.line};ac.line=ac.tokenize}function s(ab){if(ab.line==ab.tokenize){ab.line=ab.stack.tokenize;ab.stack=ab.stack.parent}}function y(ab,ac){return function(ae,ad){s(ad);if(ae.match(/^\\$/)){n(ad,ab);return"lineContinuation"}var af=ac(ae,ad);if(ae.eol()&&ae.current().match(/(?:^|[^\\])(?:\\\\)*\\$/)){ae.backUp(1)}return af}}function j(ab,ac){return function(ae,ad){s(ad);var af=ac(ae,ad);if(ae.eol()&&ae.current().match(/,$/)){n(ad,ab)}return af}}function H(ab,ac){return function(af,ae){var ad=af.peek();if(ad==ab&&ae.rubyState.tokenize.length==1){af.next();ae.tokenize=ac;return"closeAttributeTag"}else{return G(af,ae)}}}function W(ad){var ab;var ac=function(af,ae){if(ae.rubyState.tokenize.length==1&&!ae.rubyState.context.prev){af.backUp(1);if(af.eatSpace()){ae.rubyState=ab;ae.tokenize=ad;return ad(af,ae)}af.next()}return G(af,ae)};return function(af,ae){ab=ae.rubyState;ae.rubyState=a.startState(I);ae.tokenize=ac;return G(af,ae)}}function G(ac,ab){return I.token(ac,ab.rubyState)}function w(ac,ab){if(ac.match(/^\\$/)){return"lineContinuation"}return v(ac,ab)}function v(ac,ab){if(ac.match(/^#\{/)){ab.tokenize=H("}",ab.tokenize);return null}return z(ac,ab,/[^\\]#\{/,1,x.token(ac,ab.htmlState))}function T(ab){return function(ad,ac){var ae=w(ad,ac);if(ad.eol()){ac.tokenize=ab}return ae}}function U(ad,ac,ab){ac.stack={parent:ac.stack,style:"html",indented:ad.column()+ab,tokenize:ac.line};ac.line=ac.tokenize=v;return null}function k(ac,ab){ac.skipToEnd();return ab.stack.style}function l(ac,ab){ab.stack={parent:ab.stack,style:"comment",indented:ab.indented+1,tokenize:ab.line};ab.line=k;return k(ac,ab)}function c(ac,ab){if(ac.eat(ab.stack.endQuote)){ab.line=ab.stack.line;ab.tokenize=ab.stack.tokenize;ab.stack=ab.stack.parent;return null}if(ac.match(aa)){ab.tokenize=d;return"slimAttribute"}ac.next();return null}function d(ac,ab){if(ac.match(/^==?/)){ab.tokenize=e;return null}return c(ac,ab)}function e(ad,ac){var ab=ad.peek();if(ab=='"'||ab=="'"){ac.tokenize=F(ab,"string",true,false,c);ad.next();return ac.tokenize(ad,ac)}if(ab=="["){return W(c)(ad,ac)}if(ad.match(/^(true|false|nil)\b/)){ac.tokenize=c;return"keyword"}return W(c)(ad,ac)}function S(ac,ab,ad){ac.stack={parent:ac.stack,style:"wrapper",indented:ac.indented+1,tokenize:ad,line:ac.line,endQuote:ab};ac.line=ac.tokenize=c;return null}function Z(ac,ab){if(ac.match(/^#\{/)){ab.tokenize=H("}",ab.tokenize);return null}var ae=new a.StringStream(ac.string.slice(ab.stack.indented),ac.tabSize);ae.pos=ac.pos-ab.stack.indented;ae.start=ac.start-ab.stack.indented;ae.lastColumnPos=ac.lastColumnPos-ab.stack.indented;ae.lastColumnValue=ac.lastColumnValue-ab.stack.indented;var ad=ab.subMode.token(ae,ab.subState);ac.pos=ae.pos+ab.stack.indented;return ad}function t(ac,ab){ab.stack.indented=ac.column();ab.line=ab.tokenize=Z;return ab.tokenize(ac,ab)}function o(ac){var ad=q[ac];var ae=a.mimeModes[ad];if(ae){return a.getMode(m,ae)}var ab=a.modes[ad];if(ab){return ab(m,{name:ad})}return a.getMode(m,"null")}function u(ab){if(!B.hasOwnProperty(ab)){return B[ab]=o(ab)}return B[ab]}function X(ab,ac){var ad=u(ab);var ae=a.startState(ad);ac.subMode=ad;ac.subState=ae;ac.stack={parent:ac.stack,style:"sub",indented:ac.indented+1,tokenize:ac.line};ac.line=ac.tokenize=t;return"slimSubmode"}function p(ac,ab){ac.skipToEnd();return"slimDoctype"}function V(ae,ad){var ab=ae.peek();if(ab=="<"){return(ad.tokenize=T(ad.tokenize))(ae,ad)}if(ae.match(/^[|']/)){return U(ae,ad,1)}if(ae.match(/^\/(!|\[\w+])?/)){return l(ae,ad)}if(ae.match(/^(-|==?[<>]?)/)){ad.tokenize=y(ae.column(),j(ae.column(),G));return"slimSwitch"}if(ae.match(/^doctype\b/)){ad.tokenize=p;return"keyword"}var ac=ae.match(r);if(ac){return X(ac[1],ad)}return Q(ae,ad)}function J(ac,ab){if(ab.startOfLine){return V(ac,ab)}return Q(ac,ab)}function Q(ac,ab){if(ac.eat("*")){ab.tokenize=W(R);return null}if(ac.match(D)){ab.tokenize=R;return"slimTag"}return O(ac,ab)}function R(ac,ab){if(ac.match(/^(<>?|><?)/)){ab.tokenize=O;return null}return O(ac,ab)}function O(ac,ab){if(ac.match(g)){ab.tokenize=O;return"slimId"}if(ac.match(h)){ab.tokenize=O;return"slimClass"}return K(ac,ab)}function K(ac,ab){if(ac.match(/^([\[\{\(])/)){return S(ab,i[RegExp.$1],K)}if(ac.match(b)){ab.tokenize=L;return"slimAttribute"}if(ac.peek()=="*"){ac.next();ab.tokenize=W(P);return null}return P(ac,ab)}function L(ac,ab){if(ac.match(/^==?/)){ab.tokenize=N;return null}return K(ac,ab)}function N(ad,ac){var ab=ad.peek();if(ab=='"'||ab=="'"){ac.tokenize=F(ab,"string",true,false,K);ad.next();return ac.tokenize(ad,ac)}if(ab=="["){return W(K)(ad,ac)}if(ab==":"){return W(M)(ad,ac)}if(ad.match(/^(true|false|nil)\b/)){ac.tokenize=K;return"keyword"}return W(K)(ad,ac)}function M(ac,ab){ac.backUp(1);if(ac.match(/^[^\s],(?=:)/)){ab.tokenize=W(M);return null}ac.next();return K(ac,ab)}function F(ad,ae,ab,af,ac){return function(ak,aj){s(aj);var ai=ak.current().length==0;if(ak.match(/^\\$/,ai)){if(!ai){return ae}n(aj,aj.indented);return"lineContinuation"}if(ak.match(/^#\{/,ai)){if(!ai){return ae}aj.tokenize=H("}",aj.tokenize);return null}var ah=false,ag;while((ag=ak.next())!=null){if(ag==ad&&(af||!ah)){aj.tokenize=ac;break}if(ab&&ag=="#"&&!ah){if(ak.eat("{")){ak.backUp(2);break}}ah=!ah&&ag=="\\"}if(ak.eol()&&ah){ak.backUp(1)}return ae}}function P(ac,ab){if(ac.match(/^==?/)){ab.tokenize=G;return"slimSwitch"}if(ac.match(/^\/$/)){ab.tokenize=J;return null}if(ac.match(/^:/)){ab.tokenize=Q;return"slimSwitch"}U(ac,ab,0);return ab.tokenize(ac,ab)}var A={startState:function(){var ab=a.startState(x);var ac=a.startState(I);return{htmlState:ab,rubyState:ac,stack:null,last:null,tokenize:J,line:J,indented:0}},copyState:function(ab){return{htmlState:a.copyState(x,ab.htmlState),rubyState:a.copyState(I,ab.rubyState),subMode:ab.subMode,subState:ab.subMode&&a.copyState(ab.subMode,ab.subState),stack:ab.stack,last:ab.last,tokenize:ab.tokenize,line:ab.line}},token:function(ac,ab){if(ac.sol()){ab.indented=ac.indentation();ab.startOfLine=true;ab.tokenize=ab.line;while(ab.stack&&ab.stack.indented>ab.indented&&ab.last!="slimSubmode"){ab.line=ab.tokenize=ab.stack.tokenize;ab.stack=ab.stack.parent;ab.subMode=null;ab.subState=null}}if(ac.eatSpace()){return null}var ad=ab.tokenize(ac,ab);ab.startOfLine=false;if(ad){ab.last=ad}return Y.hasOwnProperty(ad)?Y[ad]:ad},blankLine:function(ab){if(ab.subMode&&ab.subMode.blankLine){return ab.subMode.blankLine(ab.subState)}},innerMode:function(ab){if(ab.subMode){return{state:ab.subState,mode:ab.subMode}}return{state:ab,mode:A}}};return A},"htmlmixed","ruby");a.defineMIME("text/x-slim","slim");a.defineMIME("application/x-slim","slim")});