(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("rst",function(b,d){var k=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/;var f=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/;var g=/^``[^`\s](?:[^`]*[^`\s])``/;var i=/^(?:[\d]+(?:[\.,]\d+)*)/;var j=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/;var h=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/;var o="[Hh][Tt][Tt][Pp][Ss]?://";var m="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})";var n="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*";var l=new RegExp("^"+o+m+n);var e={token:function(p){if(p.match(k)&&p.match(/\W+|$/,false)){return"strong"}if(p.match(f)&&p.match(/\W+|$/,false)){return"em"}if(p.match(g)&&p.match(/\W+|$/,false)){return"string-2"}if(p.match(i)){return"number"}if(p.match(j)){return"positive"}if(p.match(h)){return"negative"}if(p.match(l)){return"link"}while(p.next()!=null){if(p.match(k,false)){break}if(p.match(f,false)){break}if(p.match(g,false)){break}if(p.match(i,false)){break}if(p.match(j,false)){break}if(p.match(h,false)){break}if(p.match(l,false)){break}}return null}};var c=a.getMode(b,d.backdrop||"rst-base");return a.overlayMode(c,e,true)},"python","stex");a.defineMode("rst-base",function(d){function f(aa){var Z=Array.prototype.slice.call(arguments,1);return aa.replace(/{(\d+)}/g,function(ab,ac){return typeof Z[ac]!="undefined"?Z[ac]:ab})}var g=a.getMode(d,"python");var h=a.getMode(d,"stex");var P="\\s+";var R="(?:\\s*|\\W|$)",M=new RegExp(f("^{0}",R));var i="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",B=new RegExp(f("^{0}",i));var j="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)";var l=f("(?:{0}|`{1}`)",i,j);var S="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)";var T="(?:[^\\`]+)",N=new RegExp(f("^{0}",T));var F=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$");var s=new RegExp(f("^\\.\\.{0}",P));var v=new RegExp(f("^_{0}:{1}|^__:{1}",l,R));var o=new RegExp(f("^{0}::{1}",l,R));var G=new RegExp(f("^\\|{0}\\|{1}{2}::{3}",S,P,l,R));var t=new RegExp(f("^\\[(?:\\d+|#{0}?|\\*)]{1}",l,R));var m=new RegExp(f("^\\[{0}\\]{1}",l,R));var I=new RegExp(f("^\\|{0}\\|",S));var u=new RegExp(f("^\\[(?:\\d+|#{0}?|\\*)]_",l));var n=new RegExp(f("^\\[{0}\\]_",l));var y=new RegExp(f("^{0}__?",l));var z=new RegExp(f("^`{0}`_",T));var D=new RegExp(f("^:{0}:`{1}`{2}",i,T,R));var E=new RegExp(f("^`{1}`:{0}:{2}",i,T,R));var C=new RegExp(f("^:{0}:{1}",i,R));var p=new RegExp(f("^{0}",l));var q=new RegExp(f("^::{0}",R));var L=new RegExp(f("^\\|{0}\\|",S));var J=new RegExp(f("^{0}",P));var H=new RegExp(f("^{0}",l));var K=new RegExp(f("^::{0}",R));var w=new RegExp("^_");var x=new RegExp(f("^{0}|_",l));var A=new RegExp(f("^:{0}",R));var O=new RegExp("^::\\s*$");var r=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");function X(aa,Z){var ab=null;if(aa.sol()&&aa.match(r,false)){c(Z,W,{mode:g,local:a.startState(g)})}else{if(aa.sol()&&aa.match(s)){c(Z,V);ab="meta"}else{if(aa.sol()&&aa.match(F)){c(Z,X);ab="header"}else{if(k(Z)==D||aa.match(D,false)){switch(Q(Z)){case 0:c(Z,X,e(D,1));aa.match(/^:/);ab="meta";break;case 1:c(Z,X,e(D,2));aa.match(B);ab="keyword";if(aa.current().match(/^(?:math|latex)/)){Z.tmp_stex=true}break;case 2:c(Z,X,e(D,3));aa.match(/^:`/);ab="meta";break;case 3:if(Z.tmp_stex){Z.tmp_stex=undefined;Z.tmp={mode:h,local:a.startState(h)}}if(Z.tmp){if(aa.peek()=="`"){c(Z,X,e(D,4));Z.tmp=undefined;break}ab=Z.tmp.mode.token(aa,Z.tmp.local);break}c(Z,X,e(D,4));aa.match(N);ab="string";break;case 4:c(Z,X,e(D,5));aa.match(/^`/);ab="meta";break;case 5:c(Z,X,e(D,6));aa.match(M);break;default:c(Z,X)}}else{if(k(Z)==E||aa.match(E,false)){switch(Q(Z)){case 0:c(Z,X,e(E,1));aa.match(/^`/);ab="meta";break;case 1:c(Z,X,e(E,2));aa.match(N);ab="string";break;case 2:c(Z,X,e(E,3));aa.match(/^`:/);ab="meta";break;case 3:c(Z,X,e(E,4));aa.match(B);ab="keyword";break;case 4:c(Z,X,e(E,5));aa.match(/^:/);ab="meta";break;case 5:c(Z,X,e(E,6));aa.match(M);break;default:c(Z,X)}}else{if(k(Z)==C||aa.match(C,false)){switch(Q(Z)){case 0:c(Z,X,e(C,1));aa.match(/^:/);ab="meta";break;case 1:c(Z,X,e(C,2));aa.match(B);ab="keyword";break;case 2:c(Z,X,e(C,3));aa.match(/^:/);ab="meta";break;case 3:c(Z,X,e(C,4));aa.match(M);break;default:c(Z,X)}}else{if(k(Z)==I||aa.match(I,false)){switch(Q(Z)){case 0:c(Z,X,e(I,1));aa.match(L);ab="variable-2";break;case 1:c(Z,X,e(I,2));if(aa.match(/^_?_?/)){ab="link"}break;default:c(Z,X)}}else{if(aa.match(u)){c(Z,X);ab="quote"}else{if(aa.match(n)){c(Z,X);ab="quote"}else{if(aa.match(y)){c(Z,X);if(!aa.peek()||aa.peek().match(/^\W$/)){ab="link"}}else{if(k(Z)==z||aa.match(z,false)){switch(Q(Z)){case 0:if(!aa.peek()||aa.peek().match(/^\W$/)){c(Z,X,e(z,1))}else{aa.match(z)}break;case 1:c(Z,X,e(z,2));aa.match(/^`/);ab="link";break;case 2:c(Z,X,e(z,3));aa.match(N);break;case 3:c(Z,X,e(z,4));aa.match(/^`_/);ab="link";break;default:c(Z,X)}}else{if(aa.match(O)){c(Z,Y)}else{if(aa.next()){c(Z,X)}}}}}}}}}}}}}return ab}function V(aa,Z){var ab=null;if(k(Z)==G||aa.match(G,false)){switch(Q(Z)){case 0:c(Z,V,e(G,1));aa.match(L);ab="variable-2";break;case 1:c(Z,V,e(G,2));aa.match(J);break;case 2:c(Z,V,e(G,3));aa.match(H);ab="keyword";break;case 3:c(Z,V,e(G,4));aa.match(K);ab="meta";break;default:c(Z,X)}}else{if(k(Z)==o||aa.match(o,false)){switch(Q(Z)){case 0:c(Z,V,e(o,1));aa.match(p);ab="keyword";if(aa.current().match(/^(?:math|latex)/)){Z.tmp_stex=true}else{if(aa.current().match(/^python/)){Z.tmp_py=true}}break;case 1:c(Z,V,e(o,2));aa.match(q);ab="meta";if(aa.match(/^latex\s*$/)||Z.tmp_stex){Z.tmp_stex=undefined;c(Z,W,{mode:h,local:a.startState(h)})}break;case 2:c(Z,V,e(o,3));if(aa.match(/^python\s*$/)||Z.tmp_py){Z.tmp_py=undefined;c(Z,W,{mode:g,local:a.startState(g)})}break;default:c(Z,X)}}else{if(k(Z)==v||aa.match(v,false)){switch(Q(Z)){case 0:c(Z,V,e(v,1));aa.match(w);aa.match(x);ab="link";break;case 1:c(Z,V,e(v,2));aa.match(A);ab="meta";break;default:c(Z,X)}}else{if(aa.match(t)){c(Z,X);ab="quote"}else{if(aa.match(m)){c(Z,X);ab="quote"}else{aa.eatSpace();if(aa.eol()){c(Z,X)}else{aa.skipToEnd();c(Z,U);ab="comment"}}}}}}return ab}function U(aa,Z){return b(aa,Z,"comment")}function Y(aa,Z){return b(aa,Z,"meta")}function b(aa,Z,ab){if(aa.eol()||aa.eatSpace()){aa.skipToEnd();return ab}else{c(Z,X);return null}}function W(aa,Z){if(Z.ctx.mode&&Z.ctx.local){if(aa.sol()){if(!aa.eatSpace()){c(Z,X)}return null}return Z.ctx.mode.token(aa,Z.ctx.local)}c(Z,X);return null}function e(ab,ac,aa,Z){return{phase:ab,stage:ac,mode:aa,local:Z}}function c(aa,ab,Z){aa.tok=ab;aa.ctx=Z||{}}function Q(Z){return Z.ctx.stage||0}function k(Z){return Z.ctx.phase}return{startState:function(){return{tok:X,ctx:e(undefined,0)}},copyState:function(aa){var Z=aa.ctx,ab=aa.tmp;if(Z.local){Z={mode:Z.mode,local:a.copyState(Z.mode,Z.local)}}if(ab){ab={mode:ab.mode,local:a.copyState(ab.mode,ab.local)}}return{tok:aa.tok,ctx:Z,tmp:ab}},innerMode:function(Z){return Z.tmp?{state:Z.tmp.local,mode:Z.tmp.mode}:Z.ctx.mode?{state:Z.ctx.local,mode:Z.ctx.mode}:null},token:function(aa,Z){return Z.tok(aa,Z)}}},"python","stex");a.defineMIME("text/x-rst","rst")});