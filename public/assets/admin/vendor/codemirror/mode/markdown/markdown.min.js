(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../xml/xml","../meta"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("markdown",function(e,z){var p=a.getMode(e,"text/html");var q=p.name=="null";function k(L){if(a.findModeByName){var J=a.findModeByName(L);if(J){L=J.mime||J.mimes[0]}}var K=a.getMode(e,L);return K.name=="null"?null:K}if(z.highlightFormatting===undefined){z.highlightFormatting=false}if(z.maxBlockquoteDepth===undefined){z.maxBlockquoteDepth=0}if(z.underscoresBreakWords===undefined){z.underscoresBreakWords=true}if(z.taskLists===undefined){z.taskLists=false}if(z.strikethrough===undefined){z.strikethrough=false}if(z.tokenTypeOverrides===undefined){z.tokenTypeOverrides={}}var H={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var G in H){if(H.hasOwnProperty(G)&&z.tokenTypeOverrides[G]){H[G]=z.tokenTypeOverrides[G]}}var n=/^([*\-_])(?:\s*\1){2,}\s*$/,I=/^[*\-+]\s+/,A=/^[0-9]+([.)])\s+/,E=/^\[(x| )\](?=\s)/,b=z.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,B=/^ *(?:\={1,}|-{1,})\s*$/,F=/^[^#!\[\]*_\\<>` "'(~]+/,f=new RegExp("^("+(z.fencedCodeBlocks===true?"~~~+|```+":z.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)");function D(L,K,J){K.f=K.inline=J;return J(L,K)}function C(L,K,J){K.f=K.block=J;return J(L,K)}function t(J){return !J||!/\S/.test(J.string)}function c(J){J.linkTitle=false;J.em=false;J.strong=false;J.strikethrough=false;J.quote=0;J.indentedCode=false;if(q&&J.f==o){J.f=r;J.block=d}J.trailingSpace=0;J.trailingSpaceNewLine=false;J.prevLine=J.thisLine;J.thisLine=null;return null}function d(P,O){var N=P.sol();var M=O.list!==false,L=O.indentedCode;O.indentedCode=false;if(M){if(O.indentationDiff>=0){if(O.indentationDiff<4){O.indentation-=O.indentationDiff}O.list=null}else{if(O.indentation>0){O.list=null}else{O.list=false}}}var K=null;if(O.indentationDiff>=4){P.skipToEnd();if(L||t(O.prevLine)){O.indentation-=4;O.indentedCode=true;return H.code}else{return null}}else{if(P.eatSpace()){return null}else{if((K=P.match(b))&&K[1].length<=6){O.header=K[1].length;if(z.highlightFormatting){O.formatting="header"}O.f=O.inline;return l(O)}else{if(!t(O.prevLine)&&!O.quote&&!M&&!L&&(K=P.match(B))){O.header=K[0].charAt(0)=="="?1:2;if(z.highlightFormatting){O.formatting="header"}O.f=O.inline;return l(O)}else{if(P.eat(">")){O.quote=N?1:O.quote+1;if(z.highlightFormatting){O.formatting="quote"}P.eatSpace();return l(O)}else{if(P.peek()==="["){return D(P,O,g)}else{if(P.match(n,true)){O.hr=true;return H.hr}else{if((t(O.prevLine)||M)&&(P.match(I,false)||P.match(A,false))){var J=null;if(P.match(I,true)){J="ul"}else{P.match(A,true);J="ol"}O.indentation=P.column()+P.current().length;O.list=true;while(O.listStack&&P.column()<O.listStack[O.listStack.length-1]){O.listStack.pop()}O.listStack.push(O.indentation);if(z.taskLists&&P.match(E,false)){O.taskList=true}O.f=O.inline;if(z.highlightFormatting){O.formatting=["list","list-"+J]}return l(O)}else{if(z.fencedCodeBlocks&&(K=P.match(f,true))){O.fencedChars=K[1];O.localMode=k(K[2]);if(O.localMode){O.localState=a.startState(O.localMode)}O.f=O.block=x;if(z.highlightFormatting){O.formatting="code-block"}O.code=-1;return l(O)}}}}}}}}}return D(P,O,O.inline)}function o(L,K){var M=p.token(L,K.htmlState);if(!q){var J=a.innerMode(p,K.htmlState);if((J.mode.name=="xml"&&J.state.tagStart===null&&(!J.state.context&&J.state.tokenize.isInText))||(K.md_inside&&L.current().indexOf(">")>-1)){K.f=r;K.block=d;K.htmlState=null}}return M}function x(K,J){if(J.fencedChars&&K.match(J.fencedChars,false)){J.localMode=J.localState=null;J.f=J.block=s;return null}else{if(J.localMode){return J.localMode.token(K,J.localState)}else{K.skipToEnd();return H.code}}}function s(L,K){L.match(K.fencedChars);K.block=d;K.f=r;K.fencedChars=null;if(z.highlightFormatting){K.formatting="code-block"}K.code=1;var J=l(K);K.code=0;return J}function l(L){var M=[];if(L.formatting){M.push(H.formatting);if(typeof L.formatting==="string"){L.formatting=[L.formatting]}for(var J=0;J<L.formatting.length;J++){M.push(H.formatting+"-"+L.formatting[J]);if(L.formatting[J]==="header"){M.push(H.formatting+"-"+L.formatting[J]+"-"+L.header)}if(L.formatting[J]==="quote"){if(!z.maxBlockquoteDepth||z.maxBlockquoteDepth>=L.quote){M.push(H.formatting+"-"+L.formatting[J]+"-"+L.quote)}else{M.push("error")}}}}if(L.taskOpen){M.push("meta");return M.length?M.join(" "):null}if(L.taskClosed){M.push("property");return M.length?M.join(" "):null}if(L.linkHref){M.push(H.linkHref,"url")}else{if(L.strong){M.push(H.strong)}if(L.em){M.push(H.em)}if(L.strikethrough){M.push(H.strikethrough)}if(L.linkText){M.push(H.linkText)}if(L.code){M.push(H.code)}if(L.image){M.push(H.image)}if(L.imageAltText){M.push(H.imageAltText,"link")}if(L.imageMarker){M.push(H.imageMarker)}}if(L.header){M.push(H.header,H.header+"-"+L.header)}if(L.quote){M.push(H.quote);if(!z.maxBlockquoteDepth||z.maxBlockquoteDepth>=L.quote){M.push(H.quote+"-"+L.quote)}else{M.push(H.quote+"-"+z.maxBlockquoteDepth)}}if(L.list!==false){var K=(L.listStack.length-1)%3;if(!K){M.push(H.list1)}else{if(K===1){M.push(H.list2)}else{M.push(H.list3)}}}if(L.trailingSpaceNewLine){M.push("trailing-space-new-line")}else{if(L.trailingSpace){M.push("trailing-space-"+(L.trailingSpace%2?"a":"b"))}}return M.length?M.join(" "):null}function m(K,J){if(K.match(F,true)){return l(J)}return undefined}function r(W,V){var X=V.text(W,V);if(typeof X!=="undefined"){return X}if(V.list){V.list=null;return l(V)}if(V.taskList){var Z=W.match(E,true)[1]!=="x";if(Z){V.taskOpen=true}else{V.taskClosed=true}if(z.highlightFormatting){V.formatting="task"}V.taskList=false;return l(V)}V.taskOpen=false;V.taskClosed=false;if(V.header&&W.match(/^#+$/,true)){if(z.highlightFormatting){V.formatting="header"}return l(V)}var U=W.sol();var K=W.next();if(V.linkTitle){V.linkTitle=false;var P=K;if(K==="("){P=")"}P=(P+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var T="^\\s*(?:[^"+P+"\\\\]+|\\\\\\\\|\\\\.)"+P;if(W.match(new RegExp(T),true)){return H.linkHref}}if(K==="`"){var R=V.formatting;if(z.highlightFormatting){V.formatting="code"}W.eatWhile("`");var L=W.current().length;if(V.code==0){V.code=L;return l(V)}else{if(L==V.code){var Y=l(V);V.code=0;return Y}else{V.formatting=R;return l(V)}}}else{if(V.code){return l(V)}}if(K==="\\"){W.next();if(z.highlightFormatting){var aa=l(V);var N=H.formatting+"-escape";return aa?aa+" "+N:N}}if(K==="!"&&W.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){V.imageMarker=true;V.image=true;if(z.highlightFormatting){V.formatting="image"}return l(V)}if(K==="["&&V.imageMarker){V.imageMarker=false;V.imageAltText=true;if(z.highlightFormatting){V.formatting="image"}return l(V)}if(K==="]"&&V.imageAltText){if(z.highlightFormatting){V.formatting="image"}var aa=l(V);V.imageAltText=false;V.image=false;V.inline=V.f=u;return aa}if(K==="["&&W.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,false)&&!V.image){V.linkText=true;if(z.highlightFormatting){V.formatting="link"}return l(V)}if(K==="]"&&V.linkText&&W.match(/\(.*?\)| ?\[.*?\]/,false)){if(z.highlightFormatting){V.formatting="link"}var aa=l(V);V.linkText=false;V.inline=V.f=u;return aa}if(K==="<"&&W.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){V.f=V.inline=v;if(z.highlightFormatting){V.formatting="link"}var aa=l(V);if(aa){aa+=" "}else{aa=""}return aa+H.linkInline}if(K==="<"&&W.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){V.f=V.inline=v;if(z.highlightFormatting){V.formatting="link"}var aa=l(V);if(aa){aa+=" "}else{aa=""}return aa+H.linkEmail}if(K==="<"&&W.match(/^(!--|\w)/,false)){var M=W.string.indexOf(">",W.pos);if(M!=-1){var J=W.string.substring(W.start,M);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(J)){V.md_inside=true}}W.backUp(1);V.htmlState=a.startState(p);return C(W,V,o)}if(K==="<"&&W.match(/^\/\w*?>/)){V.md_inside=false;return"tag"}var O=false;if(!z.underscoresBreakWords){if(K==="_"&&W.peek()!=="_"&&W.match(/(\w)/,false)){var S=W.pos-2;if(S>=0){var Q=W.string.charAt(S);if(Q!=="_"&&Q.match(/(\w)/,false)){O=true}}}}if(K==="*"||(K==="_"&&!O)){if(U&&W.peek()===" "){}else{if(V.strong===K&&W.eat(K)){if(z.highlightFormatting){V.formatting="strong"}var Y=l(V);V.strong=false;return Y}else{if(!V.strong&&W.eat(K)){V.strong=K;if(z.highlightFormatting){V.formatting="strong"}return l(V)}else{if(V.em===K){if(z.highlightFormatting){V.formatting="em"}var Y=l(V);V.em=false;return Y}else{if(!V.em){V.em=K;if(z.highlightFormatting){V.formatting="em"}return l(V)}}}}}}else{if(K===" "){if(W.eat("*")||W.eat("_")){if(W.peek()===" "){return l(V)}else{W.backUp(1)}}}}if(z.strikethrough){if(K==="~"&&W.eatWhile(K)){if(V.strikethrough){if(z.highlightFormatting){V.formatting="strikethrough"}var Y=l(V);V.strikethrough=false;return Y}else{if(W.match(/^[^\s]/,false)){V.strikethrough=true;if(z.highlightFormatting){V.formatting="strikethrough"}return l(V)}}}else{if(K===" "){if(W.match(/^~~/,true)){if(W.peek()===" "){return l(V)}else{W.backUp(2)}}}}}if(K===" "){if(W.match(/ +$/,false)){V.trailingSpace++}else{if(V.trailingSpace){V.trailingSpaceNewLine=true}}}return l(V)}function v(L,K){var J=L.next();if(J===">"){K.f=K.inline=r;if(z.highlightFormatting){K.formatting="link"}var M=l(K);if(M){M+=" "}else{M=""}return M+H.linkInline}L.match(/^[^>]+/,true);return H.linkInline}function u(L,K){if(L.eatSpace()){return null}var J=L.next();if(J==="("||J==="["){K.f=K.inline=j(J==="("?")":"]",0);if(z.highlightFormatting){K.formatting="link-string"}K.linkHref=true;return l(K)}return"error"}var w={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/};function j(J){return function(N,M){var K=N.next();if(K===J){M.f=M.inline=r;if(z.highlightFormatting){M.formatting="link-string"}var L=l(M);M.linkHref=false;return L}N.match(w[J]);M.linkHref=true;return l(M)}}function g(K,J){if(K.match(/^([^\]\\]|\\.)*\]:/,false)){J.f=h;K.next();if(z.highlightFormatting){J.formatting="link"}J.linkText=true;return l(J)}return D(K,J,r)}function h(L,K){if(L.match(/^\]:/,true)){K.f=K.inline=i;if(z.highlightFormatting){K.formatting="link"}var J=l(K);K.linkText=false;return J}L.match(/^([^\]\\]|\\.)+/,true);return H.linkText}function i(K,J){if(K.eatSpace()){return null}K.match(/^[^\s]+/,true);if(K.peek()===undefined){J.linkTitle=true}else{K.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,true)}J.f=J.inline=r;return H.linkHref+" url"}var y={startState:function(){return{f:d,prevLine:null,thisLine:null,block:d,htmlState:null,indentation:0,inline:r,text:m,formatting:false,linkText:false,linkHref:false,linkTitle:false,code:0,em:false,strong:false,header:0,hr:false,taskList:false,list:false,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false,fencedChars:null}},copyState:function(J){return{f:J.f,prevLine:J.prevLine,thisLine:J.thisLine,block:J.block,htmlState:J.htmlState&&a.copyState(p,J.htmlState),indentation:J.indentation,localMode:J.localMode,localState:J.localMode?a.copyState(J.localMode,J.localState):null,inline:J.inline,text:J.text,formatting:false,linkTitle:J.linkTitle,code:J.code,em:J.em,strong:J.strong,strikethrough:J.strikethrough,header:J.header,hr:J.hr,taskList:J.taskList,list:J.list,listStack:J.listStack.slice(0),quote:J.quote,indentedCode:J.indentedCode,trailingSpace:J.trailingSpace,trailingSpaceNewLine:J.trailingSpaceNewLine,md_inside:J.md_inside,fencedChars:J.fencedChars}},token:function(M,L){L.formatting=false;if(M!=L.thisLine){var J=L.header||L.hr;L.header=0;L.hr=false;if(M.match(/^\s*$/,true)||J){c(L);if(!J){return null}L.prevLine=null}L.prevLine=L.thisLine;L.thisLine=M;L.taskList=false;L.trailingSpace=0;L.trailingSpaceNewLine=false;L.f=L.block;var K=M.match(/^\s*/,true)[0].replace(/\t/g,"    ").length;L.indentationDiff=Math.min(K-L.indentation,4);L.indentation=L.indentation+L.indentationDiff;if(K>0){return null}}return L.f(M,L)},innerMode:function(J){if(J.block==o){return{state:J.htmlState,mode:p}}if(J.localState){return{state:J.localState,mode:J.localMode}}return{state:J,mode:y}},blankLine:c,getType:l,fold:"markdown"};return y},"xml");a.defineMIME("text/x-markdown","markdown")});