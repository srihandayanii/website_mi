(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../xml/xml","../javascript/javascript"],a)}else{a(CodeMirror)}}})(function(a){function b(g,e,d,f){this.state=g;this.mode=e;this.depth=d;this.prev=f}function c(d){return new b(a.copyState(d.mode,d.state),d.mode,d.depth,d.prev&&c(d.prev))}a.defineMode("jsx",function(d,h){var j=a.getMode(d,{name:"xml",allowMissing:true,multilineTagIndentPastTag:false});var f=a.getMode(d,h&&h.base||"javascript");function e(m){var n=m.tagName;m.tagName=null;var l=j.indent(m,"");m.tagName=n;return l}function i(m,l){if(l.context.mode==j){return k(m,l,l.context)}else{return g(m,l,l.context)}}function k(q,o,m){if(m.depth==2){if(q.match(/^.*?\*\//)){m.depth=1}else{q.skipToEnd()}return"comment"}if(q.peek()=="{"){j.skipAttribute(m.state);var n=e(m.state),s=m.state.context;if(s&&q.match(/^[^>]*>\s*$/,false)){while(s.prev&&!s.startOfLine){s=s.prev}if(s.startOfLine){n-=d.indentUnit}else{if(m.prev.state.lexical){n=m.prev.state.lexical.indented}}}else{if(m.depth==1){n+=d.indentUnit}}o.context=new b(a.startState(f,n),f,0,o.context);return null}if(m.depth==1){if(q.peek()=="<"){j.skipAttribute(m.state);o.context=new b(a.startState(j,e(m.state)),j,0,o.context);return null}else{if(q.match("//")){q.skipToEnd();return"comment"}else{if(q.match("/*")){m.depth=2;return i(q,o)}}}}var r=j.token(q,m.state),l=q.current(),p;if(/\btag\b/.test(r)){if(/>$/.test(l)){if(m.state.context){m.depth=0}else{o.context=o.context.prev}}else{if(/^</.test(l)){m.depth=1}}}else{if(!r&&(p=l.indexOf("{"))>-1){q.backUp(l.length-p)}}return r}function g(o,n,m){if(o.peek()=="<"&&f.expressionAllowed(o,m.state)){f.skipExpression(m.state);n.context=new b(a.startState(j,f.indent(m.state,"")),j,0,n.context);return null}var p=f.token(o,m.state);if(!p&&m.depth!=null){var l=o.current();if(l=="{"){m.depth++}else{if(l=="}"){if(--m.depth==0){n.context=n.context.prev}}}}return p}return{startState:function(){return{context:new b(a.startState(f),f)}},copyState:function(l){return{context:c(l.context)}},token:i,indent:function(m,n,l){return m.context.mode.indent(m.context.state,n,l)},innerMode:function(l){return l.context}}},"xml","javascript");a.defineMIME("text/jsx","jsx");a.defineMIME("text/typescript-jsx",{name:"jsx",base:{name:"javascript",typescript:true}})});