(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(n){var G=n.Pos;function H(i,P){return i.line==P.line&&i.ch==P.ch}var x=[];function c(i){x.push(i);if(x.length>50){x.shift()}}function s(i){if(!x.length){return c(i)}x[x.length-1]+=i}function p(i){return x[x.length-(i?Math.min(i,1):1)]||""}function F(){if(x.length>1){x.pop()}return p()}var z=null;function v(i,P,S,Q,R){if(R==null){R=i.getRange(P,S)}if(Q&&z&&z.cm==i&&H(P,z.pos)&&i.isClean(z.gen)){s(R)}else{c(R)}i.replaceRange("",P,S,"+delete");if(Q){z={cm:i,pos:P,gen:i.changeGeneration()}}else{z=null}}function d(i,Q,P){return i.findPosH(Q,P,"char",true)}function k(i,Q,P){return i.findPosH(Q,P,"word",true)}function f(i,Q,P){return i.findPosV(Q,P,"line",i.doc.sel.goalColumn)}function g(i,Q,P){return i.findPosV(Q,P,"page",i.doc.sel.goalColumn)}function h(i,V,P){var U=V.line,S=i.getLine(U);var W=/\S/.test(P<0?S.slice(0,V.ch):S.slice(V.ch));var Q=i.firstLine(),T=i.lastLine();for(;;){U+=P;if(U<Q||U>T){return i.clipPos(G(U-P,P<0?0:null))}S=i.getLine(U);var R=/\S/.test(S);if(R){W=true}else{if(W){return G(U,0)}}}}function j(P,T,Q){var R=T.line,i=T.ch;var V=P.getLine(T.line),U=false;for(;;){var S=V.charAt(i+(Q<0?-1:0));if(!S){if(R==(Q<0?P.firstLine():P.lastLine())){return G(R,i)}V=P.getLine(R+Q);if(!/\S/.test(V)){return G(R,i)}R+=Q;i=Q<0?V.length:0;continue}if(U&&/[!?.]/.test(S)){return G(R,i+(Q>0?1:0))}if(!U){U=/\w/.test(S)}i+=Q}}function e(P,T,Q){var V;if(P.findMatchingBracket&&(V=P.findMatchingBracket(T,true))&&V.match&&(V.forward?1:-1)==Q){return Q>0?G(V.to.line,V.to.ch+1):V.to}for(var R=true;;R=false){var U=P.getTokenAt(T);var i=G(T.line,Q<0?U.start:U.end);if(R&&Q>0&&U.end==T.ch||!/\w/.test(U.string)){var S=P.findPosH(i,Q,"char");if(H(i,S)){return T}else{T=S}}else{return i}}}function r(i,Q){var P=i.state.emacsPrefix;if(!P){return Q?null:1}m(i);return P=="-"?-1:Number(P)}function M(i){var P=typeof i=="string"?function(Q){Q.execCommand(i)}:i;return function(Q){var S=r(Q);P(Q);for(var R=1;R<S;++R){P(Q)}}}function o(Q,U,P,R){var V=r(Q);if(V<0){R=-R;V=-V}for(var S=0;S<V;++S){var T=P(Q,U,R);if(H(T,U)){break}U=T}return U}function D(i,P){var Q=function(R){R.extendSelection(o(R,R.getCursor(),i,P))};Q.motion=true;return Q}function y(Q,P,S){var U=Q.listSelections(),R;var T=U.length;while(T--){R=U[T].head;v(Q,R,o(Q,R,P,S),true)}}function w(P){if(P.somethingSelected()){var S=P.listSelections(),R;var Q=S.length;while(Q--){R=S[Q];v(P,R.anchor,R.head)}return true}}function a(i,P){if(i.state.emacsPrefix){if(P!="-"){i.state.emacsPrefix+=P}return}i.state.emacsPrefix=P;i.on("keyHandled",A);i.on("inputRead",B)}var J={"Alt-G":true,"Ctrl-X":true,"Ctrl-Q":true,"Ctrl-U":true};function A(P,i){if(!P.state.emacsPrefixMap&&!J.hasOwnProperty(i)){m(P)}}function m(i){i.state.emacsPrefix=null;i.off("keyHandled",A);i.off("inputRead",B)}function B(P,R){var Q=r(P);if(Q>1&&R.origin=="+input"){var T=R.text.join("\n"),U="";for(var S=1;S<Q;++S){U+=T}P.replaceSelection(U)}}function b(i){i.state.emacsPrefixMap=true;i.addKeyMap(I);i.on("keyHandled",C);i.on("inputRead",C)}function C(P,i){if(typeof i=="string"&&(/^\d$/.test(i)||i=="Ctrl-U")){return}P.removeKeyMap(I);P.state.emacsPrefixMap=false;P.off("keyHandled",C);P.off("inputRead",C)}function N(i){i.setCursor(i.getCursor());i.setExtending(!i.getExtending());i.on("change",function(){i.setExtending(false)})}function l(i){i.setExtending(false);i.setCursor(i.getCursor())}function q(i,Q,P){if(i.openDialog){i.openDialog(Q+': <input type="text" style="width: 10em"/>',P,{bottom:true})}else{P(prompt(Q,""))}}function E(i,Q){var R=i.getCursor(),P=i.findPosH(R,1,"word");i.replaceRange(Q(i.getRange(R,P)),R,P);i.setCursor(P)}function O(Q){var T=Q.getCursor(),S=T.line,P=T.ch;var U=[];while(S>=Q.firstLine()){var V=Q.getLine(S);for(var R=P==null?V.length:P;R>0;){var P=V.charAt(--R);if(P==")"){U.push("(")}else{if(P=="]"){U.push("[")}else{if(P=="}"){U.push("{")}else{if(/[\(\{\[]/.test(P)&&(!U.length||U.pop()!=P)){return Q.extendSelection(G(S,R))}}}}}--S;P=null}}function K(i){i.execCommand("clearSearch");l(i)}var u=n.keyMap.emacs=n.normalizeKeyMap({"Ctrl-W":function(i){v(i,i.getCursor("start"),i.getCursor("end"))},"Ctrl-K":M(function(i){var Q=i.getCursor(),P=i.clipPos(G(Q.line));var R=i.getRange(Q,P);if(!/\S/.test(R)){R+="\n";P=G(Q.line+1,0)}v(i,Q,P,true,R)}),"Alt-W":function(i){c(i.getSelection());l(i)},"Ctrl-Y":function(i){var P=i.getCursor();i.replaceRange(p(r(i)),P,P,"paste");i.setSelection(P,i.getCursor())},"Alt-Y":function(i){i.replaceSelection(F(),"around","paste")},"Ctrl-Space":N,"Ctrl-Shift-2":N,"Ctrl-F":D(d,1),"Ctrl-B":D(d,-1),Right:D(d,1),Left:D(d,-1),"Ctrl-D":function(i){y(i,d,1)},Delete:function(i){w(i)||y(i,d,1)},"Ctrl-H":function(i){y(i,d,-1)},Backspace:function(i){w(i)||y(i,d,-1)},"Alt-F":D(k,1),"Alt-B":D(k,-1),"Alt-D":function(i){y(i,k,1)},"Alt-Backspace":function(i){y(i,k,-1)},"Ctrl-N":D(f,1),"Ctrl-P":D(f,-1),Down:D(f,1),Up:D(f,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":D(g,-1),"Ctrl-V":D(g,1),PageUp:D(g,-1),PageDown:D(g,1),"Ctrl-Up":D(h,-1),"Ctrl-Down":D(h,1),"Alt-A":D(j,-1),"Alt-E":D(j,1),"Alt-K":function(i){y(i,j,1)},"Ctrl-Alt-K":function(i){y(i,e,1)},"Ctrl-Alt-Backspace":function(i){y(i,e,-1)},"Ctrl-Alt-F":D(e,1),"Ctrl-Alt-B":D(e,-1),"Shift-Ctrl-Alt-2":function(i){var P=i.getCursor();i.setSelection(o(i,P,e,1),P)},"Ctrl-Alt-T":function(i){var Q=e(i,i.getCursor(),-1),P=e(i,Q,1);var R=e(i,P,1),S=e(i,R,-1);i.replaceRange(i.getRange(S,R)+i.getRange(P,S)+i.getRange(Q,P),Q,R)},"Ctrl-Alt-U":M(O),"Alt-Space":function(i){var Q=i.getCursor(),P=Q.ch,S=Q.ch,R=i.getLine(Q.line);while(P&&/\s/.test(R.charAt(P-1))){--P}while(S<R.length&&/\s/.test(R.charAt(S))){++S}i.replaceRange(" ",G(Q.line,P),G(Q.line,S))},"Ctrl-O":M(function(i){i.replaceSelection("\n","start")}),"Ctrl-T":M(function(i){i.execCommand("transposeChars")}),"Alt-C":M(function(i){E(i,function(Q){var P=Q.search(/\w/);if(P==-1){return Q}return Q.slice(0,P)+Q.charAt(P).toUpperCase()+Q.slice(P+1).toLowerCase()})}),"Alt-U":M(function(i){E(i,function(P){return P.toUpperCase()})}),"Alt-L":M(function(i){E(i,function(P){return P.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":M("undo"),"Shift-Ctrl--":M("undo"),"Ctrl-Z":M("undo"),"Cmd-Z":M("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":K,"Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:false,Tab:"indentAuto","Alt-G G":function(i){var P=r(i,true);if(P!=null&&P>0){return i.setCursor(P-1)}q(i,"Goto line",function(R){var Q;if(R&&!isNaN(Q=Number(R))&&Q==(Q|0)&&Q>0){i.setCursor(Q-1)}})},"Ctrl-X Tab":function(i){i.indentSelection(r(i,true)||i.getOption("indentUnit"))},"Ctrl-X Ctrl-X":function(i){i.setSelection(i.getCursor("head"),i.getCursor("anchor"))},"Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X U":M("undo"),"Ctrl-X K":"close","Ctrl-X Delete":function(i){v(i,i.getCursor(),j(i,i.getCursor(),1),true)},"Ctrl-X H":"selectAll","Ctrl-Q Tab":M("insertTab"),"Ctrl-U":b});var I={"Ctrl-G":m};function L(i){I[i]=function(P){a(P,i)};u["Ctrl-"+i]=function(P){a(P,i)};J["Ctrl-"+i]=true}for(var t=0;t<10;++t){L(String(t))}L("-")});