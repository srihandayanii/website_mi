(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js"))}else{if(typeof define=="function"&&define.amd){define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],a)}else{a(CodeMirror)}}})(function(a){var c=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:"]p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:"[p",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:true},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},isEdit:true},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},isEdit:true},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:true},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:true},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:true},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:true},operatorArgs:{shouldMoveCursor:true},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:true},{keys:"p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:"P",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:"r<character>",type:"action",action:"replace",isEdit:true},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},context:"visual",isEdit:true},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},context:"visual",isEdit:true},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:"/",type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:"?",type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:"*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"g*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:"g#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:":",type:"ex"}];var b=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:true},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true},{name:"global",shortName:"g"}];var d=a.Pos;var e=function(){function L(bF){bF.setOption("disableInput",true);bF.setOption("showCursorWhenSelecting",false);a.signal(bF,"vim-mode-change",{mode:"normal"});bF.on("cursorActivity",aZ);aP(bF);a.on(bF.getInputField(),"paste",aj(bF))}function aE(bF){bF.setOption("disableInput",false);bF.off("cursorActivity",aZ);a.off(bF.getInputField(),"paste",aj(bF));bF.state.vim=null}function I(bF,bG){if(this==a.keyMap.vim){a.rmClass(bF.getWrapperElement(),"cm-fat-cursor")}if(!bG||bG.attach!=h){aE(bF,false)}}function h(bF,bG){if(this==a.keyMap.vim){a.addClass(bF.getWrapperElement(),"cm-fat-cursor")}if(!bG||bG.attach!=h){L(bF)}}a.defineOption("vimMode",false,function(bF,bH,bG){if(bH&&bF.getOption("keyMap")!="vim"){bF.setOption("keyMap","vim")}else{if(!bH&&bG!=a.Init&&/^vim/.test(bF.getOption("keyMap"))){bF.setOption("keyMap","default")}}});function p(bH,bF){if(!bF){return undefined}if(this[bH]){return this[bH]}var bI=q(bH);if(!bI){return false}var bG=a.Vim.findKey(bF,bI);if(typeof bG=="function"){a.signal(bF,"vim-keypress",bI)}return bG}var aQ={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"};var bm={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"};function q(bH){if(bH.charAt(0)=="'"){return bH.charAt(1)}var bK=bH.split(/-(?!$)/);var bI=bK[bK.length-1];if(bK.length==1&&bK[0].length==1){return false}else{if(bK.length==2&&bK[0]=="Shift"&&bI.length==1){return false}}var bF=false;for(var bG=0;bG<bK.length;bG++){var bJ=bK[bG];if(bJ in aQ){bK[bG]=aQ[bJ]}else{bF=true}if(bJ in bm){bK[bG]=bm[bJ]}}if(!bF){return false}if(aA(bI)){bK[bK.length-1]=bI.toLowerCase()}return"<"+bK.join("-")+">"}function aj(bF){var bG=bF.state.vim;if(!bG.onPasteFn){bG.onPasteFn=function(){if(!bG.insertMode){bF.setCursor(aX(bF.getCursor(),0,1));g.enterInsertMode(bF,{},bG)}}}return bG.onPasteFn}var aV=/[\d]/;var bE=[a.isWordChar,function(bF){return bF&&!a.isWordChar(bF)&&!/\s/.test(bF)}],i=[function(bF){return/\S/.test(bF)}];function aM(bI,bH){var bG=[];for(var bF=bI;bF<bI+bH;bF++){bG.push(String.fromCharCode(bF))}return bG}var bz=aM(65,26);var aJ=aM(97,26);var aW=aM(48,10);var bA=[].concat(bz,aJ,aW,["<",">"]);var bB=[].concat(bz,aJ,aW,["-",'"',".",":","/"]);function aw(bF,bG){return bG>=bF.firstLine()&&bG<=bF.lastLine()}function ax(bF){return(/^[a-z]$/).test(bF)}function ay(bF){return"()[]{}".indexOf(bF)!=-1}function az(bF){return aV.test(bF)}function aA(bF){return(/^[A-Z]$/).test(bF)}function aB(bF){return(/^\s*$/).test(bF)}function ar(bH,bF){for(var bG=0;bG<bF.length;bG++){if(bF[bG]==bH){return true}}return false}var a2={};function G(bJ,bH,bK,bF,bG){if(bH===undefined&&!bG){throw Error("defaultValue is required unless callback is provided")}if(!bK){bK="string"}a2[bJ]={type:bK,defaultValue:bH,callback:bG};if(bF){for(var bI=0;bI<bF.length;bI++){a2[bF[bI]]=a2[bJ]}}if(bH){bj(bJ,bH)}}function bj(bH,bK,bG,bF){var bI=a2[bH];bF=bF||{};var bJ=bF.scope;if(!bI){throw Error("Unknown option: "+bH)}if(bI.type=="boolean"){if(bK&&bK!==true){throw Error("Invalid argument: "+bH+"="+bK)}else{if(bK!==false){bK=true}}}if(bI.callback){if(bJ!=="local"){bI.callback(bK,undefined)}if(bJ!=="global"&&bG){bI.callback(bK,bG)}}else{if(bJ!=="local"){bI.value=bI.type=="boolean"?!!bK:bK}if(bJ!=="global"&&bG){bG.state.vim.options[bH]={value:bK}}}}function ak(bI,bG,bF){var bJ=a2[bI];bF=bF||{};var bK=bF.scope;if(!bJ){throw Error("Unknown option: "+bI)}if(bJ.callback){var bH=bG&&bJ.callback(undefined,bG);if(bK!=="global"&&bH!==undefined){return bH}if(bK!=="local"){return bJ.callback()}return}else{var bH=(bK!=="global")&&(bG&&bG.state.vim.options[bI]);return(bH||(bK!=="local")&&bJ||{}).value}}G("filetype",undefined,"string",["ft"],function(bH,bF){if(bF===undefined){return}if(bH===undefined){var bG=bF.getOption("mode");return bG=="null"?"":bG}else{var bG=bH==""?"null":bH;bF.setOption("mode",bG)}});var w=function(){var bK=100;var bJ=-1;var bH=0;var bL=0;var bG=new Array(bK);function bF(bM,bR,bQ){var bO=bJ%bK;var bN=bG[bO];function bS(bT){var bU=++bJ%bK;var bV=bG[bU];if(bV){bV.clear()}bG[bU]=bM.setBookmark(bT)}if(bN){var bP=bN.find();if(bP&&!y(bP,bR)){bS(bR)}}else{bS(bR)}bS(bQ);bH=bJ;bL=bJ-bK+1;if(bL<0){bL=0}}function bI(bM,bQ){bJ+=bQ;if(bJ>bH){bJ=bH}else{if(bJ<bL){bJ=bL}}var bO=bG[(bK+bJ)%bK];if(bO&&!bO.find()){var bN=bQ>0?1:-1;var bP;var bR=bM.getCursor();do{bJ+=bN;bO=bG[(bK+bJ)%bK];if(bO&&(bP=bO.find())&&!y(bR,bP)){break}}while(bJ<bH&&bJ>bL)}return bO}return{cachedCursor:undefined,add:bF,move:bI}};var x=function(bF){if(bF){return{changes:bF.changes,expectCursorActivityForChange:bF.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};function aK(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=undefined;this.lastInsertModeChanges=x()}aK.prototype={exitMacroRecordMode:function(){var bF=bD.macroModeState;if(bF.onRecordingDone){bF.onRecordingDone()}bF.onRecordingDone=undefined;bF.isRecording=false},enterMacroRecordMode:function(bF,bH){var bG=bD.registerController.getRegister(bH);if(bG){bG.clear();this.latestRegister=bH;if(bF.openDialog){this.onRecordingDone=bF.openDialog("(recording)["+bH+"]",null,{bottom:true})}this.isRecording=true}}};function aP(bF){if(!bF.state.vim){bF.state.vim={inputState:new at(),lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,visualBlock:false,lastSelection:null,lastPastedText:null,sel:{},options:{}}}return bF.state.vim}var bD;function bc(){bD={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:undefined,jumpList:w(),macroModeState:new aK,lastCharacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new a8({}),searchHistoryController:new aq({}),exCommandHistoryController:new aq({})};for(var bG in a2){var bF=a2[bG];bF.value=bF.defaultValue}}var aD;var bC={buildKeyMap:function(){},getRegisterController:function(){return bD.registerController},resetVimGlobalState_:bc,getVimGlobalState_:function(){return bD},maybeInitVimState_:aP,suppressErrorLogging:false,InsertModeKey:au,map:function(bG,bH,bF){N.map(bG,bH,bF)},unmap:function(bG,bF){N.unmap(bG,bF)},setOption:bj,getOption:ak,defineOption:G,defineEx:function(bG,bH,bF){if(!bH){bH=bG}else{if(bG.indexOf(bH)!==0){throw new Error('(Vim.defineEx) "'+bH+'" is not a prefix of "'+bG+'", command not registered')}}P[bG]=bF;N.commandMap_[bH]={name:bG,shortName:bH,type:"api"}},handleKey:function(bF,bH,bI){var bG=this.findKey(bF,bH,bI);if(typeof bG==="function"){return bG()}},findKey:function(bF,bM,bN){var bO=aP(bF);function bL(){var bP=bD.macroModeState;if(bP.isRecording){if(bM=="q"){bP.exitMacroRecordMode();l(bF);return true}if(bN!="mapping"){aH(bP,bM)}}}function bI(){if(bM=="<Esc>"){l(bF);if(bO.visualMode){S(bF)}else{if(bO.insertMode){R(bF)}}return true}}function bH(bP){var bQ;while(bP){bQ=(/<\w+-.+?>|<\w+>|./).exec(bP);bM=bQ[0];bP=bP.substring(bQ.index+bM.length);a.Vim.handleKey(bF,bM,"mapping")}}function bJ(){if(bI()){return true}var bQ=bO.inputState.keyBuffer=bO.inputState.keyBuffer+bM;var bR=bM.length==1;var bS=r.matchCommand(bQ,c,bO.inputState,"insert");while(bQ.length>1&&bS.type!="full"){var bQ=bO.inputState.keyBuffer=bQ.slice(1);var bT=r.matchCommand(bQ,c,bO.inputState,"insert");if(bT.type!="none"){bS=bT}}if(bS.type=="none"){l(bF);return false}else{if(bS.type=="partial"){if(aD){window.clearTimeout(aD)}aD=window.setTimeout(function(){if(bO.insertMode&&bO.inputState.keyBuffer){l(bF)}},ak("insertModeEscKeysTimeout"));return !bR}}if(aD){window.clearTimeout(aD)}if(bR){var bP=bF.getCursor();bF.replaceRange("",aX(bP,0,-(bQ.length-1)),bP,"+input")}l(bF);return bS.command}function bK(){if(bL()||bI()){return true}var bQ=bO.inputState.keyBuffer=bO.inputState.keyBuffer+bM;if(/^[1-9]\d*$/.test(bQ)){return true}var bR=/^(\d*)(.*)$/.exec(bQ);if(!bR){l(bF);return false}var bP=bO.visualMode?"visual":"normal";var bS=r.matchCommand(bR[2]||bR[1],c,bO.inputState,bP);if(bS.type=="none"){l(bF);return false}else{if(bS.type=="partial"){return true}}bO.inputState.keyBuffer="";var bR=/^(\d*)(.*)$/.exec(bQ);if(bR[1]&&bR[1]!="0"){bO.inputState.pushRepeatDigit(bR[1])}return bS.command}var bG;if(bO.insertMode){bG=bJ()}else{bG=bK()}if(bG===false){return undefined}else{if(bG===true){return function(){}}else{return function(){return bF.operation(function(){bF.curOp.isVimOp=true;try{if(bG.type=="keyToKey"){bH(bG.toKeys)}else{r.processCommand(bF,bO,bG)}}catch(bP){bF.state.vim=undefined;aP(bF);if(!a.Vim.suppressErrorLogging){console.log(bP)}throw bP}return true})}}}},handleEx:function(bF,bG){N.processCommand(bF,bG)},defineMotion:E,defineAction:D,defineOperator:F,mapCommand:aO,_mapCommand:f,defineRegister:H,exitVisualMode:S,exitInsertMode:R};function at(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null}at.prototype.pushRepeatDigit=function(bF){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(bF)}else{this.motionRepeat=this.motionRepeat.concat(bF)}};at.prototype.getRepeat=function(){var bF=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){bF=1;if(this.prefixRepeat.length>0){bF*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){bF*=parseInt(this.motionRepeat.join(""),10)}}return bF};function l(bF,bG){bF.state.vim.inputState=new at();a.signal(bF,"vim-command-done",bG)}function a7(bH,bG,bF){this.clear();this.keyBuffer=[bH||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!bG;this.blockwise=!!bF}a7.prototype={setText:function(bH,bG,bF){this.keyBuffer=[bH||""];this.linewise=!!bG;this.blockwise=!!bF},pushText:function(bG,bF){if(bF){if(!this.linewise){this.keyBuffer.push("\n")}this.linewise=true}this.keyBuffer.push(bG)},pushInsertModeChanges:function(bF){this.insertModeChanges.push(x(bF))},pushSearchQuery:function(bF){this.searchQueries.push(bF)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};function H(bF,bG){var bH=bD.registerController.registers[bF];if(!bF||bF.length!=1){throw Error("Register name must be 1 character")}if(bH[bF]){throw Error("Register already defined "+bF)}bH[bF]=bG;bB.push(bF)}function a8(bF){this.registers=bF;this.unnamedRegister=bF['"']=new a7();bF["."]=new a7();bF[":"]=new a7();bF["/"]=new a7()}a8.prototype={pushText:function(bK,bI,bL,bH,bG){if(bH&&bL.charAt(0)=="\n"){bL=bL.slice(1)+"\n"}if(bH&&bL.charAt(bL.length-1)!=="\n"){bL+="\n"}var bJ=this.isValidRegister(bK)?this.getRegister(bK):null;if(!bJ){switch(bI){case"yank":this.registers["0"]=new a7(bL,bH,bG);break;case"delete":case"change":if(bL.indexOf("\n")==-1){this.registers["-"]=new a7(bL,bH)}else{this.shiftNumericRegisters_();this.registers["1"]=new a7(bL,bH)}break}this.unnamedRegister.setText(bL,bH,bG);return}var bF=aA(bK);if(bF){bJ.pushText(bL,bH)}else{bJ.setText(bL,bH,bG)}this.unnamedRegister.setText(bJ.toString(),bH)},getRegister:function(bF){if(!this.isValidRegister(bF)){return this.unnamedRegister}bF=bF.toLowerCase();if(!this.registers[bF]){this.registers[bF]=new a7()}return this.registers[bF]},isValidRegister:function(bF){return bF&&ar(bF,bB)},shiftNumericRegisters_:function(){for(var bF=9;bF>=2;bF--){this.registers[bF]=this.getRegister(""+(bF-1))}}};function aq(){this.historyBuffer=[];this.iterator=0;this.initialPrefix=null}aq.prototype={nextMatch:function(bJ,bL){var bH=this.historyBuffer;var bF=bL?-1:1;if(this.initialPrefix===null){this.initialPrefix=bJ}for(var bI=this.iterator+bF;bL?bI>=0:bI<bH.length;bI+=bF){var bG=bH[bI];for(var bK=0;bK<=bG.length;bK++){if(this.initialPrefix==bG.substring(0,bK)){this.iterator=bI;return bG}}}if(bI>=bH.length){this.iterator=bH.length;return this.initialPrefix}if(bI<0){return bJ}},pushInput:function(bG){var bF=this.historyBuffer.indexOf(bG);if(bF>-1){this.historyBuffer.splice(bF,1)}if(bG.length){this.historyBuffer.push(bG)}},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var r={matchCommand:function(bK,bJ,bI,bG){var bM=t(bK,bJ,bG,bI);if(!bM.full&&!bM.partial){return{type:"none"}}else{if(!bM.full&&bM.partial){return{type:"partial"}}}var bF;for(var bH=0;bH<bM.full.length;bH++){var bL=bM.full[bH];if(!bF){bF=bL}}if(bF.keys.slice(-11)=="<character>"){bI.selectedCharacter=aC(bK)}return{type:"full",command:bF}},processCommand:function(bF,bH,bG){bH.inputState.repeatOverride=bG.repeatOverride;switch(bG.type){case"motion":this.processMotion(bF,bH,bG);break;case"operator":this.processOperator(bF,bH,bG);break;case"operatorMotion":this.processOperatorMotion(bF,bH,bG);break;case"action":this.processAction(bF,bH,bG);break;case"search":this.processSearch(bF,bH,bG);break;case"ex":case"keyToEx":this.processEx(bF,bH,bG);break;default:break}},processMotion:function(bF,bH,bG){bH.inputState.motion=bG.motion;bH.inputState.motionArgs=u(bG.motionArgs);this.evalInput(bF,bH)},processOperator:function(bF,bI,bG){var bH=bI.inputState;if(bH.operator){if(bH.operator==bG.operator){bH.motion="expandToLine";bH.motionArgs={linewise:true};this.evalInput(bF,bI);return}else{l(bF)}}bH.operator=bG.operator;bH.operatorArgs=u(bG.operatorArgs);if(bI.visualMode){this.evalInput(bF,bI)}},processOperatorMotion:function(bF,bI,bG){var bJ=bI.visualMode;var bH=u(bG.operatorMotionArgs);if(bH){if(bJ&&bH.visualLine){bI.visualLine=true}}this.processOperator(bF,bI,bG);if(!bJ){this.processMotion(bF,bI,bG)}},processAction:function(bG,bL,bH){var bI=bL.inputState;var bJ=bI.getRepeat();var bK=!!bJ;var bF=u(bH.actionArgs)||{};if(bI.selectedCharacter){bF.selectedCharacter=bI.selectedCharacter}if(bH.operator){this.processOperator(bG,bL,bH)}if(bH.motion){this.processMotion(bG,bL,bH)}if(bH.motion||bH.operator){this.evalInput(bG,bL)}bF.repeat=bJ||1;bF.repeatIsExplicit=bK;bF.registerName=bI.registerName;l(bG);bL.lastMotion=null;if(bH.isEdit){this.recordLastEdit(bL,bI,bH)}g[bH.action](bG,bF,bL)},processSearch:function(bF,bS,bG){if(!bF.getSearchCursor){return}var bH=bG.searchArgs.forward;var bT=bG.searchArgs.wholeWordOnly;al(bF).setReversed(!bH);var bQ=(bH)?"/":"?";var bO=al(bF).getQuery();var bP=bF.getScrollInfo();function bI(bX,bW,bY){bD.searchHistoryController.pushInput(bX);bD.searchHistoryController.reset();try{by(bF,bX,bW,bY)}catch(bV){bk(bF,"Invalid regex: "+bX);l(bF);return}r.processMotion(bF,bS,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:bG.searchArgs.toJumplist}})}function bL(bW){bF.scrollTo(bP.left,bP.top);bI(bW,true,true);var bV=bD.macroModeState;if(bV.isRecording){aI(bV,bW)}}function bN(bW,bZ,bV){var bX=a.keyName(bW),b0;if(bX=="Up"||bX=="Down"){b0=bX=="Up"?true:false;bZ=bD.searchHistoryController.nextMatch(bZ,b0)||"";bV(bZ)}else{if(bX!="Left"&&bX!="Right"&&bX!="Ctrl"&&bX!="Alt"&&bX!="Shift"){bD.searchHistoryController.reset()}}var bY;try{bY=by(bF,bZ,true,true)}catch(bW){}if(bY){bF.scrollIntoView(aa(bF,!bH,bY),30)}else{m(bF);bF.scrollTo(bP.left,bP.top)}}function bM(bW,bY,bV){var bX=a.keyName(bW);if(bX=="Esc"||bX=="Ctrl-C"||bX=="Ctrl-["||(bX=="Backspace"&&bY=="")){bD.searchHistoryController.pushInput(bY);bD.searchHistoryController.reset();by(bF,bO);m(bF);bF.scrollTo(bP.left,bP.top);a.e_stop(bW);l(bF);bV();bF.focus()}else{if(bX=="Ctrl-U"){a.e_stop(bW);bV("")}}}switch(bG.searchArgs.querySrc){case"prompt":var bK=bD.macroModeState;if(bK.isPlaying){var bR=bK.replaySearchQueries.shift();bI(bR,true,false)}else{bl(bF,{onClose:bL,prefix:bQ,desc:be,onKeyUp:bN,onKeyDown:bM})}break;case"wordUnderCursor":var bU=V(bF,false,true,false,true);var bJ=true;if(!bU){bU=V(bF,false,true,false,false);bJ=false}if(!bU){return}var bR=bF.getLine(bU.start.line).substring(bU.start.ch,bU.end.ch);if(bJ&&bT){bR="\\b"+bR+"\\b"}else{bR=M(bR)}bD.jumpList.cachedCursor=bF.getCursor();bF.setCursor(bU.start);bI(bR,true,false);break}},processEx:function(bF,bJ,bG){function bH(bK){bD.exCommandHistoryController.pushInput(bK);bD.exCommandHistoryController.reset();N.processCommand(bF,bK)}function bI(bL,bM,bK){var bN=a.keyName(bL),bO;if(bN=="Esc"||bN=="Ctrl-C"||bN=="Ctrl-["||(bN=="Backspace"&&bM=="")){bD.exCommandHistoryController.pushInput(bM);bD.exCommandHistoryController.reset();a.e_stop(bL);l(bF);bK();bF.focus()}if(bN=="Up"||bN=="Down"){bO=bN=="Up"?true:false;bM=bD.exCommandHistoryController.nextMatch(bM,bO)||"";bK(bM)}else{if(bN=="Ctrl-U"){a.e_stop(bL);bK("")}else{if(bN!="Left"&&bN!="Right"&&bN!="Ctrl"&&bN!="Alt"&&bN!="Shift"){bD.exCommandHistoryController.reset()}}}}if(bG.type=="keyToEx"){N.processCommand(bF,bG.exArgs.input)}else{if(bJ.visualMode){bl(bF,{onClose:bH,prefix:":",value:"'<,'>",onKeyDown:bI})}else{bl(bF,{onClose:bH,prefix:":",onKeyDown:bI})}}},evalInput:function(bH,ca){var bN=ca.inputState;var bT=bN.motion;var bU=bN.motionArgs||{};var b0=bN.operator;var b1=bN.operatorArgs||{};var b6=bN.registerName;var b8=ca.sel;var b4=v(ca.visualMode?n(bH,b8.head):bH.getCursor("head"));var b3=v(ca.visualMode?n(bH,b8.anchor):bH.getCursor("anchor"));var bZ=v(b4);var bY=v(b3);var bX,bW;var b7;if(b0){this.recordLastEdit(ca,bN)}if(bN.repeatOverride!==undefined){b7=bN.repeatOverride}else{b7=bN.getRepeat()}if(b7>0&&bU.explicitRepeat){bU.repeatIsExplicit=true}else{if(bU.noRepeat||(!bU.explicitRepeat&&b7===0)){b7=1;bU.repeatIsExplicit=false}}if(bN.selectedCharacter){bU.selectedCharacter=b1.selectedCharacter=bN.selectedCharacter}bU.repeat=b7;l(bH);if(bT){var bV=aR[bT](bH,b4,bU,ca);ca.lastMotion=aR[bT];if(!bV){return}if(bU.toJumplist){var bO=bD.jumpList;var bF=bO.cachedCursor;if(bF){a4(bH,bF,bV);delete bO.cachedCursor}else{a4(bH,b4,bV)}}if(bV instanceof Array){bW=bV[0];bX=bV[1]}else{bX=bV}if(!bX){bX=v(b4)}if(ca.visualMode){if(!(ca.visualBlock&&bX.ch===Infinity)){bX=n(bH,bX,ca.visualBlock)}if(bW){bW=n(bH,bW,true)}bW=bW||bY;b8.anchor=bW;b8.head=bX;bu(bH);bx(bH,ca,"<",z(bW,bX)?bW:bX);bx(bH,ca,">",z(bW,bX)?bX:bW)}else{if(!b0){bX=n(bH,bX);bH.setCursor(bX.line,bX.ch)}}}if(b0){if(b1.lastSel){bW=bY;var bP=b1.lastSel;var bQ=Math.abs(bP.head.line-bP.anchor.line);var bG=Math.abs(bP.head.ch-bP.anchor.ch);if(bP.visualLine){bX=d(bY.line+bQ,bY.ch)}else{if(bP.visualBlock){bX=d(bY.line+bQ,bY.ch+bG)}else{if(bP.head.line==bP.anchor.line){bX=d(bY.line,bY.ch+bG)}else{bX=d(bY.line+bQ,bY.ch)}}}ca.visualMode=true;ca.visualLine=bP.visualLine;ca.visualBlock=bP.visualBlock;b8=ca.sel={anchor:bW,head:bX};bu(bH)}else{if(ca.visualMode){b1.lastSel={anchor:v(b8.anchor),head:v(b8.head),visualBlock:ca.visualBlock,visualLine:ca.visualLine}}}var bK,bJ,bR,bS;var bI;if(ca.visualMode){bK=C(b8.head,b8.anchor);bJ=B(b8.head,b8.anchor);bR=ca.visualLine||b1.linewise;bS=ca.visualBlock?"block":bR?"line":"char";bI=aL(bH,{anchor:bK,head:bJ},bS);if(bR){var b5=bI.ranges;if(bS=="block"){for(var bM=0;bM<b5.length;bM++){b5[bM].head.ch=aF(bH,b5[bM].head.line)}}else{if(bS=="line"){b5[0].head=d(b5[0].head.line+1,0)}}}}else{bK=v(bW||bY);bJ=v(bX||bZ);if(z(bJ,bK)){var b9=bK;bK=bJ;bJ=b9}bR=bU.linewise||b1.linewise;if(bR){U(bH,bK,bJ)}else{if(bU.forward){o(bH,bK,bJ)}}bS="char";var bL=!bU.inclusive||bR;bI=aL(bH,{anchor:bK,head:bJ},bS,bL)}bH.setSelections(bI.ranges,bI.primary);ca.lastMotion=null;b1.repeat=b7;b1.registerName=b6;b1.linewise=bR;var b2=a1[b0](bH,b1,bI.ranges,bY,bX);if(ca.visualMode){S(bH,b2!=null)}if(b2){bH.setCursor(b2)}}},recordLastEdit:function(bI,bG,bF){var bH=bD.macroModeState;if(bH.isPlaying){return}bI.lastEditInputState=bG;bI.lastEditActionCommand=bF;bH.lastInsertModeChanges.changes=[];bH.lastInsertModeChanges.expectCursorActivityForChange=false}};var aR={moveToTopLine:function(bG,bF,bI){var bH=an(bG).top+bI.repeat-1;return d(bH,Z(bG.getLine(bH)))},moveToMiddleLine:function(bF){var bH=an(bF);var bG=Math.floor((bH.top+bH.bottom)*0.5);return d(bG,Z(bF.getLine(bG)))},moveToBottomLine:function(bG,bF,bI){var bH=an(bG).bottom-bI.repeat+1;return d(bH,Z(bG.getLine(bH)))},expandToLine:function(bF,bH,bI){var bG=bH;return d(bG.line+bI.repeat-1,Infinity)},findNext:function(bG,bF,bH){var bK=al(bG);var bJ=bK.getQuery();if(!bJ){return}var bI=!bH.forward;bI=(bK.isReversed())?!bI:bI;ap(bG,bJ);return aa(bG,bI,bJ,bH.repeat)},goToMark:function(bG,bF,bI,bK){var bH=bK.marks[bI.selectedCharacter];if(bH){var bJ=bH.find();return bI.linewise?{line:bJ.line,ch:Z(bG.getLine(bJ.line))}:bJ}return null},moveToOtherHighlightedEnd:function(bG,bF,bH,bJ){if(bJ.visualBlock&&bH.sameLine){var bI=bJ.sel;return[n(bG,d(bI.anchor.line,bI.head.ch)),n(bG,d(bI.head.line,bI.anchor.ch))]}else{return([bJ.sel.head,bJ.sel.anchor])}},jumpToMark:function(bH,bK,bP,bQ){var bF=bK;for(var bL=0;bL<bP.repeat;bL++){var bI=bF;for(var bN in bQ.marks){if(!ax(bN)){continue}var bO=bQ.marks[bN].find();var bM=(bP.forward)?z(bO,bI):z(bI,bO);if(bM){continue}if(bP.linewise&&(bO.line==bI.line)){continue}var bJ=y(bI,bF);var bG=(bP.forward)?A(bI,bO,bF):A(bF,bO,bI);if(bJ||bG){bF=bO}}}if(bP.linewise){bF=d(bF.line,Z(bH.getLine(bF.line)))}return bF},moveByCharacters:function(bF,bI,bJ){var bH=bI;var bK=bJ.repeat;var bG=bJ.forward?bH.ch+bK:bH.ch-bK;return d(bH.line,bG)},moveByLines:function(bF,bJ,bM,bO){var bG=bJ;var bH=bG.ch;switch(bO.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:bH=bO.lastHPos;break;default:bO.lastHPos=bH}var bN=bM.repeat+(bM.repeatOffset||0);var bL=bM.forward?bG.line+bN:bG.line-bN;var bI=bF.firstLine();var bK=bF.lastLine();if(bL<bI&&bG.line==bI){return this.moveToStartOfLine(bF,bJ,bM,bO)}else{if(bL>bK&&bG.line==bK){return this.moveToEol(bF,bJ,bM,bO)}}if(bM.toFirstChar){bH=Z(bF.getLine(bL));bO.lastHPos=bH}bO.lastHSPos=bF.charCoords(d(bL,bH),"div").left;return d(bL,bH)},moveByDisplayLines:function(bF,bI,bK,bO){var bG=bI;switch(bO.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:bO.lastHSPos=bF.charCoords(bG,"div").left}var bL=bK.repeat;var bM=bF.findPosV(bG,(bK.forward?bL:-bL),"line",bO.lastHSPos);if(bM.hitSide){if(bK.forward){var bJ=bF.charCoords(bM,"div");var bH={top:bJ.top+8,left:bO.lastHSPos};var bM=bF.coordsChar(bH,"div")}else{var bN=bF.charCoords(d(bF.firstLine(),0),"div");bN.left=bO.lastHSPos;bM=bF.coordsChar(bN,"div")}}bO.lastHPos=bM.ch;return bM},moveByPage:function(bF,bH,bI){var bG=bH;var bJ=bI.repeat;return bF.findPosV(bG,(bI.forward?bJ:-bJ),"page")},moveByParagraph:function(bF,bH,bI){var bG=bI.forward?1:-1;return ab(bF,bH,bI.repeat,bG)},moveByScroll:function(bF,bI,bJ,bN){var bM=bF.getScrollInfo();var bG=null;var bL=bJ.repeat;if(!bL){bL=bM.clientHeight/(2*bF.defaultTextHeight())}var bK=bF.charCoords(bI,"local");bJ.repeat=bL;var bG=aR.moveByDisplayLines(bF,bI,bJ,bN);if(!bG){return null}var bH=bF.charCoords(bG,"local");bF.scrollTo(null,bM.top+bH.top-bK.top);return bG},moveByWords:function(bF,bG,bH){return aU(bF,bG,bH.repeat,!!bH.forward,!!bH.wordEnd,!!bH.bigWord)},moveTillCharacter:function(bG,bF,bJ){var bK=bJ.repeat;var bH=aS(bG,bK,bJ.forward,bJ.selectedCharacter);var bI=bJ.forward?-1:1;a5(bI,bJ);if(!bH){return null}bH.ch+=bI;return bH},moveToCharacter:function(bF,bG,bH){var bI=bH.repeat;a5(0,bH);return aS(bF,bI,bH.forward,bH.selectedCharacter)||bG},moveToSymbol:function(bF,bG,bH){var bI=bH.repeat;return ac(bF,bI,bH.forward,bH.selectedCharacter)||bG},moveToColumn:function(bF,bG,bH,bJ){var bI=bH.repeat;bJ.lastHPos=bI-1;bJ.lastHSPos=bF.charCoords(bG,"div").left;return aT(bF,bI)},moveToEol:function(bF,bI,bJ,bL){var bG=bI;bL.lastHPos=Infinity;var bK=d(bG.line+bJ.repeat-1,Infinity);var bH=bF.clipPos(bK);bH.ch--;bL.lastHSPos=bF.charCoords(bH,"div").left;return bK},moveToFirstNonWhiteSpaceCharacter:function(bF,bH){var bG=bH;return d(bG.line,Z(bF.getLine(bG.line)))},moveToMatchedSymbol:function(bG,bI){var bH=bI;var bJ=bH.line;var bF=bH.ch;var bK=bG.getLine(bJ);var bN;do{bN=bK.charAt(bF++);if(bN&&ay(bN)){var bM=bG.getTokenTypeAt(d(bJ,bF));if(bM!=="string"&&bM!=="comment"){break}}}while(bN);if(bN){var bL=bG.findMatchingBracket(d(bJ,bF));return bL.to}else{return bH}},moveToStartOfLine:function(bF,bG){return d(bG.line,0)},moveToLineOrEdgeOfDocument:function(bG,bF,bI){var bH=bI.forward?bG.lastLine():bG.firstLine();if(bI.repeatIsExplicit){bH=bI.repeat-bG.getOption("firstLineNumber")}return d(bH,Z(bG.getLine(bH)))},textObjectManipulation:function(bG,bH,bK,bO){var bJ={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["};var bM={"'":true,'"':true};var bF=bK.selectedCharacter;if(bF=="b"){bF="("}else{if(bF=="B"){bF="{"}}var bI=!bK.textObjectInner;var bN;if(bJ[bF]){bN=bh(bG,bH,bF,bI)}else{if(bM[bF]){bN=Y(bG,bH,bF,bI)}else{if(bF==="W"){bN=V(bG,bI,true,true)}else{if(bF==="w"){bN=V(bG,bI,true,false)}else{if(bF==="p"){bN=ab(bG,bH,bK.repeat,0,bI);bK.linewise=true;if(bO.visualMode){if(!bO.visualLine){bO.visualLine=true}}else{var bL=bO.inputState.operatorArgs;if(bL){bL.linewise=true}bN.end.line--}}else{return null}}}}}if(!bG.state.vim.visualMode){return[bN.start,bN.end]}else{return T(bG,bN.start,bN.end)}},repeatLastCharacterSearch:function(bF,bI,bL){var bK=bD.lastCharacterSearch;var bM=bL.repeat;var bH=bL.forward===bK.forward;var bJ=(bK.increment?1:0)*(bH?-1:1);bF.moveH(-bJ,"char");bL.inclusive=bH?true:false;var bG=aS(bF,bM,bH,bK.selectedCharacter);if(!bG){bF.moveH(bJ,"char");return bI}bG.ch+=bJ;return bG}};function E(bG,bF){aR[bG]=bF}function X(bI,bH){var bF=[];for(var bG=0;bG<bH;bG++){bF.push(bI)}return bF}var a1={change:function(bH,bG,bN){var bI,bP;var bQ=bH.state.vim;bD.macroModeState.lastInsertModeChanges.inVisualBlock=bQ.visualBlock;if(!bQ.visualMode){var bF=bN[0].anchor,bJ=bN[0].head;bP=bH.getRange(bF,bJ);var bK=bQ.lastEditInputState||{};if(bK.motion=="moveByWords"&&!aB(bP)){var bL=(/\s+$/).exec(bP);if(bL&&bK.motionArgs&&bK.motionArgs.forward){bJ=aX(bJ,0,-bL[0].length);bP=bP.slice(0,-bL[0].length)}}var bM=new d(bF.line-1,Number.MAX_VALUE);var bR=bH.firstLine()==bH.lastLine();if(bJ.line>bH.lastLine()&&bG.linewise&&!bR){bH.replaceRange("",bM,bJ)}else{bH.replaceRange("",bF,bJ)}if(bG.linewise){if(!bR){bH.setCursor(bM);a.commands.newlineAndIndent(bH)}bF.ch=Number.MAX_VALUE}bI=bF}else{bP=bH.getSelection();var bO=X("",bN.length);bH.replaceSelections(bO);bI=C(bN[0].head,bN[0].anchor)}bD.registerController.pushText(bG.registerName,"change",bP,bG.linewise,bN.length>1);g.enterInsertMode(bH,{head:bI},bH.state.vim)},"delete":function(bH,bG,bK){var bI,bM;var bN=bH.state.vim;if(!bN.visualBlock){var bF=bK[0].anchor,bJ=bK[0].head;if(bG.linewise&&bJ.line!=bH.firstLine()&&bF.line==bH.lastLine()&&bF.line==bJ.line-1){if(bF.line==bH.firstLine()){bF.ch=0}else{bF=d(bF.line-1,aF(bH,bF.line-1))}}bM=bH.getRange(bF,bJ);bH.replaceRange("",bF,bJ);bI=bF;if(bG.linewise){bI=aR.moveToFirstNonWhiteSpaceCharacter(bH,bF)}}else{bM=bH.getSelection();var bL=X("",bK.length);bH.replaceSelections(bL);bI=bK[0].anchor}bD.registerController.pushText(bG.registerName,"delete",bM,bG.linewise,bN.visualBlock);return n(bH,bI)},indent:function(bG,bF,bK){var bN=bG.state.vim;var bM=bK[0].anchor.line;var bH=bN.visualBlock?bK[bK.length-1].anchor.line:bK[0].head.line;var bL=(bN.visualMode)?bF.repeat:1;if(bF.linewise){bH--}for(var bI=bM;bI<=bH;bI++){for(var bJ=0;bJ<bL;bJ++){bG.indentLine(bI,bF.indentRight)}}return aR.moveToFirstNonWhiteSpaceCharacter(bG,bK[0].anchor)},changeCase:function(bH,bF,bM,bL,bK){var bN=bH.getSelections();var bO=[];var bQ=bF.toLower;for(var bJ=0;bJ<bN.length;bJ++){var bR=bN[bJ];var bP="";if(bQ===true){bP=bR.toLowerCase()}else{if(bQ===false){bP=bR.toUpperCase()}else{for(var bI=0;bI<bR.length;bI++){var bG=bR.charAt(bI);bP+=aA(bG)?bG.toLowerCase():bG.toUpperCase()}}}bO.push(bP)}bH.replaceSelections(bO);if(bF.shouldMoveCursor){return bK}else{if(!bH.state.vim.visualMode&&bF.linewise&&bM[0].anchor.line+1==bM[0].head.line){return aR.moveToFirstNonWhiteSpaceCharacter(bH,bL)}else{if(bF.linewise){return bL}else{return C(bM[0].anchor,bM[0].head)}}}},yank:function(bG,bF,bJ,bI){var bL=bG.state.vim;var bK=bG.getSelection();var bH=bL.visualMode?C(bL.sel.anchor,bL.sel.head,bJ[0].head,bJ[0].anchor):bI;bD.registerController.pushText(bF.registerName,"yank",bK,bF.linewise,bL.visualBlock);return bH}};function F(bG,bF){a1[bG]=bF}var g={jumpListWalk:function(bG,bF,bM){if(bM.visualMode){return}var bL=bF.repeat;var bH=bF.forward;var bI=bD.jumpList;var bJ=bI.move(bG,bH?bL:-bL);var bK=bJ?bJ.find():undefined;bK=bK?bK:bG.getCursor();bG.setCursor(bK)},scroll:function(bG,bF,bP){if(bP.visualMode){return}var bN=bF.repeat||1;var bK=bG.defaultTextHeight();var bO=bG.getScrollInfo().top;var bJ=bK*bN;var bM=bF.forward?bO+bJ:bO-bJ;var bH=v(bG.getCursor());var bI=bG.charCoords(bH,"local");if(bF.forward){if(bM>bI.top){bH.line+=(bM-bI.top)/bK;bH.line=Math.ceil(bH.line);bG.setCursor(bH);bI=bG.charCoords(bH,"local");bG.scrollTo(null,bI.top)}else{bG.scrollTo(null,bM)}}else{var bL=bM+bG.getScrollInfo().clientHeight;if(bL<bI.bottom){bH.line-=(bI.bottom-bL)/bK;bH.line=Math.floor(bH.line);bG.setCursor(bH);bI=bG.charCoords(bH,"local");bG.scrollTo(null,bI.bottom-bG.getScrollInfo().clientHeight)}else{bG.scrollTo(null,bM)}}},scrollToCursor:function(bH,bF){var bK=bH.getCursor().line;var bG=bH.charCoords(d(bK,0),"local");var bI=bH.getScrollInfo().clientHeight;var bL=bG.top;var bJ=bG.bottom-bL;switch(bF.position){case"center":bL=bL-(bI/2)+bJ;break;case"bottom":bL=bL-bI+bJ;break}bH.scrollTo(null,bL)},replayMacro:function(bG,bF,bK){var bI=bF.selectedCharacter;var bJ=bF.repeat;var bH=bD.macroModeState;if(bI=="@"){bI=bH.latestRegister}while(bJ--){Q(bG,bK,bH,bI)}},enterMacroRecordMode:function(bG,bF){var bH=bD.macroModeState;var bI=bF.selectedCharacter;bH.enterMacroRecordMode(bG,bI)},toggleOverwrite:function(bF){if(!bF.state.overwrite){bF.toggleOverwrite(true);bF.setOption("keyMap","vim-replace");a.signal(bF,"vim-mode-change",{mode:"replace"})}else{bF.toggleOverwrite(false);bF.setOption("keyMap","vim-insert");a.signal(bF,"vim-mode-change",{mode:"insert"})}},enterInsertMode:function(bG,bF,bL){if(bG.getOption("readOnly")){return}bL.insertMode=true;bL.insertModeRepeat=bF&&bF.repeat||1;var bJ=(bF)?bF.insertAt:null;var bK=bL.sel;var bH=bF.head||bG.getCursor("head");var bI=bG.listSelections().length;if(bJ=="eol"){bH=d(bH.line,aF(bG,bH.line))}else{if(bJ=="charAfter"){bH=aX(bH,0,1)}else{if(bJ=="firstNonBlank"){bH=aR.moveToFirstNonWhiteSpaceCharacter(bG,bH)}else{if(bJ=="startOfSelectedArea"){if(!bL.visualBlock){if(bK.head.line<bK.anchor.line){bH=bK.head}else{bH=d(bK.anchor.line,0)}}else{bH=d(Math.min(bK.head.line,bK.anchor.line),Math.min(bK.head.ch,bK.anchor.ch));bI=Math.abs(bK.head.line-bK.anchor.line)+1}}else{if(bJ=="endOfSelectedArea"){if(!bL.visualBlock){if(bK.head.line>=bK.anchor.line){bH=aX(bK.head,0,1)}else{bH=d(bK.anchor.line,0)}}else{bH=d(Math.min(bK.head.line,bK.anchor.line),Math.max(bK.head.ch+1,bK.anchor.ch));bI=Math.abs(bK.head.line-bK.anchor.line)+1}}else{if(bJ=="inplace"){if(bL.visualMode){return}}}}}}}bG.setOption("disableInput",false);if(bF&&bF.replace){bG.toggleOverwrite(true);bG.setOption("keyMap","vim-replace");a.signal(bG,"vim-mode-change",{mode:"replace"})}else{bG.toggleOverwrite(false);bG.setOption("keyMap","vim-insert");a.signal(bG,"vim-mode-change",{mode:"insert"})}if(!bD.macroModeState.isPlaying){bG.on("change",aY);a.on(bG.getInputField(),"keydown",a0)}if(bL.visualMode){S(bG)}bi(bG,bH,bI)},toggleVisualMode:function(bH,bF,bK){var bJ=bF.repeat;var bG=bH.getCursor();var bI;if(!bK.visualMode){bK.visualMode=true;bK.visualLine=!!bF.linewise;bK.visualBlock=!!bF.blockwise;bI=n(bH,d(bG.line,bG.ch+bJ-1),true);bK.sel={anchor:bG,head:bI};a.signal(bH,"vim-mode-change",{mode:"visual",subMode:bK.visualLine?"linewise":bK.visualBlock?"blockwise":""});bu(bH);bx(bH,bK,"<",C(bG,bI));bx(bH,bK,">",B(bG,bI))}else{if(bK.visualLine^bF.linewise||bK.visualBlock^bF.blockwise){bK.visualLine=!!bF.linewise;bK.visualBlock=!!bF.blockwise;a.signal(bH,"vim-mode-change",{mode:"visual",subMode:bK.visualLine?"linewise":bK.visualBlock?"blockwise":""});bu(bH)}else{S(bH)}}},reselectLastSelection:function(bH,bF,bK){var bJ=bK.lastSelection;if(bK.visualMode){bw(bH,bK)}if(bJ){var bG=bJ.anchorMark.find();var bI=bJ.headMark.find();if(!bG||!bI){return}bK.sel={anchor:bG,head:bI};bK.visualMode=true;bK.visualLine=bJ.visualLine;bK.visualBlock=bJ.visualBlock;bu(bH);bx(bH,bK,"<",C(bG,bI));bx(bH,bK,">",B(bG,bI));a.signal(bH,"vim-mode-change",{mode:"visual",subMode:bK.visualLine?"linewise":bK.visualBlock?"blockwise":""})}},joinLines:function(bG,bF,bP){var bJ,bH;if(bP.visualMode){bJ=bG.getCursor("anchor");bH=bG.getCursor("head");if(z(bH,bJ)){var bO=bH;bH=bJ;bJ=bO}bH.ch=aF(bG,bH.line)-1}else{var bM=Math.max(bF.repeat,2);bJ=bG.getCursor();bH=n(bG,d(bJ.line+bM-1,Infinity))}var bK=0;for(var bL=bJ.line;bL<bH.line;bL++){bK=aF(bG,bJ.line);var bO=d(bJ.line+1,aF(bG,bJ.line+1));var bN=bG.getRange(bJ,bO);bN=bN.replace(/\n\s*/g," ");bG.replaceRange(bN,bJ,bO)}var bI=d(bJ.line,bK);if(bP.visualMode){S(bG,false)}bG.setCursor(bI)},newLineAndEnterInsertMode:function(bG,bF,bJ){bJ.insertMode=true;var bH=v(bG.getCursor());if(bH.line===bG.firstLine()&&!bF.after){bG.replaceRange("\n",d(bG.firstLine(),0));bG.setCursor(bG.firstLine(),0)}else{bH.line=(bF.after)?bH.line:bH.line-1;bH.ch=aF(bG,bH.line);bG.setCursor(bH);var bI=a.commands.newlineAndIndentContinueComment||a.commands.newlineAndIndent;bI(bG)}this.enterInsertMode(bG,{repeat:bF.repeat},bJ)},paste:function(bI,bF,b3){var bJ=v(bI.getCursor());var bV=bD.registerController.getRegister(bF.registerName);var b2=bV.toString();if(!b2){return}if(bF.matchIndent){var b1=bI.getOption("tabSize");var b5=function(b7){var b8=(b7.split("\t").length-1);var b6=(b7.split(" ").length-1);return b8*b1+b6*1};var bL=bI.getLine(bI.getCursor().line);var bQ=b5(bL.match(/^\s*/)[0]);var bH=b2.replace(/\n$/,"");var b4=b2!==bH;var bN=b5(b2.match(/^\s*/)[0]);var b2=bH.replace(/^\s*/gm,function(b8){var b6=bQ+(b5(b8)-bN);if(b6<0){return""}else{if(bI.getOption("indentWithTabs")){var b7=Math.floor(b6/b1);return Array(b7+1).join("\t")}else{return Array(b6+1).join(" ")}}});b2+=b4?"\n":""}if(bF.repeat>1){var b2=Array(bF.repeat+1).join(b2)}var bU=bV.linewise;var bG=bV.blockwise;if(bU){if(b3.visualMode){b2=b3.visualLine?b2.slice(0,-1):"\n"+b2.slice(0,b2.length-1)+"\n"}else{if(bF.after){b2="\n"+b2.slice(0,b2.length-1);bJ.ch=aF(bI,bJ.line)}else{bJ.ch=0}}}else{if(bG){b2=b2.split("\n");for(var bO=0;bO<b2.length;bO++){b2[bO]=(b2[bO]=="")?" ":b2[bO]}}bJ.ch+=bF.after?1:0}var bK;var bP;if(b3.visualMode){b3.lastPastedText=b2;var bS;var bW=am(bI,b3);var b0=bW[0];var bY=bW[1];var bX=bI.getSelection();var bZ=bI.listSelections();var bM=new Array(bZ.length).join("1").split("1");if(b3.lastSelection){bS=b3.lastSelection.headMark.find()}bD.registerController.unnamedRegister.setText(bX);if(bG){bI.replaceSelections(bM);bY=d(b0.line+b2.length-1,b0.ch);bI.setCursor(b0);bg(bI,bY);bI.replaceSelections(b2);bK=b0}else{if(b3.visualBlock){bI.replaceSelections(bM);bI.setCursor(b0);bI.replaceRange(b2,b0,b0);bK=b0}else{bI.replaceRange(b2,b0,bY);bK=bI.posFromIndex(bI.indexFromPos(b0)+b2.length-1)}}if(bS){b3.lastSelection.headMark=bI.setBookmark(bS)}if(bU){bK.ch=0}}else{if(bG){bI.setCursor(bJ);for(var bO=0;bO<b2.length;bO++){var bT=bJ.line+bO;if(bT>bI.lastLine()){bI.replaceRange("\n",d(bT,0))}var bR=aF(bI,bT);if(bR<bJ.ch){W(bI,bT,bJ.ch)}}bI.setCursor(bJ);bg(bI,d(bJ.line+b2.length-1,bJ.ch));bI.replaceSelections(b2);bK=bJ}else{bI.replaceRange(b2,bJ);if(bU&&bF.after){bK=d(bJ.line+1,Z(bI.getLine(bJ.line+1)))}else{if(bU&&!bF.after){bK=d(bJ.line,Z(bI.getLine(bJ.line)))}else{if(!bU&&bF.after){bP=bI.indexFromPos(bJ);bK=bI.posFromIndex(bP+b2.length-1)}else{bP=bI.indexFromPos(bJ);bK=bI.posFromIndex(bP+b2.length)}}}}}if(b3.visualMode){S(bI,false)}bI.setCursor(bK)},undo:function(bG,bF){bG.operation(function(){a9(bG,a.commands.undo,bF.repeat)();bG.setCursor(bG.getCursor("anchor"))})},redo:function(bG,bF){a9(bG,a.commands.redo,bF.repeat)()},setRegister:function(bF,bG,bH){bH.inputState.registerName=bG.selectedCharacter},setMark:function(bG,bF,bI){var bH=bF.selectedCharacter;bx(bG,bI,bH,bG.getCursor())},replace:function(bG,bF,bP){var bL=bF.selectedCharacter;var bI=bG.getCursor();var bK;var bH;var bN=bG.listSelections();if(bP.visualMode){bI=bG.getCursor("start");bH=bG.getCursor("end")}else{var bJ=bG.getLine(bI.line);bK=bI.ch+bF.repeat;if(bK>bJ.length){bK=bJ.length}bH=d(bI.line,bK)}if(bL=="\n"){if(!bP.visualMode){bG.replaceRange("",bI,bH)}(a.commands.newlineAndIndentContinueComment||a.commands.newlineAndIndent)(bG)}else{var bM=bG.getRange(bI,bH);bM=bM.replace(/[^\n]/g,bL);if(bP.visualBlock){var bO=new Array(bG.getOption("tabSize")+1).join(" ");bM=bG.getSelection();bM=bM.replace(/\t/g,bO).replace(/[^\n]/g,bL).split("\n");bG.replaceSelections(bM)}else{bG.replaceRange(bM,bI,bH)}if(bP.visualMode){bI=z(bN[0].anchor,bN[0].head)?bN[0].anchor:bN[0].head;bG.setCursor(bI);S(bG,false)}else{bG.setCursor(aX(bH,0,-1))}}},incrementNumberToken:function(bG,bF){var bH=bG.getCursor();var bL=bG.getLine(bH.line);var bP=/-?\d+/g;var bM;var bQ;var bI;var bO;var bS;while((bM=bP.exec(bL))!==null){bS=bM[0];bQ=bM.index;bI=bQ+bS.length;if(bH.ch<bI){break}}if(!bF.backtrack&&(bI<=bH.ch)){return}if(bS){var bK=bF.increase?1:-1;var bN=parseInt(bS)+(bK*bF.repeat);var bJ=d(bH.line,bQ);var bR=d(bH.line,bI);bO=bN.toString();bG.replaceRange(bO,bJ,bR)}else{return}bG.setCursor(d(bH.line,bQ+bO.length-1))},repeatLastEdit:function(bG,bF,bJ){var bH=bJ.lastEditInputState;if(!bH){return}var bI=bF.repeat;if(bI&&bF.repeatIsExplicit){bJ.lastEditInputState.repeatOverride=bI}else{bI=bJ.lastEditInputState.repeatOverride||bI}bb(bG,bJ,bI,false)},exitInsertMode:R};function D(bG,bF){g[bG]=bF}function n(bG,bH,bI){var bJ=Math.min(Math.max(bG.firstLine(),bH.line),bG.lastLine());var bK=aF(bG,bJ)-1;bK=(bI)?bK+1:bK;var bF=Math.min(Math.max(0,bH.ch),bK);return d(bJ,bF)}function u(bF){var bH={};for(var bG in bF){if(bF.hasOwnProperty(bG)){bH[bG]=bF[bG]}}return bH}function aX(bF,bH,bG){if(typeof bH==="object"){bG=bH.ch;bH=bH.line}return d(bF.line+bH,bF.ch+bG)}function ai(bF,bG){return{line:bG.line-bF.line,ch:bG.line-bF.line}}function t(bL,bK,bG,bJ){var bM,bN=[],bH=[];for(var bI=0;bI<bK.length;bI++){var bF=bK[bI];if(bG=="insert"&&bF.context!="insert"||bF.context&&bF.context!=bG||bJ.operator&&bF.type=="action"||!(bM=s(bL,bF.keys))){continue}if(bM=="partial"){bN.push(bF)}if(bM=="full"){bH.push(bF)}}return{partial:bN.length&&bN,full:bH.length&&bH}}function s(bI,bF){if(bF.slice(-11)=="<character>"){var bH=bF.length-11;var bJ=bI.slice(0,bH);var bG=bF.slice(0,bH);return bJ==bG&&bI.length>bH?"full":bG.indexOf(bJ)==0?"partial":false}else{return bI==bF?"full":bF.indexOf(bI)==0?"partial":false}}function aC(bF){var bG=/^.*(<[\w\-]+>)$/.exec(bF);var bH=bG?bG[1]:bF.slice(-1);if(bH.length>1){switch(bH){case"<CR>":bH="\n";break;case"<Space>":bH=" ";break;default:break}}return bH}function a9(bF,bG,bH){return function(){for(var bI=0;bI<bH;bI++){bG(bF)}}}function v(bF){return d(bF.line,bF.ch)}function y(bF,bG){return bF.ch==bG.ch&&bF.line==bG.line}function z(bF,bG){if(bF.line<bG.line){return true}if(bF.line==bG.line&&bF.ch<bG.ch){return true}return false}function C(bF,bG){if(arguments.length>2){bG=C.apply(undefined,Array.prototype.slice.call(arguments,1))}return z(bF,bG)?bF:bG}function B(bF,bG){if(arguments.length>2){bG=B.apply(undefined,Array.prototype.slice.call(arguments,1))}return z(bF,bG)?bG:bF}function A(bF,bH,bJ){var bG=z(bF,bH);var bI=z(bH,bJ);return bG&&bI}function aF(bF,bG){return bF.getLine(bG).length}function br(bF){if(bF.trim){return bF.trim()}return bF.replace(/^\s+|\s+$/g,"")}function M(bF){return bF.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function W(bF,bI,bG){var bH=aF(bF,bI);var bJ=new Array(bG-bH+1).join(" ");bF.setCursor(d(bI,bH));bF.replaceRange(bJ,bF.getCursor())}function bg(bH,bW){var bX=[],bV=bH.listSelections();var bL=v(bH.clipPos(bW));var bO=!y(bW,bL);var bI=bH.getCursor("head");var bT=ah(bV,bI);var bY=y(bV[bT].head,bV[bT].anchor);var bR=bV.length-1;var bN=bR-bT>bT?bR:0;var bF=bV[bN].anchor;var bK=Math.min(bF.line,bL.line);var bP=Math.max(bF.line,bL.line);var bG=bF.ch,bM=bL.ch;var bJ=bV[bN].head.ch-bG;var bS=bM-bG;if(bJ>0&&bS<=0){bG++;if(!bO){bM--}}else{if(bJ<0&&bS>=0){bG--;if(!bY){bM++}}else{if(bJ<0&&bS==-1){bG--;bM++}}}for(var bQ=bK;bQ<=bP;bQ++){var bU={anchor:new d(bQ,bG),head:new d(bQ,bM)};bX.push(bU)}bT=bL.line==bP?bX.length-1:0;bH.setSelections(bX);bW.ch=bM;bF.ch=bG;return bF}function bi(bF,bG,bH){var bK=[];for(var bI=0;bI<bH;bI++){var bJ=aX(bG,bI,0);bK.push({anchor:bJ,head:bJ})}bF.setSelections(bK,0)}function ah(bK,bH,bI){for(var bJ=0;bJ<bK.length;bJ++){var bF=bI!="head"&&y(bK[bJ].anchor,bH);var bG=bI!="anchor"&&y(bK[bJ].head,bH);if(bF||bG){return bJ}}return -1}function am(bF,bJ){var bI=bJ.lastSelection;var bG=function(){var bM=bF.listSelections();var bO=bM[0];var bK=bM[bM.length-1];var bN=z(bO.anchor,bO.head)?bO.anchor:bO.head;var bL=z(bK.anchor,bK.head)?bK.head:bK.anchor;return[bN,bL]};var bH=function(){var bV=bF.getCursor();var bT=bF.getCursor();var bL=bI.visualBlock;if(bL){var bX=bL.width;var bP=bL.height;bT=d(bV.line+bP,bV.ch+bX);var bU=[];for(var bQ=bV.line;bQ<bT.line;bQ++){var bK=d(bQ,bV.ch);var bO=d(bQ,bT.ch);var bS={anchor:bK,head:bO};bU.push(bS)}bF.setSelections(bU)}else{var bW=bI.anchorMark.find();var bN=bI.headMark.find();var bR=bN.line-bW.line;var bM=bN.ch-bW.ch;bT={line:bT.line+bR,ch:bR?bT.ch:bM+bT.ch};if(bI.visualLine){bV=d(bV.line,0);bT=d(bT.line,aF(bF,bT.line))}bF.setSelection(bV,bT)}return[bV,bT]};if(!bJ.visualMode){return bH()}else{return bG()}}function bw(bG,bI){var bF=bI.sel.anchor;var bH=bI.sel.head;if(bI.lastPastedText){bH=bG.posFromIndex(bG.indexFromPos(bF)+bI.lastPastedText.length);bI.lastPastedText=null}bI.lastSelection={anchorMark:bG.setBookmark(bF),headMark:bG.setBookmark(bH),anchor:v(bF),head:v(bH),visualMode:bI.visualMode,visualLine:bI.visualLine,visualBlock:bI.visualBlock}}function T(bG,bK,bH){var bJ=bG.state.vim.sel;var bI=bJ.head;var bF=bJ.anchor;var bL;if(z(bH,bK)){bL=bH;bH=bK;bK=bL}if(z(bI,bF)){bI=C(bK,bI);bF=B(bF,bH)}else{bF=C(bK,bF);bI=B(bI,bH);bI=aX(bI,0,-1);if(bI.ch==-1&&bI.line!=bG.firstLine()){bI=d(bI.line-1,aF(bG,bI.line-1))}}return[bF,bI]}function bu(bF,bI,bH){var bJ=bF.state.vim;bI=bI||bJ.sel;var bH=bH||bJ.visualLine?"line":bJ.visualBlock?"block":"char";var bG=aL(bF,bI,bH);bF.setSelections(bG.ranges,bG.primary);bv(bF)}function aL(bI,bU,bQ,bJ){var bK=v(bU.head);var bF=v(bU.anchor);if(bQ=="char"){var bL=!bJ&&!z(bU.head,bU.anchor)?1:0;var bG=z(bU.head,bU.anchor)?1:0;bK=aX(bU.head,0,bL);bF=aX(bU.anchor,0,bG);return{ranges:[{anchor:bF,head:bK}],primary:0}}else{if(bQ=="line"){if(!z(bU.head,bU.anchor)){bF.ch=0;var bO=bI.lastLine();if(bK.line>bO){bK.line=bO}bK.ch=aF(bI,bK.line)}else{bK.ch=0;bF.ch=aF(bI,bF.line)}return{ranges:[{anchor:bF,head:bK}],primary:0}}else{if(bQ=="block"){var bV=Math.min(bF.line,bK.line),bP=Math.min(bF.ch,bK.ch),bH=Math.max(bF.line,bK.line),bT=Math.max(bF.ch,bK.ch)+1;var bM=bH-bV+1;var bR=bK.line==bV?0:bM-1;var bS=[];for(var bN=0;bN<bM;bN++){bS.push({anchor:d(bV+bN,bP),head:d(bV+bN,bT)})}return{ranges:bS,primary:bR}}}}}function ag(bF){var bG=bF.getCursor("head");if(bF.getSelection().length==1){bG=C(bG,bF.getCursor("anchor"))}return bG}function S(bF,bG){var bH=bF.state.vim;if(bG!==false){bF.setCursor(n(bF,bH.sel.head))}bw(bF,bH);bH.visualMode=false;bH.visualLine=false;bH.visualBlock=false;a.signal(bF,"vim-mode-change",{mode:"normal"});if(bH.fakeCursor){bH.fakeCursor.clear()}}function o(bF,bH,bG){var bK=bF.getRange(bH,bG);if(/\n\s*$/.test(bK)){var bJ=bK.split("\n");bJ.pop();var bI;for(var bI=bJ.pop();bJ.length>0&&bI&&aB(bI);bI=bJ.pop()){bG.line--;bG.ch=0}if(bI){bG.line--;bG.ch=aF(bF,bG.line)}else{bG.ch=0}}}function U(bF,bH,bG){bH.ch=0;bG.ch=0;bG.line++}function Z(bG){if(!bG){return 0}var bF=bG.search(/\S/);return bF==-1?bG.length:bF}function V(bH,bL,bF,bG,bN){var bI=ag(bH);var bM=bH.getLine(bI.line);var bK=bI.ch;var bP=bN?bE[0]:i[0];while(!bP(bM.charAt(bK))){bK++;if(bK>=bM.length){return null}}if(bG){bP=i[0]}else{bP=bE[0];if(!bP(bM.charAt(bK))){bP=bE[1]}}var bJ=bK,bO=bK;while(bP(bM.charAt(bJ))&&bJ<bM.length){bJ++}while(bP(bM.charAt(bO))&&bO>=0){bO--}bO++;if(bL){var bQ=bJ;while(/\s/.test(bM.charAt(bJ))&&bJ<bM.length){bJ++}if(bQ==bJ){var bR=bO;while(/\s/.test(bM.charAt(bO-1))&&bO>0){bO--}if(!bO){bO=bR}}}return{start:d(bI.line,bO),end:d(bI.line,bJ)}}function a4(bF,bH,bG){if(!y(bH,bG)){bD.jumpList.add(bF,bH,bG)}}function a5(bG,bF){bD.lastCharacterSearch.increment=bG;bD.lastCharacterSearch.forward=bF.forward;bD.lastCharacterSearch.selectedCharacter=bF.selectedCharacter}var bo={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var ad={bracket:{isComplete:function(bF){if(bF.nextCh===bF.symb){bF.depth++;if(bF.depth>=1){return true}}else{if(bF.nextCh===bF.reverseSymb){bF.depth--}}return false}},section:{init:function(bF){bF.curMoveThrough=true;bF.symb=(bF.forward?"]":"[")===bF.symb?"{":"}"},isComplete:function(bF){return bF.index===0&&bF.nextCh===bF.symb}},comment:{isComplete:function(bG){var bF=bG.lastCh==="*"&&bG.nextCh==="/";bG.lastCh=bG.nextCh;return bF}},method:{init:function(bF){bF.symb=(bF.symb==="m"?"{":"}");bF.reverseSymb=bF.symb==="{"?"}":"{"},isComplete:function(bF){if(bF.nextCh===bF.symb){return true}return false}},preprocess:{init:function(bF){bF.index=0},isComplete:function(bF){if(bF.nextCh==="#"){var bG=bF.lineText.match(/#(\w+)/)[1];if(bG==="endif"){if(bF.forward&&bF.depth===0){return true}bF.depth++}else{if(bG==="if"){if(!bF.forward&&bF.depth===0){return true}bF.depth--}}if(bG==="else"&&bF.depth===0){return true}}return false}}};function ac(bF,bR,bJ,bT){var bG=v(bF.getCursor());var bK=bJ?1:-1;var bI=bJ?bF.lineCount():-1;var bH=bG.ch;var bN=bG.line;var bP=bF.getLine(bN);var bS={lineText:bP,nextCh:bP.charAt(bH),lastCh:null,index:bH,symb:bT,reverseSymb:(bJ?{")":"(","}":"{"}:{"(":")","{":"}"})[bT],forward:bJ,depth:0,curMoveThrough:false};var bQ=bo[bT];if(!bQ){return bG}var bL=ad[bQ].init;var bM=ad[bQ].isComplete;if(bL){bL(bS)}while(bN!==bI&&bR){bS.index+=bK;bS.nextCh=bS.lineText.charAt(bS.index);if(!bS.nextCh){bN+=bK;bS.lineText=bF.getLine(bN)||"";if(bK>0){bS.index=0}else{var bO=bS.lineText.length;bS.index=(bO>0)?(bO-1):0}bS.nextCh=bS.lineText.charAt(bS.index)}if(bM(bS)){bG.line=bN;bG.ch=bS.index;bR--}}if(bS.nextCh||bS.curMoveThrough){return d(bN,bS.index)}return bG}function af(bH,bI,bL,bF,bK){var bP=bI.line;var bQ=bI.ch;var bO=bH.getLine(bP);var bJ=bL?1:-1;var bG=bF?i:bE;if(bK&&bO==""){bP+=bJ;bO=bH.getLine(bP);if(!aw(bH,bP)){return null}bQ=(bL)?0:bO.length}while(true){if(bK&&bO==""){return{from:0,to:0,line:bP}}var bR=(bJ>0)?bO.length:-1;var bT=bR,bS=bR;while(bQ!=bR){var bM=false;for(var bN=0;bN<bG.length&&!bM;++bN){if(bG[bN](bO.charAt(bQ))){bT=bQ;while(bQ!=bR&&bG[bN](bO.charAt(bQ))){bQ+=bJ}bS=bQ;bM=bT!=bS;if(bT==bI.ch&&bP==bI.line&&bS==bT+bJ){continue}else{return{from:Math.min(bT,bS+1),to:Math.max(bT,bS),line:bP}}}}if(!bM){bQ+=bJ}}bP+=bJ;if(!aw(bH,bP)){return null}bO=bH.getLine(bP);bQ=(bJ>0)?0:bO.length}}function aU(bG,bH,bP,bM,bS,bF){var bI=v(bH);var bT=[];if(bM&&!bS||!bM&&bS){bP++}var bJ=!(bM&&bS);for(var bN=0;bN<bP;bN++){var bR=af(bG,bH,bM,bF,bJ);if(!bR){var bK=aF(bG,bG.lastLine());bT.push(bM?{line:bG.lastLine(),from:bK,to:bK}:{line:0,from:0,to:0});break}bT.push(bR);bH=d(bR.line,bM?(bR.to-1):bR.from)}var bQ=bT.length!=bP;var bL=bT[0];var bO=bT.pop();if(bM&&!bS){if(!bQ&&(bL.from!=bI.ch||bL.line!=bI.line)){bO=bT.pop()}return d(bO.line,bO.from)}else{if(bM&&bS){return d(bO.line,bO.to-1)}else{if(!bM&&bS){if(!bQ&&(bL.to!=bI.ch||bL.line!=bI.line)){bO=bT.pop()}return d(bO.line,bO.to)}else{return d(bO.line,bO.from)}}}}function aS(bG,bM,bI,bF){var bH=bG.getCursor();var bN=bH.ch;var bK;for(var bJ=0;bJ<bM;bJ++){var bL=bG.getLine(bH.line);bK=j(bN,bL,bF,bI,true);if(bK==-1){return null}bN=bK}return d(bG.getCursor().line,bK)}function aT(bF,bH){var bG=bF.getCursor().line;return n(bF,d(bG,bH-1))}function bx(bF,bI,bG,bH){if(!ar(bG,bA)){return}if(bI.marks[bG]){bI.marks[bG].clear()}bI.marks[bG]=bF.setBookmark(bH)}function j(bK,bJ,bF,bG,bI){var bH;if(bG){bH=bJ.indexOf(bF,bK+1);if(bH!=-1&&!bI){bH-=1}}else{bH=bJ.lastIndexOf(bF,bK-1);if(bH!=-1&&!bI){bH+=1}}return bH}function ab(bG,bJ,bR,bH,bL){var bO=bJ.line;var bQ=bG.firstLine();var bP=bG.lastLine();var bS,bI,bK=bO;function bN(bV){return !bG.getLine(bV)}function bM(bX,bW,bV){if(bV){return bN(bX)!=bN(bX+bW)}return !bN(bX)&&bN(bX+bW)}if(bH){while(bQ<=bK&&bK<=bP&&bR>0){if(bM(bK,bH)){bR--}bK+=bH}return new d(bK,0)}var bU=bG.state.vim;if(bU.visualLine&&bM(bO,1,true)){var bF=bU.sel.anchor;if(bM(bF.line,-1,true)){if(!bL||bF.line!=bO){bO+=1}}}var bT=bN(bO);for(bK=bO;bK<=bP&&bR;bK++){if(bM(bK,1,true)){if(!bL||bN(bK)!=bT){bR--}}}bI=new d(bK,0);if(bK>bP&&!bT){bT=true}else{bL=false}for(bK=bO;bK>bQ;bK--){if(!bL||bN(bK)==bT||bK==bO){if(bM(bK,-1,true)){break}}}bS=new d(bK,0);return{start:bS,end:bI}}function bh(bG,bK,bP,bL){var bH=bK,bO,bJ;var bF=({"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/})[bP];var bN=({"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"})[bP];var bI=bG.getLine(bH.line).charAt(bH.ch);var bM=bI===bN?1:0;bO=bG.scanForBracket(d(bH.line,bH.ch+bM),-1,null,{bracketRegex:bF});bJ=bG.scanForBracket(d(bH.line,bH.ch+bM),1,null,{bracketRegex:bF});if(!bO||!bJ){return{start:bH,end:bH}}bO=bO.pos;bJ=bJ.pos;if((bO.line==bJ.line&&bO.ch>bJ.ch)||(bO.line>bJ.line)){var bQ=bO;bO=bJ;bJ=bQ}if(bL){bJ.ch+=1}else{bO.ch+=1}return{start:bO,end:bJ}}function Y(bG,bK,bQ,bM){var bH=v(bK);var bO=bG.getLine(bH.line);var bF=bO.split("");var bP,bI,bL,bN;var bJ=bF.indexOf(bQ);if(bH.ch<bJ){bH.ch=bJ}else{if(bJ<bH.ch&&bF[bH.ch]==bQ){bI=bH.ch;--bH.ch}}if(bF[bH.ch]==bQ&&!bI){bP=bH.ch+1}else{for(bL=bH.ch;bL>-1&&!bP;bL--){if(bF[bL]==bQ){bP=bL+1}}}if(bP&&!bI){for(bL=bP,bN=bF.length;bL<bN&&!bI;bL++){if(bF[bL]==bQ){bI=bL}}}if(!bP||!bI){return{start:bH,end:bH}}if(bM){--bP;++bI}return{start:d(bH.line,bP),end:d(bH.line,bI)}}G("pcre",true,"boolean");function bf(){}bf.prototype={getQuery:function(){return bD.query},setQuery:function(bF){bD.query=bF},getOverlay:function(){return this.searchOverlay},setOverlay:function(bF){this.searchOverlay=bF},isReversed:function(){return bD.isReversed},setReversed:function(bF){bD.isReversed=bF},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(bF){this.annotate=bF}};function al(bF){var bG=bF.state.vim;return bG.searchState_||(bG.searchState_=new bf())}function J(bF,bJ,bI,bG,bH){if(bF.openDialog){bF.openDialog(bJ,bG,{bottom:true,value:bH.value,onKeyDown:bH.onKeyDown,onKeyUp:bH.onKeyUp,selectValueOnOpen:false})}else{bG(prompt(bI,""))}}function bn(bF){var bH=ae(bF)||[];if(!bH.length){return[]}var bI=[];if(bH[0]!==0){return}for(var bG=0;bG<bH.length;bG++){if(typeof bH[bG]=="number"){bI.push(bF.substring(bH[bG]+1,bH[bG+1]))}}return bI}function ae(bJ){var bG=false;var bI=[];for(var bH=0;bH<bJ.length;bH++){var bF=bJ.charAt(bH);if(!bG&&bF=="/"){bI.push(bH)}bG=!bG&&(bF=="\\")}return bI}function bp(bM){var bL="|(){";var bN="}";var bG=false;var bJ=[];for(var bH=-1;bH<bM.length;bH++){var bF=bM.charAt(bH)||"";var bI=bM.charAt(bH+1)||"";var bK=(bI&&bL.indexOf(bI)!=-1);if(bG){if(bF!=="\\"||!bK){bJ.push(bF)}bG=false}else{if(bF==="\\"){bG=true;if(bI&&bN.indexOf(bI)!=-1){bK=true}if(!bK||bI==="\\"){bJ.push(bF)}}else{bJ.push(bF);if(bK&&bI!=="\\"){bJ.push("\\")}}}}return bJ.join("")}var k={"\\n":"\n","\\r":"\r","\\t":"\t"};function bq(bK){var bG=false;var bJ=[];for(var bH=-1;bH<bK.length;bH++){var bF=bK.charAt(bH)||"";var bI=bK.charAt(bH+1)||"";if(k[bF+bI]){bJ.push(k[bF+bI]);bH++}else{if(bG){bJ.push(bF);bG=false}else{if(bF==="\\"){bG=true;if((az(bI)||bI==="$")){bJ.push("$")}else{if(bI!=="/"&&bI!=="\\"){bJ.push("\\")}}}else{if(bF==="$"){bJ.push("$")}bJ.push(bF);if(bI==="/"){bJ.push("\\")}}}}}return bJ.join("")}var bt={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t"};function bs(bI){var bJ=new a.StringStream(bI);var bH=[];while(!bJ.eol()){while(bJ.peek()&&bJ.peek()!="\\"){bH.push(bJ.next())}var bF=false;for(var bG in bt){if(bJ.match(bG,true)){bF=true;bH.push(bt[bG]);break}}if(!bF){bH.push(bJ.next())}}return bH.join("")}function a3(bJ,bH,bN){var bI=bD.registerController.getRegister("/");bI.setText(bJ);if(bJ instanceof RegExp){return bJ}var bM=ae(bJ);var bL;var bG;if(!bM.length){bL=bJ}else{bL=bJ.substring(0,bM[0]);var bF=bJ.substring(bM[0]);bG=(bF.indexOf("i")!=-1)}if(!bL){return null}if(!ak("pcre")){bL=bp(bL)}if(bN){bH=(/^[^A-Z]*$/).test(bL)}var bK=new RegExp(bL,(bH||bG)?"i":undefined);return bK}function bk(bF,bG){if(bF.openNotification){bF.openNotification('<span style="color: red">'+bG+"</span>",{bottom:true,duration:5000})}else{alert(bG)}}function aN(bG,bF){var bH='<span style="font-family: monospace; white-space: pre">'+(bG||"")+'<input type="text"></span>';if(bF){bH+=' <span style="color: #888">'+bF+"</span>"}return bH}var be="(Javascript regexp)";function bl(bF,bG){var bI=(bG.prefix||"")+" "+(bG.desc||"");var bH=aN(bG.prefix,bG.desc);J(bF,bH,bI,bG.onClose,bG)}function a6(bI,bJ){if(bI instanceof RegExp&&bJ instanceof RegExp){var bH=["global","multiline","ignoreCase","source"];for(var bF=0;bF<bH.length;bF++){var bG=bH[bF];if(bI[bG]!==bJ[bG]){return false}}return true}return false}function by(bF,bI,bG,bJ){if(!bI){return}var bK=al(bF);var bH=a3(bI,!!bG,!!bJ);if(!bH){return}ap(bF,bH);if(a6(bH,bK.getQuery())){return bH}bK.setQuery(bH);return bH}function bd(bG){if(bG.source.charAt(0)=="^"){var bF=true}return{token:function(bI){if(bF&&!bI.sol()){bI.skipToEnd();return}var bH=bI.match(bG,false);if(bH){if(bH[0].length==0){bI.next();return"searching"}if(!bI.sol()){bI.backUp(1);if(!bG.exec(bI.next()+bH[0])){bI.next();return null}}bI.match(bG);return"searching"}while(!bI.eol()){bI.next();if(bI.match(bG,false)){break}}},query:bG}}function ap(bF,bH){var bI=al(bF);var bG=bI.getOverlay();if(!bG||bH!=bG.query){if(bG){bF.removeOverlay(bG)}bG=bd(bH);bF.addOverlay(bG);if(bF.showMatchesOnScrollbar){if(bI.getScrollbarAnnotate()){bI.getScrollbarAnnotate().clear()}bI.setScrollbarAnnotate(bF.showMatchesOnScrollbar(bH))}bI.setOverlay(bG)}}function aa(bF,bG,bH,bI){if(bI===undefined){bI=1}return bF.operation(function(){var bM=bF.getCursor();var bJ=bF.getSearchCursor(bH,bM);for(var bL=0;bL<bI;bL++){var bK=bJ.find(bG);if(bL==0&&bK&&y(bJ.from(),bM)){bK=bJ.find(bG)}if(!bK){bJ=bF.getSearchCursor(bH,(bG)?d(bF.lastLine()):d(bF.firstLine(),0));if(!bJ.find(bG)){return}}}return bJ.from()})}function m(bF){var bG=al(bF);bF.removeOverlay(al(bF).getOverlay());bG.setOverlay(null);if(bG.getScrollbarAnnotate()){bG.getScrollbarAnnotate().clear();bG.setScrollbarAnnotate(null)}}function av(bG,bH,bF){if(typeof bG!="number"){bG=bG.line}if(bH instanceof Array){return ar(bG,bH)}else{if(bF){return(bG>=bH&&bG<=bF)}else{return bG==bH}}}function an(bG){var bK=bG.getScrollInfo();var bJ=6;var bI=10;var bH=bG.coordsChar({left:0,top:bJ+bK.top},"local");var bF=bK.clientHeight-bI+bK.top;var bL=bG.coordsChar({left:0,top:bF},"local");return{top:bH.line,bottom:bL.line}}var O=function(){this.buildCommandMap_()};O.prototype={processCommand:function(bF,bG,bH){var bI=this;bF.operation(function(){bF.curOp.isVimOp=true;bI._processCommand(bF,bG,bH)})},_processCommand:function(bF,bL,bN){var bQ=bF.state.vim;var bH=bD.registerController.getRegister(":");var bP=bH.toString();if(bQ.visualMode){S(bF)}var bM=new a.StringStream(bL);bH.setText(bL);var bO=bN||{};bO.input=bL;try{this.parseInput_(bF,bM,bO)}catch(bJ){bk(bF,bJ);throw bJ}var bG;var bI;if(!bO.commandName){if(bO.line!==undefined){bI="move"}}else{bG=this.matchCommand_(bO.commandName);if(bG){bI=bG.name;if(bG.excludeFromCommandHistory){bH.setText(bP)}this.parseCommandArgs_(bM,bO,bG);if(bG.type=="exToKey"){for(var bK=0;bK<bG.toKeys.length;bK++){a.Vim.handleKey(bF,bG.toKeys[bK],"mapping")}return}else{if(bG.type=="exToEx"){this.processCommand(bF,bG.toInput);return}}}}if(!bI){bk(bF,'Not an editor command ":'+bL+'"');return}try{P[bI](bF,bO);if((!bG||!bG.possiblyAsync)&&bO.callback){bO.callback()}}catch(bJ){bk(bF,bJ);throw bJ}},parseInput_:function(bF,bH,bI){bH.eatWhile(":");if(bH.eat("%")){bI.line=bF.firstLine();bI.lineEnd=bF.lastLine()}else{bI.line=this.parseLineSpec_(bF,bH);if(bI.line!==undefined&&bH.eat(",")){bI.lineEnd=this.parseLineSpec_(bF,bH)}}var bG=bH.match(/^(\w+)/);if(bG){bI.commandName=bG[1]}else{bI.commandName=bH.match(/.*/)[0]}return bI},parseLineSpec_:function(bF,bG){var bI=bG.match(/^(\d+)/);if(bI){return parseInt(bI[1],10)-1}switch(bG.next()){case".":return bF.getCursor().line;case"$":return bF.lastLine();case"'":var bH=bF.state.vim.marks[bG.next()];if(bH&&bH.find()){return bH.find().line}throw new Error("Mark not set");default:bG.backUp(1);return undefined}},parseCommandArgs_:function(bI,bJ,bG){if(bI.eol()){return}bJ.argString=bI.match(/.*/)[0];var bH=bG.argDelimiter||/\s+/;var bF=br(bJ.argString).split(bH);if(bF.length&&bF[0]){bJ.args=bF}},matchCommand_:function(bG){for(var bH=bG.length;bH>0;bH--){var bI=bG.substring(0,bH);if(this.commandMap_[bI]){var bF=this.commandMap_[bI];if(bF.name.indexOf(bG)===0){return bF}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var bG=0;bG<b.length;bG++){var bF=b[bG];var bH=bF.shortName||bF.name;this.commandMap_[bH]=bF}},map:function(bH,bJ,bG){if(bH!=":"&&bH.charAt(0)==":"){if(bG){throw Error("Mode not supported for ex mappings")}var bF=bH.substring(1);if(bJ!=":"&&bJ.charAt(0)==":"){this.commandMap_[bF]={name:bF,type:"exToEx",toInput:bJ.substring(1),user:true}}else{this.commandMap_[bF]={name:bF,type:"exToKey",toKeys:bJ,user:true}}}else{if(bJ!=":"&&bJ.charAt(0)==":"){var bI={keys:bH,type:"keyToEx",exArgs:{input:bJ.substring(1)},user:true};if(bG){bI.context=bG}c.unshift(bI)}else{var bI={keys:bH,type:"keyToKey",toKeys:bJ,user:true};if(bG){bI.context=bG}c.unshift(bI)}}},unmap:function(bJ,bG){if(bJ!=":"&&bJ.charAt(0)==":"){if(bG){throw Error("Mode not supported for ex mappings")}var bF=bJ.substring(1);if(this.commandMap_[bF]&&this.commandMap_[bF].user){delete this.commandMap_[bF];return}}else{var bI=bJ;for(var bH=0;bH<c.length;bH++){if(bI==c[bH].keys&&c[bH].context===bG&&c[bH].user){c.splice(bH,1);return}}}throw Error("No such mapping.")}};var P={colorscheme:function(bF,bG){if(!bG.args||bG.args.length<1){bk(bF,bF.getOption("theme"));return}bF.setOption("theme",bG.args[0])},map:function(bF,bI,bG){var bH=bI.args;if(!bH||bH.length<2){if(bF){bk(bF,"Invalid mapping: "+bI.input)}return}N.map(bH[0],bH[1],bG)},imap:function(bF,bG){this.map(bF,bG,"insert")},nmap:function(bF,bG){this.map(bF,bG,"normal")},vmap:function(bF,bG){this.map(bF,bG,"visual")},unmap:function(bF,bI,bG){var bH=bI.args;if(!bH||bH.length<1){if(bF){bk(bF,"No such mapping: "+bI.input)}return}N.unmap(bH[0],bG)},move:function(bF,bG){r.processCommand(bF,bF.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:bG.line+1})},set:function(bF,bL){var bM=bL.args;var bN=bL.setCfg||{};if(!bM||bM.length<1){if(bF){bk(bF,"Invalid mapping: "+bL.input)}return}var bG=bM[0].split("=");var bK=bG[0];var bO=bG[1];var bH=false;if(bK.charAt(bK.length-1)=="?"){if(bO){throw Error("Trailing characters: "+bL.argString)}bK=bK.substring(0,bK.length-1);bH=true}if(bO===undefined&&bK.substring(0,2)=="no"){bK=bK.substring(2);bO=false}var bJ=a2[bK]&&a2[bK].type=="boolean";if(bJ&&bO==undefined){bO=true}if(!bJ&&bO===undefined||bH){var bI=ak(bK,bF,bN);if(bI===true||bI===false){bk(bF," "+(bI?"":"no")+bK)}else{bk(bF,"  "+bK+"="+bI)}}else{bj(bK,bO,bF,bN)}},setlocal:function(bF,bG){bG.setCfg={scope:"local"};this.set(bF,bG)},setglobal:function(bF,bG){bG.setCfg={scope:"global"};this.set(bF,bG)},registers:function(bF,bH){var bI=bH.args;var bM=bD.registerController.registers;var bJ="----------Registers----------<br><br>";if(!bI){for(var bL in bM){var bN=bM[bL].toString();if(bN.length){bJ+='"'+bL+"    "+bN+"<br>"}}}else{var bL;bI=bI.join("");for(var bG=0;bG<bI.length;bG++){bL=bI.charAt(bG);if(!bD.registerController.isValidRegister(bL)){continue}var bK=bM[bL]||new a7();bJ+='"'+bL+"    "+bK.toString()+"<br>"}}bk(bF,bJ)},sort:function(bF,bS){var bV,bL,bZ,bP;function bT(){if(bS.argString){var b0=new a.StringStream(bS.argString);if(b0.eat("!")){bV=true}if(b0.eol()){return}if(!b0.eatSpace()){return"Invalid arguments"}var b4=b0.match(/[a-z]+/);if(b4){b4=b4[0];bL=b4.indexOf("i")!=-1;bZ=b4.indexOf("u")!=-1;var b1=b4.indexOf("d")!=-1&&1;var b2=b4.indexOf("x")!=-1&&1;var b3=b4.indexOf("o")!=-1&&1;if(b1+b2+b3>1){return"Invalid arguments"}bP=b1&&"decimal"||b2&&"hex"||b3&&"octal"}if(b0.match(/\/.*\//)){return"patterns not supported"}}}var bJ=bT();if(bJ){bk(bF,bJ+": "+bS.argString);return}var bO=bS.line||bF.firstLine();var bN=bS.lineEnd||bS.line||bF.lastLine();if(bO==bN){return}var bI=d(bO,0);var bH=d(bN,aF(bF,bN));var bW=bF.getRange(bI,bH).split("\n");var bQ=(bP=="decimal")?/(-?)([\d]+)/:(bP=="hex")?/(-?)(?:0x)?([0-9a-f]+)/i:(bP=="octal")?/([0-7]+)/:null;var bU=(bP=="decimal")?10:(bP=="hex")?16:(bP=="octal")?8:null;var bR=[],bY=[];if(bP){for(var bK=0;bK<bW.length;bK++){if(bQ.exec(bW[bK])){bR.push(bW[bK])}else{bY.push(bW[bK])}}}else{bY=bW}function bG(b0,b2){if(bV){var b4;b4=b0;b0=b2;b2=b4}if(bL){b0=b0.toLowerCase();b2=b2.toLowerCase()}var b1=bP&&bQ.exec(b0);var b3=bP&&bQ.exec(b2);if(!b1){return b0<b2?-1:1}b1=parseInt((b1[1]+b1[2]).toLowerCase(),bU);b3=parseInt((b3[1]+b3[2]).toLowerCase(),bU);return b1-b3}bR.sort(bG);bY.sort(bG);bW=(!bV)?bY.concat(bR):bR.concat(bY);if(bZ){var bX=bW;var bM;bW=[];for(var bK=0;bK<bX.length;bK++){if(bX[bK]!=bM){bW.push(bX[bK])}bM=bX[bK]}}bF.replaceRange(bW.join("\n"),bI,bH)},global:function(bG,bR){var bF=bR.argString;if(!bF){bk(bG,"Regular Expression missing from global");return}var bN=(bR.line!==undefined)?bR.line:bG.firstLine();var bM=bR.lineEnd||bR.line||bG.lastLine();var bU=bn(bF);var bT=bF,bH;if(bU.length){bT=bU[0];bH=bU.slice(1,bU.length).join("/")}if(bT){try{by(bG,bT,true,true)}catch(bJ){bk(bG,"Invalid regex: "+bT);return}}var bS=al(bG).getQuery();var bP=[],bI="";for(var bK=bN;bK<=bM;bK++){var bO=bS.test(bG.getLine(bK));if(bO){bP.push(bK+1);bI+=bG.getLine(bK)+"<br>"}}if(!bH){bk(bG,bI);return}var bL=0;var bQ=function(){if(bL<bP.length){var bV=bP[bL]+bH;N.processCommand(bG,bV,{callback:bQ})}bL++};bQ()},substitute:function(bG,bP){if(!bG.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.")}var bF=bP.argString;var bV=bF?bn(bF):[];var bR,bS="",bW,bL,bI;var bH=false;var bM=false;if(bV.length){bR=bV[0];bS=bV[1];if(bS!==undefined){if(ak("pcre")){bS=bs(bS)}else{bS=bq(bS)}bD.lastSubstituteReplacePart=bS}bW=bV[2]?bV[2].split(" "):[]}else{if(bF&&bF.length){bk(bG,"Substitutions should be of the form :s/pattern/replace/");return}}if(bW){bL=bW[0];bI=parseInt(bW[1]);if(bL){if(bL.indexOf("c")!=-1){bH=true;bL.replace("c","")}if(bL.indexOf("g")!=-1){bM=true;bL.replace("g","")}bR=bR+"/"+bL}}if(bR){try{by(bG,bR,true,true)}catch(bK){bk(bG,"Invalid regex: "+bR);return}}bS=bS||bD.lastSubstituteReplacePart;if(bS===undefined){bk(bG,"No previous substitute regular expression");return}var bU=al(bG);var bQ=bU.getQuery();var bO=(bP.line!==undefined)?bP.line:bG.getCursor().line;var bN=bP.lineEnd||bO;if(bO==bG.firstLine()&&bN==bG.lastLine()){bN=Infinity}if(bI){bO=bN;bN=bO+bI-1}var bT=n(bG,d(bO,0));var bJ=bG.getSearchCursor(bQ,bT);K(bG,bH,bM,bO,bN,bJ,bQ,bS,bP.callback)},redo:a.commands.redo,undo:a.commands.undo,write:function(bF){if(a.commands.save){a.commands.save(bF)}else{if(bF.save){bF.save()}}},nohlsearch:function(bF){m(bF)},yank:function(bF){var bG=v(bF.getCursor());var bH=bG.line;var bI=bF.getLine(bH);bD.registerController.pushText("0","yank",bI,true,true)},delmarks:function(bF,bL){if(!bL.argString||!br(bL.argString)){bk(bF,"Argument required");return}var bO=bF.state.vim;var bP=new a.StringStream(br(bL.argString));while(!bP.eol()){bP.eatSpace();var bG=bP.pos;if(!bP.match(/[a-zA-Z]/,false)){bk(bF,"Invalid argument: "+bL.argString.substring(bG));return}var bQ=bP.next();if(bP.match("-",true)){if(!bP.match(/[a-zA-Z]/,false)){bk(bF,"Invalid argument: "+bL.argString.substring(bG));return}var bN=bQ;var bI=bP.next();if(ax(bN)&&ax(bI)||aA(bN)&&aA(bI)){var bM=bN.charCodeAt(0);var bH=bI.charCodeAt(0);if(bM>=bH){bk(bF,"Invalid argument: "+bL.argString.substring(bG));return}for(var bJ=0;bJ<=bH-bM;bJ++){var bK=String.fromCharCode(bM+bJ);delete bO.marks[bK]}}else{bk(bF,"Invalid argument: "+bN+"-");return}}else{delete bO.marks[bQ]}}}};var N=new O();function K(bG,bH,bJ,bM,bL,bT,bP,bS,bF){bG.state.vim.exMode=true;var bI=false;var bK=bT.from();function bR(){bG.operation(function(){while(!bI){bQ();bN()}bU()})}function bQ(){var bW=bG.getRange(bT.from(),bT.to());var bV=bW.replace(bP,bS);bT.replace(bV)}function bN(){while(bT.findNext()&&av(bT.from(),bM,bL)){if(!bJ&&bK&&bT.from().line==bK.line){continue}bG.scrollIntoView(bT.from(),30);bG.setSelection(bT.from(),bT.to());bK=bT.from();bI=false;return}bI=true}function bU(bV){if(bV){bV()}bG.focus();if(bK){bG.setCursor(bK);var bW=bG.state.vim;bW.exMode=false;bW.lastHPos=bW.lastHSPos=bK.ch}if(bF){bF()}}function bO(bX,bV,bW){a.e_stop(bX);var bY=a.keyName(bX);switch(bY){case"Y":bQ();bN();break;case"N":bN();break;case"A":var bZ=bF;bF=undefined;bG.operation(bR);bF=bZ;break;case"L":bQ();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":bU(bW);break}if(bI){bU(bW)}return true}bN();if(bI){bk(bG,"No matches for "+bP.source);return}if(!bH){bR();if(bF){bF()}return}bl(bG,{prefix:"replace with <strong>"+bS+"</strong> (y/n/a/q/l)",onKeyDown:bO})}a.keyMap.vim={attach:h,detach:I,call:p};function R(bG){var bO=bG.state.vim;var bL=bD.macroModeState;var bI=bD.registerController.getRegister(".");var bJ=bL.isPlaying;var bK=bL.lastInsertModeChanges;var bN=[];if(!bJ){var bM=bK.inVisualBlock?bO.lastSelection.visualBlock.height:1;var bF=bK.changes;var bN=[];var bH=0;while(bH<bF.length){bN.push(bF[bH]);if(bF[bH] instanceof au){bH++}else{bH+=bM}}bK.changes=bN;bG.off("change",aY);a.off(bG.getInputField(),"keydown",a0)}if(!bJ&&bO.insertModeRepeat>1){bb(bG,bO,bO.insertModeRepeat-1,true);bO.lastEditInputState.repeatOverride=bO.insertModeRepeat}delete bO.insertModeRepeat;bO.insertMode=false;bG.setCursor(bG.getCursor().line,bG.getCursor().ch-1);bG.setOption("keyMap","vim");bG.setOption("disableInput",true);bG.toggleOverwrite(false);bI.setText(bK.changes.join(""));a.signal(bG,"vim-mode-change",{mode:"normal"});if(bL.isRecording){aG(bL)}}function f(bF){c.unshift(bF)}function aO(bJ,bL,bK,bF,bH){var bG={keys:bJ,type:bL};bG[bL]=bK;bG[bL+"Args"]=bF;for(var bI in bH){bG[bI]=bH[bI]}f(bG)}G("insertModeEscKeysTimeout",200,"number");a.keyMap["vim-insert"]={fallthrough:["default"],attach:h,detach:I,call:p};a.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:h,detach:I,call:p};function Q(bG,bQ,bL,bO){var bN=bD.registerController.getRegister(bO);if(bO==":"){if(bN.keyBuffer[0]){N.processCommand(bG,bN.keyBuffer[0])}bL.isPlaying=false;return}var bK=bN.keyBuffer;var bI=0;bL.isPlaying=true;bL.replaySearchQueries=bN.searchQueries.slice(0);for(var bH=0;bH<bK.length;bH++){var bP=bK[bH];var bM,bJ;while(bP){bM=(/<\w+-.+?>|<\w+>|./).exec(bP);bJ=bM[0];bP=bP.substring(bM.index+bJ.length);a.Vim.handleKey(bG,bJ,"macro");if(bQ.insertMode){var bF=bN.insertModeChanges[bI++].changes;bD.macroModeState.lastInsertModeChanges.changes=bF;ba(bG,bF,1);R(bG)}}}bL.isPlaying=false}function aH(bG,bF){if(bG.isPlaying){return}var bI=bG.latestRegister;var bH=bD.registerController.getRegister(bI);if(bH){bH.pushText(bF)}}function aG(bF){if(bF.isPlaying){return}var bH=bF.latestRegister;var bG=bD.registerController.getRegister(bH);if(bG&&bG.pushInsertModeChanges){bG.pushInsertModeChanges(bF.lastInsertModeChanges)}}function aI(bF,bG){if(bF.isPlaying){return}var bI=bF.latestRegister;var bH=bD.registerController.getRegister(bI);if(bH&&bH.pushSearchQuery){bH.pushSearchQuery(bG)}}function aY(bF,bG){var bI=bD.macroModeState;var bH=bI.lastInsertModeChanges;if(!bI.isPlaying){while(bG){bH.expectCursorActivityForChange=true;if(bG.origin=="+input"||bG.origin=="paste"||bG.origin===undefined){var bJ=bG.text.join("\n");bH.changes.push(bJ)}bG=bG.next}}}function aZ(bF){var bI=bF.state.vim;if(bI.insertMode){var bH=bD.macroModeState;if(bH.isPlaying){return}var bG=bH.lastInsertModeChanges;if(bG.expectCursorActivityForChange){bG.expectCursorActivityForChange=false}else{bG.changes=[]}}else{if(!bF.curOp.isVimOp){ao(bF,bI)}}if(bI.visualMode){bv(bF)}}function bv(bF){var bI=bF.state.vim;var bG=n(bF,v(bI.sel.head));var bH=aX(bG,0,1);if(bI.fakeCursor){bI.fakeCursor.clear()}bI.fakeCursor=bF.markText(bG,bH,{className:"cm-animate-fat-cursor"})}function ao(bH,bK){var bF=bH.getCursor("anchor");var bI=bH.getCursor("head");if(bK.visualMode&&!bH.somethingSelected()){S(bH,false)}else{if(!bK.visualMode&&!bK.insertMode&&bH.somethingSelected()){bK.visualMode=true;bK.visualLine=false;a.signal(bH,"vim-mode-change",{mode:"visual"})}}if(bK.visualMode){var bJ=!z(bI,bF)?-1:0;var bG=z(bI,bF)?-1:0;bI=aX(bI,0,bJ);bF=aX(bF,0,bG);bK.sel={anchor:bF,head:bI};bx(bH,bK,"<",C(bI,bF));bx(bH,bK,">",B(bI,bF))}else{if(!bK.insertMode){bK.lastHPos=bH.getCursor().ch}}}function au(bF){this.keyName=bF}function a0(bF){var bI=bD.macroModeState;var bH=bI.lastInsertModeChanges;var bG=a.keyName(bF);if(!bG){return}function bJ(){bH.changes.push(new au(bG));return true}if(bG.indexOf("Delete")!=-1||bG.indexOf("Backspace")!=-1){a.lookupKey(bG,"vim-insert",bJ)}}function bb(bG,bO,bK,bM){var bJ=bD.macroModeState;bJ.isPlaying=true;var bI=!!bO.lastEditActionCommand;var bF=bO.inputState;function bL(){if(bI){r.processAction(bG,bO,bO.lastEditActionCommand)}else{r.evalInput(bG,bO)}}function bN(bQ){if(bJ.lastInsertModeChanges.changes.length>0){bQ=!bO.lastEditActionCommand?1:bQ;var bP=bJ.lastInsertModeChanges;ba(bG,bP.changes,bQ)}}bO.inputState=bO.lastEditInputState;if(bI&&bO.lastEditActionCommand.interlaceInsertRepeat){for(var bH=0;bH<bK;bH++){bL();bN(1)}}else{if(!bM){bL()}bN(bK)}bO.inputState=bF;if(bO.insertMode&&!bM){R(bG)}bJ.isPlaying=false}function ba(bH,bG,bQ){function bN(bS){if(typeof bS=="string"){a.commands[bS](bH)}else{bS(bH)}return true}var bJ=bH.getCursor("head");var bL=bD.macroModeState.lastInsertModeChanges.inVisualBlock;if(bL){var bR=bH.state.vim;var bO=bR.lastSelection;var bP=ai(bO.anchor,bO.head);bi(bH,bJ,bP.line+1);bQ=bH.listSelections().length;bH.setCursor(bJ)}for(var bK=0;bK<bQ;bK++){if(bL){bH.setCursor(aX(bJ,bK,0))}for(var bM=0;bM<bG.length;bM++){var bF=bG[bM];if(bF instanceof au){a.lookupKey(bF.keyName,"vim-insert",bN)}else{var bI=bH.getCursor();bH.replaceRange(bF,bI,bI)}}}if(bL){bH.setCursor(aX(bJ,0,1))}}bc();return bC};a.Vim=e()});