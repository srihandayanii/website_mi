(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){var d=a.Pos;function c(f,m,l){var o=l.paragraphStart||f.getHelper(m,"paragraphStart");for(var n=m.line,i=f.firstLine();n>i;--n){var k=f.getLine(n);if(o&&o.test(k)){break}if(!/\S/.test(k)){++n;break}}var h=l.paragraphEnd||f.getHelper(m,"paragraphEnd");for(var g=m.line+1,j=f.lastLine();g<=j;++g){var k=f.getLine(g);if(h&&h.test(k)){++g;break}if(!/\S/.test(k)){break}}return{from:n,to:g}}function b(k,g,l,j){var f=g;while(f<k.length&&k.charAt(f)==" "){f++}for(;f>0;--f){if(l.test(k.slice(f-1,f+1))){break}}for(var i=true;;i=false){var h=f;if(j){while(k.charAt(h-1)==" "){--h}}if(h==0&&i){f=g}else{return{from:h,to:f}}}}function e(h,n,x,t){n=h.clipPos(n);x=h.clipPos(x);var j=t.column||80;var y=t.wrapOn||/\s\S|-[^\.\d]/;var p=t.killTrailingSpace!==false;var g=[],k="",l=n.line;var r=h.getRange(n,x,false);if(!r.length){return null}var q=r[0].match(/^[ \t]*/)[0];for(var o=0;o<r.length;++o){var w=r[o],s=k.length,u=0;if(k&&w&&!y.test(k.charAt(k.length-1)+w.charAt(0))){k+=" ";u=1}var v="";if(o){v=w.match(/^\s*/)[0];w=w.slice(v.length)}k+=w;if(o){var m=k.length>j&&q==v&&b(k,j,y,p);if(!m||m.from!=s||m.to!=s+u){g.push({text:[u?" ":""],from:d(l,s),to:d(l+1,v.length)})}else{k=q+w;++l}}while(k.length>j){var f=b(k,j,y,p);g.push({text:["",q],from:d(l,f.from),to:d(l,f.to)});k=q+k.slice(f.to);++l}}if(g.length){h.operation(function(){for(var A=0;A<g.length;++A){var z=g[A];if(z.text||a.cmpPos(z.from,z.to)){h.replaceRange(z.text,z.from,z.to)}}})}return g.length?{from:g[0].from,to:a.changeEnd(g[g.length-1])}:null}a.defineExtension("wrapParagraph",function(h,f){f=f||{};if(!h){h=this.getCursor()}var g=c(this,h,f);return e(this,d(g.from,0),d(g.to-1),f)});a.commands.wrapLines=function(f){f.operation(function(){var l=f.listSelections(),g=f.lastLine()+1;for(var h=l.length-1;h>=0;h--){var k=l[h],m;if(k.empty()){var j=c(f,k.head,{});m={from:d(j.from,0),to:d(j.to-1)}}else{m={from:k.from(),to:k.to()}}if(m.to.line>=g){continue}g=m.from.line;e(f,m.from,m.to,{})}})};a.defineExtension("wrapRange",function(f,h,g){return e(this,f,h,g||{})});a.defineExtension("wrapParagraphsInRange",function(g,m,j){j=j||{};var f=this,l=[];for(var h=g.line;h<=m.line;){var k=c(f,d(h,0),j);l.push(k);h=k.to}var i=false;if(l.length){f.operation(function(){for(var n=l.length-1;n>=0;--n){i=i||e(f,d(l[n].from,0),d(l[n].to-1),j)}})}return i})});