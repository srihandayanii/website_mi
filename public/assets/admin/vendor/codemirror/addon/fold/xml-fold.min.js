(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(b){var i=b.Pos;function a(q,r){return q.line-r.line||q.ch-r.ch}var g="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD";var f=g+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040";var p=new RegExp("<(/?)(["+g+"]["+f+"]*)","g");function e(r,s,q,t){this.line=s;this.ch=q;this.cm=r;this.text=r.getLine(s);this.min=t?t.from:r.firstLine();this.max=t?t.to-1:r.lastLine()}function k(r,q){var s=r.cm.getTokenTypeAt(i(r.line,q));return s&&/\btag\b/.test(s)}function h(q){if(q.line>=q.max){return}q.ch=0;q.text=q.cm.getLine(++q.line);return true}function j(q){if(q.line<=q.min){return}q.text=q.cm.getLine(--q.line);q.ch=q.text.length;return true}function n(r){for(;;){var q=r.text.indexOf(">",r.ch);if(q==-1){if(h(r)){continue}else{return}}if(!k(r,q+1)){r.ch=q+1;continue}var s=r.text.lastIndexOf("/",q);var t=s>-1&&!/\S/.test(r.text.slice(s+1,q));r.ch=q+1;return t?"selfClose":"regular"}}function o(q){for(;;){var r=q.ch?q.text.lastIndexOf("<",q.ch-1):-1;if(r==-1){if(j(q)){continue}else{return}}if(!k(q,r+1)){q.ch=r;continue}p.lastIndex=r;q.ch=r;var s=p.exec(q.text);if(s&&s.index==r){return s}}}function l(r){for(;;){p.lastIndex=r.ch;var q=p.exec(r.text);if(!q){if(h(r)){continue}else{return}}if(!k(r,q.index+1)){r.ch=q.index+1;continue}r.ch=q.index+q[0].length;return q}}function m(r){for(;;){var q=r.ch?r.text.lastIndexOf(">",r.ch-1):-1;if(q==-1){if(j(r)){continue}else{return}}if(!k(r,q+1)){r.ch=q;continue}var s=r.text.lastIndexOf("/",q);var t=s>-1&&!/\S/.test(r.text.slice(s+1,q));r.ch=q+1;return t?"selfClose":"regular"}}function c(s,x){var u=[];for(;;){var t=l(s),q,w=s.line,v=s.ch-(t?t[0].length:0);if(!t||!(q=n(s))){return}if(q=="selfClose"){continue}if(t[1]){for(var r=u.length-1;r>=0;--r){if(u[r]==t[2]){u.length=r;break}}if(r<0&&(!x||x==t[2])){return{tag:t[2],from:i(w,v),to:i(s.line,s.ch)}}}else{u.push(t[2])}}}function d(t,x){var v=[];for(;;){var u=m(t);if(!u){return}if(u=="selfClose"){o(t);continue}var r=t.line,q=t.ch;var w=o(t);if(!w){return}if(w[1]){v.push(w[2])}else{for(var s=v.length-1;s>=0;--s){if(v[s]==w[2]){v.length=s;break}}if(s<0&&(!x||x==w[2])){return{tag:w[2],from:i(t.line,t.ch),to:i(r,q)}}}}}b.registerHelper("fold","xml",function(q,v){var t=new e(q,v.line,0);for(;;){var u=l(t),r;if(!u||t.line!=v.line||!(r=n(t))){return}if(!u[1]&&r!="selfClose"){var w=i(t.line,t.ch);var s=c(t,u[2]);return s&&{from:w,to:s.from}}}});b.findMatchingTag=function(q,u,v){var t=new e(q,u.line,u.ch,v);if(t.text.indexOf(">")==-1&&t.text.indexOf("<")==-1){return}var r=n(t),x=r&&i(t.line,t.ch);var w=r&&o(t);if(!r||!w||a(t,u)>0){return}var s={from:i(t.line,t.ch),to:x,tag:w[2]};if(r=="selfClose"){return{open:s,close:null,at:"open"}}if(w[1]){return{open:d(t,w[2]),close:s,at:"close"}}else{t=new e(q,x.line,x.ch,v);return{open:s,close:c(t,w[2]),at:"open"}}};b.findEnclosingTag=function(r,v,w){var t=new e(r,v.line,v.ch,w);for(;;){var u=d(t);if(!u){break}var s=new e(r,v.line,v.ch,w);var q=c(s,u.tag);if(q){return{open:u,close:q}}}};b.scanForClosingTag=function(q,u,t,r){var s=new e(q,u.line,u.ch,r?{from:0,to:r}:null);return c(s,t)}});