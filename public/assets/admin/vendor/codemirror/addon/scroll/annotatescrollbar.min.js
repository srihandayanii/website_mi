(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(b){b.defineExtension("annotateScrollbar",function(c){if(typeof c=="string"){c={className:c}}return new a(this,c)});b.defineOption("scrollButtonHeight",0);function a(c,d){this.cm=c;this.options=d;this.buttonHeight=d.scrollButtonHeight||c.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=c.getWrapperElement().appendChild(document.createElement("div"));this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();function e(g){clearTimeout(f.doRedraw);f.doRedraw=setTimeout(function(){f.redraw()},g)}var f=this;c.on("refresh",this.resizeHandler=function(){clearTimeout(f.doUpdate);f.doUpdate=setTimeout(function(){if(f.computeScale()){e(20)}},100)});c.on("markerAdded",this.resizeHandler);c.on("markerCleared",this.resizeHandler);if(d.listenForChanges!==false){c.on("change",this.changeHandler=function(){e(250)})}}a.prototype.computeScale=function(){var c=this.cm;var d=(c.getWrapperElement().clientHeight-c.display.barHeight-this.buttonHeight*2)/c.getScrollerElement().scrollHeight;if(d!=this.hScale){this.hScale=d;return true}};a.prototype.update=function(c){this.annotations=c;this.redraw()};a.prototype.redraw=function(g){if(g!==false){this.computeScale()}var f=this.cm,o=this.hScale;var l=document.createDocumentFragment(),d=this.annotations;var t=f.getOption("lineWrapping");var r=t&&f.defaultTextHeight()*1.5;var h=null,j=null;function m(i,u){if(h!=i.line){h=i.line;j=f.getLineHandle(h)}if(t&&j.height>r){return f.charCoords(i,"local")[u?"top":"bottom"]}var v=f.heightAtLine(j,"local");return v+(u?0:j.height)}if(f.display.barWidth){for(var p=0,q;p<d.length;p++){var c=d[p];var s=q||m(c.from,true)*o;var e=m(c.to,false)*o;while(p<d.length-1){q=m(d[p+1].from,true)*o;if(q>e+0.9){break}c=d[++p];e=m(c.to,false)*o}if(e==s){continue}var n=Math.max(e-s,3);var k=l.appendChild(document.createElement("div"));k.style.cssText="position: absolute; right: 0px; width: "+Math.max(f.display.barWidth-1,2)+"px; top: "+(s+this.buttonHeight)+"px; height: "+n+"px";k.className=this.options.className;if(c.id){k.setAttribute("annotation-id",c.id)}}}this.div.textContent="";this.div.appendChild(l)};a.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);if(this.changeHandler){this.cm.off("change",this.changeHandler)}this.div.parentNode.removeChild(this.div)}});