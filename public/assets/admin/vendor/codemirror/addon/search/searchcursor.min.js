(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(b){var c=b.Pos;function d(f,k,j,e){this.atOccurrence=false;this.doc=f;if(e==null&&typeof k=="string"){e=false}j=j?f.clipPos(j):c(0,0);this.pos={from:j,to:j};if(typeof k!="string"){if(!k.global){k=new RegExp(k.source,k.ignoreCase?"ig":"g")}this.matches=function(s,r){if(s){k.lastIndex=0;var n=f.getLine(r.line).slice(0,r.ch),m=0,o,t;for(;;){k.lastIndex=m;var q=k.exec(n);if(!q){break}o=q;t=o.index;m=o.index+(o[0].length||1);if(m==n.length){break}}var p=(o&&o[0].length)||0;if(!p){if(t==0&&n.length==0){o=undefined}else{if(t!=f.getLine(r.line).length){p++}}}}else{k.lastIndex=r.ch;var n=f.getLine(r.line),o=k.exec(n);var p=(o&&o[0].length)||0;var t=o&&o.index;if(t+p!=n.length&&!p){p=1}}if(o&&p){return{from:c(r.line,t),to:c(r.line,t+p),match:o}}}}else{var h=k;if(e){k=k.toLowerCase()}var g=e?function(m){return m.toLowerCase()}:function(m){return m};var l=k.split("\n");if(l.length==1){if(!k.length){this.matches=function(){}}else{this.matches=function(q,p){if(q){var o=f.getLine(p.line).slice(0,p.ch),m=g(o);var n=m.lastIndexOf(k);if(n>-1){n=a(o,m,n);return{from:c(p.line,n),to:c(p.line,n+h.length)}}}else{var o=f.getLine(p.line).slice(p.ch),m=g(o);var n=m.indexOf(k);if(n>-1){n=a(o,m,n)+p.ch;return{from:c(p.line,n),to:c(p.line,n+h.length)}}}}}}else{var i=h.split("\n");this.matches=function(t,s){var p=l.length-1;if(t){if(s.line-(l.length-1)<f.firstLine()){return}if(g(f.getLine(s.line).slice(0,i[p].length))!=l[l.length-1]){return}var u=c(s.line,i[p].length);for(var r=s.line-1,o=p-1;o>=1;--o,--r){if(l[o]!=g(f.getLine(r))){return}}var q=f.getLine(r),m=q.length-i[0].length;if(g(q.slice(m))!=l[0]){return}return{from:c(r,m),to:u}}else{if(s.line+(l.length-1)>f.lastLine()){return}var q=f.getLine(s.line),m=q.length-i[0].length;if(g(q.slice(m))!=l[0]){return}var n=c(s.line,m);for(var r=s.line+1,o=1;o<p;++o,++r){if(l[o]!=g(f.getLine(r))){return}}if(g(f.getLine(r).slice(0,i[p].length))!=l[p]){return}return{from:n,to:c(r,i[p].length)}}}}}}d.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(g){var i=this,f=this.doc.clipPos(g?this.pos.from:this.pos.to);function h(j){var k=c(j,0);i.pos={from:k,to:k};i.atOccurrence=false;return false}for(;;){if(this.pos=this.matches(g,f)){this.atOccurrence=true;return this.pos.match||true}if(g){if(!f.line){return h(0)}f=c(f.line-1,this.doc.getLine(f.line-1).length)}else{var e=this.doc.lineCount();if(f.line==e-1){return h(e)}f=c(f.line+1,0)}}},from:function(){if(this.atOccurrence){return this.pos.from}},to:function(){if(this.atOccurrence){return this.pos.to}},replace:function(f,g){if(!this.atOccurrence){return}var e=b.splitLines(f);this.doc.replaceRange(e,this.pos.from,this.pos.to,g);this.pos.to=c(this.pos.from.line+e.length-1,e[e.length-1].length+(e.length==1?this.pos.from.ch:0))}};function a(g,e,h){if(g.length==e.length){return h}for(var i=Math.min(h,g.length);;){var f=g.slice(0,i).toLowerCase().length;if(f<h){++i}else{if(f>h){--i}else{return i}}}}b.defineExtension("getSearchCursor",function(g,f,e){return new d(this.doc,g,f,e)});b.defineDocExtension("getSearchCursor",function(g,f,e){return new d(this,g,f,e)});b.defineExtension("selectMatches",function(g,e){var h=[];var f=this.getSearchCursor(g,this.getCursor("from"),e);while(f.findNext()){if(b.cmpPos(f.to(),this.getCursor("to"))>0){break}h.push({anchor:f.from(),head:f.to()})}if(h.length){this.setSelections(h,0)}})});