(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("./searchcursor"),require("../scroll/annotatescrollbar"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","./searchcursor","../scroll/annotatescrollbar"],a)}else{a(CodeMirror)}}})(function(a){a.defineExtension("showMatchesOnScrollbar",function(g,e,f){if(typeof f=="string"){f={className:f}}if(!f){f={}}return new d(this,g,e,f)});function d(g,j,f,h){this.cm=g;this.options=h;var e={listenForChanges:false};for(var i in h){e[i]=h[i]}if(!e.className){e.className="CodeMirror-search-match"}this.annotation=g.annotateScrollbar(e);this.query=j;this.caseFold=f;this.gap={from:g.firstLine(),to:g.lastLine()+1};this.matches=[];this.update=null;this.findMatches();this.annotation.update(this.matches);var k=this;g.on("change",this.changeHandler=function(l,m){k.onChange(m)})}var b=1000;d.prototype.findMatches=function(){if(!this.gap){return}for(var f=0;f<this.matches.length;f++){var g=this.matches[f];if(g.from.line>=this.gap.to){break}if(g.to.line>=this.gap.from){this.matches.splice(f--,1)}}var e=this.cm.getSearchCursor(this.query,a.Pos(this.gap.from,0),this.caseFold);var h=this.options&&this.options.maxMatches||b;while(e.findNext()){var g={from:e.from(),to:e.to()};if(g.from.line>=this.gap.to){break}this.matches.splice(f++,0,g);if(this.matches.length>h){break}}this.gap=null};function c(f,e,g){if(f<=e){return f}return Math.max(e,f+g)}d.prototype.onChange=function(e){var n=e.from.line;var f=a.changeEnd(e).line;var m=f-e.to.line;if(this.gap){this.gap.from=Math.min(c(this.gap.from,n,m),e.from.line);this.gap.to=Math.max(c(this.gap.to,n,m),e.from.line)}else{this.gap={from:e.from.line,to:f+1}}if(m){for(var g=0;g<this.matches.length;g++){var h=this.matches[g];var j=c(h.from.line,n,m);if(j!=h.from.line){h.from=a.Pos(j,h.from.ch)}var k=c(h.to.line,n,m);if(k!=h.to.line){h.to=a.Pos(k,h.to.ch)}}}clearTimeout(this.update);var l=this;this.update=setTimeout(function(){l.updateAfterChange()},250)};d.prototype.updateAfterChange=function(){this.findMatches();this.annotation.update(this.matches)};d.prototype.clear=function(){this.cm.off("change",this.changeHandler);this.annotation.clear()}});