(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(c){var f="CodeMirror-lint-markers";function p(u,t){var w=document.createElement("div");w.className="CodeMirror-lint-tooltip";w.appendChild(t.cloneNode(true));document.body.appendChild(w);function v(x){if(!w.parentNode){return c.off(document,"mousemove",v)}w.style.top=Math.max(0,x.clientY-w.offsetHeight-5)+"px";w.style.left=(x.clientX+5)+"px"}c.on(document,"mousemove",v);v(u);if(w.style.opacity!=null){w.style.opacity=1}return w}function o(t){if(t.parentNode){t.parentNode.removeChild(t)}}function g(t){if(!t.parentNode){return}if(t.style.opacity==null){o(t)}t.style.opacity=0;setTimeout(function(){o(t)},600)}function q(u,t,w){var y=p(u,t);function v(){c.off(w,"mouseout",v);if(y){g(y);y=null}}var x=setInterval(function(){if(y){for(var z=w;;z=z.parentNode){if(z&&z.nodeType==11){z=z.host}if(z==document.body){return}if(!z){v();break}}}if(!y){return clearInterval(x)}},400);c.on(w,"mouseout",v)}function i(t,v,u){this.marked=[];this.options=v;this.timeout=null;this.hasGutter=u;this.onMouseOver=function(w){l(t,w)};this.waitingFor=0}function m(t,u){if(u instanceof Function){return{getAnnotations:u}}if(!u||u===true){u={}}return u}function b(t){var v=t.state.lint;if(v.hasGutter){t.clearGutter(f)}for(var u=0;u<v.marked.length;++u){v.marked[u].clear()}v.marked.length=0}function j(u,x,w,y){var v=document.createElement("div"),t=v;v.className="CodeMirror-lint-marker-"+x;if(w){t=v.appendChild(document.createElement("div"));t.className="CodeMirror-lint-marker-multiple"}if(y!=false){c.on(t,"mouseover",function(z){q(z,u,t)})}return v}function d(t,u){if(t=="error"){return t}else{return u}}function e(u){var x=[];for(var v=0;v<u.length;++v){var t=u[v],w=t.from.line;(x[w]||(x[w]=[])).push(t)}return x}function a(t){var u=t.severity;if(!u){u="error"}var v=document.createElement("div");v.className="CodeMirror-lint-message-"+u;v.appendChild(document.createTextNode(t.message));return v}function h(u,v,x){var y=u.state.lint;var w=++y.waitingFor;function t(){w=-1;u.off("change",t)}u.on("change",t);v(u.getValue(),function(z,A){u.off("change",t);if(y.waitingFor!=w){return}if(A&&z instanceof c){z=A}s(u,z)},x,u)}function r(t){var x=t.state.lint,v=x.options;var w=v.options||v;var u=v.getAnnotations||t.getHelper(c.Pos(0,0),"lint");if(!u){return}if(v.async||u.async){h(t,u,w)}else{s(t,u(t.getValue(),w,t))}}function s(x,v){b(x);var D=x.state.lint,B=D.options;var u=e(v);for(var z=0;z<u.length;++z){var w=u[z];if(!w){continue}var A=null;var E=D.hasGutter&&document.createDocumentFragment();for(var y=0;y<w.length;++y){var t=w[y];var C=t.severity;if(!C){C="error"}A=d(A,C);if(B.formatAnnotation){t=B.formatAnnotation(t)}if(D.hasGutter){E.appendChild(a(t))}if(t.to){D.marked.push(x.markText(t.from,t.to,{className:"CodeMirror-lint-mark-"+C,__annotation:t}))}}if(D.hasGutter){x.setGutterMarker(z,f,j(E,A,w.length>1,D.options.tooltips))}}if(B.onUpdateLinting){B.onUpdateLinting(v,u,x)}}function k(t){var u=t.state.lint;if(!u){return}clearTimeout(u.timeout);u.timeout=setTimeout(function(){r(t)},u.options.delay||500)}function n(u,v){var x=v.target||v.srcElement;var y=document.createDocumentFragment();for(var w=0;w<u.length;w++){var t=u[w];y.appendChild(a(t))}q(v,y,x)}function l(w,z){var C=z.target||z.srcElement;if(!/\bCodeMirror-lint-mark-/.test(C.className)){return}var v=C.getBoundingClientRect(),D=(v.left+v.right)/2,E=(v.top+v.bottom)/2;var B=w.findMarksAt(w.coordsChar({left:D,top:E},"client"));var u=[];for(var A=0;A<B.length;++A){var t=B[A].__annotation;if(t){u.push(t)}}if(u.length){n(u,z)}}c.defineOption("lint",false,function(t,z,x){if(x&&x!=c.Init){b(t);if(t.state.lint.options.lintOnChange!==false){t.off("change",k)}c.off(t.getWrapperElement(),"mouseover",t.state.lint.onMouseOver);clearTimeout(t.state.lint.timeout);delete t.state.lint}if(z){var u=t.getOption("gutters"),v=false;for(var w=0;w<u.length;++w){if(u[w]==f){v=true}}var y=t.state.lint=new i(t,m(t,z),v);if(y.options.lintOnChange!==false){t.on("change",k)}if(y.options.tooltips!=false){c.on(t.getWrapperElement(),"mouseover",y.onMouseOver)}r(t)}});c.defineExtension("performLint",function(){if(this.state.lint){r(this)}})});