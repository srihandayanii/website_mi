(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../../mode/sql/sql"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../../mode/sql/sql"],a)}else{a(CodeMirror)}}})(function(d){var t;var f;var n;var e={QUERY_DIV:";",ALIAS_KEYWORD:"AS"};var r=d.Pos,c=d.cmpPos;function m(v){return Object.prototype.toString.call(v)=="[object Array]"}function i(v){var w=v.doc.modeOption;if(w==="sql"){w="text/x-sql"}return d.resolveMode(w).keywords}function k(v){return typeof v=="string"?v:v.text}function u(v,w){if(m(w)){w={columns:w}}if(!w.text){w.text=v}return w}function q(w){var z={};if(m(w)){for(var v=w.length-1;v>=0;v--){var x=w[v];z[k(x).toUpperCase()]=u(k(x),x)}}else{if(w){for(var y in w){z[y.toUpperCase()]=u(y,w[y])}}}return z}function j(v){return t[v.toUpperCase()]}function s(w){var x={};for(var v in w){if(w.hasOwnProperty(v)){x[v]=w[v]}}return x}function o(w,y){var v=w.length;var x=k(y).substr(0,v);return w.toUpperCase()===x.toUpperCase()}function a(x,y,B,v){if(m(B)){for(var w=0;w<B.length;w++){if(o(y,B[w])){x.push(v(B[w]))}}}else{for(var A in B){if(B.hasOwnProperty(A)){var z=B[A];if(!z||z===true){z=A}else{z=z.displayText?{text:z.text,displayText:z.displayText}:z.text}if(o(y,z)){x.push(v(z))}}}}}function b(v){if(v.charAt(0)=="."){v=v.substr(1)}return v.replace(/`/g,"")}function l(x){var y=k(x).split(".");for(var w=0;w<y.length;w++){y[w]="`"+y[w]+"`"}var v=y.join(".");if(typeof x=="string"){return v}x=s(x);x.text=v;return x}function p(z,H,D,A){var I=false;var B=[];var E=H.start;var y=true;while(y){y=(H.string.charAt(0)==".");I=I||(H.string.charAt(0)=="`");E=H.start;B.unshift(b(H.string));H=A.getTokenAt(r(z.line,H.start));if(H.string=="."){y=true;H=A.getTokenAt(r(z.line,H.start))}}var F=B.join(".");a(D,F,t,function(J){return I?l(J):J});a(D,F,f,function(J){return I?l(J):J});F=B.pop();var G=B.join(".");var v=false;var w=G;if(!j(G)){var C=G;G=h(G,A);if(G!==C){v=true}}var x=j(G);if(x&&x.columns){x=x.columns}if(x){a(D,F,x,function(K){var J=G;if(v==true){J=w}if(typeof K=="string"){K=J+"."+K}else{K=s(K);K.text=J+"."+K.text}return I?l(K):K})}return E}function g(y,w){if(!y){return}var v=/[,;]/g;var z=y.split(" ");for(var x=0;x<z.length;x++){w(z[x]?z[x].replace(v,""):"")}}function h(v,z){var y=z.doc;var A=y.getValue();var w=v.toUpperCase();var E="";var I="";var H=[];var J={start:r(0,0),end:r(z.lastLine(),z.getLineHandle(z.lastLine()).length)};var C=A.indexOf(e.QUERY_DIV);while(C!=-1){H.push(y.posFromIndex(C));C=A.indexOf(e.QUERY_DIV,C+1)}H.unshift(r(0,0));H.push(r(z.lastLine(),z.getLineHandle(z.lastLine()).text.length));var F=null;var x=z.getCursor();for(var B=0;B<H.length;B++){if((F==null||c(x,F)>0)&&c(x,H[B])<=0){J={start:F,end:H[B]};break}F=H[B]}var G=y.getRange(J.start,J.end,false);for(var B=0;B<G.length;B++){var D=G[B];g(D,function(K){var L=K.toUpperCase();if(L===w&&j(E)){I=E}if(L!==e.ALIAS_KEYWORD){E=K}});if(I){break}}return I}d.registerHelper("hint","sql",function(y,A){t=q(A&&A.tables);var w=A&&A.defaultTable;var x=A&&A.disableKeywords;f=w&&j(w);n=i(y);if(w&&!f){f=h(w,y)}f=f||[];if(f.columns){f=f.columns}var v=y.getCursor();var B=[];var E=y.getTokenAt(v),D,z,C;if(E.end>v.ch){E.end=v.ch;E.string=E.string.slice(0,v.ch-E.start)}if(E.string.match(/^[.`\w@]\w*$/)){C=E.string;D=E.start;z=E.end}else{D=z=v.ch;C=""}if(C.charAt(0)=="."||C.charAt(0)=="`"){D=p(v,E,B,y)}else{a(B,C,t,function(F){return F});a(B,C,f,function(F){return F});if(!x){a(B,C,n,function(F){return F.toUpperCase()})}}return{list:B,from:r(v.line,D),to:r(v.line,z)}})});