(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(e){var k="CodeMirror-hint";var a="CodeMirror-hint-active";e.showHint=function(q,r,t){if(!r){return q.showHint(t)}if(t&&t.async){r.async=true}var s={hint:r};if(t){for(var u in t){s[u]=t[u]}}return q.showHint(s)};e.defineExtension("showHint",function(s){s=m(this,this.getCursor("start"),s);var t=this.listSelections();if(t.length>1){return}if(this.somethingSelected()){if(!s.hint.supportsSelection){return}for(var r=0;r<t.length;r++){if(t[r].head.line!=t[r].anchor.line){return}}}if(this.state.completionActive){this.state.completionActive.close()}var q=this.state.completionActive=new f(this,s);if(!q.options.hint){return}e.signal(this,"startCompletion",this);q.update(true)});function f(q,r){this.cm=q;this.options=r;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var s=this;q.on("cursorActivity",this.activityFunc=function(){s.cursorActivity()})}var n=window.requestAnimationFrame||function(q){return setTimeout(q,1000/60)};var d=window.cancelAnimationFrame||clearTimeout;f.prototype={close:function(){if(!this.active()){return}this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data){e.signal(this.data,"close")}if(this.widget){this.widget.close()}e.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(r,s){var q=r.list[s];if(q.hint){q.hint(this.cm,r,q)}else{this.cm.replaceRange(j(q),q.from||r.from,q.to||r.to,"complete")}e.signal(r,"pick",q);this.close()},cursorActivity:function(){if(this.debounce){d(this.debounce);this.debounce=0}var r=this.cm.getCursor(),q=this.cm.getLine(r.line);if(r.line!=this.startPos.line||q.length-r.ch!=this.startLen-this.startPos.ch||r.ch<this.startPos.ch||this.cm.somethingSelected()||(r.ch&&this.options.closeCharacters.test(q.charAt(r.ch-1)))){this.close()}else{var s=this;this.debounce=n(function(){s.update()});if(this.widget){this.widget.disable()}}},update:function(q){if(this.tick==null){return}var s=this,r=++this.tick;h(this.options.hint,this.cm,this.options,function(t){if(s.tick==r){s.finishUpdate(t,q)}})},finishUpdate:function(q,r){if(this.data){e.signal(this.data,"update")}var s=(this.widget&&this.widget.picked)||(r&&this.options.completeSingle);if(this.widget){this.widget.close()}if(q&&this.data&&l(this.data,q)){return}this.data=q;if(q&&q.list.length){if(s&&q.list.length==1){this.pick(q,0)}else{this.widget=new p(this,q);e.signal(q,"shown")}}}};function l(s,r){var q=e.cmpPos(r.from,s.from);return q>0&&s.to.ch-s.from.ch!=r.to.ch-r.from.ch}function m(q,u,s){var r=q.options.hintOptions;var t={};for(var v in g){t[v]=g[v]}if(r){for(var v in r){if(r[v]!==undefined){t[v]=r[v]}}}if(s){for(var v in s){if(s[v]!==undefined){t[v]=s[v]}}}if(t.hint.resolve){t.hint=t.hint.resolve(q,u)}return t}function j(q){if(typeof q=="string"){return q}else{return q.text}}function c(s,v){var r={Up:function(){v.moveFocus(-1)},Down:function(){v.moveFocus(1)},PageUp:function(){v.moveFocus(-v.menuSize()+1,true)},PageDown:function(){v.moveFocus(v.menuSize()-1,true)},Home:function(){v.setFocus(0)},End:function(){v.setFocus(v.length-1)},Enter:v.pick,Tab:v.pick,Esc:v.close};var t=s.options.customKeys;var x=t?{}:r;function q(z,A){var y;if(typeof A!="string"){y=function(B){return A(B,v)}}else{if(r.hasOwnProperty(A)){y=r[A]}else{y=A}}x[z]=y}if(t){for(var w in t){if(t.hasOwnProperty(w)){q(w,t[w])}}}var u=s.options.extraKeys;if(u){for(var w in u){if(u.hasOwnProperty(w)){q(w,u[w])}}}return x}function i(r,q){while(q&&q!=r){if(q.nodeName.toUpperCase()==="LI"&&q.parentNode==r){return q}q=q.parentNode}}function p(v,A){this.completion=v;this.data=A;this.picked=false;var N=this,u=v.cm;var D=this.hints=document.createElement("ul");D.className="CodeMirror-hints";this.selectedHint=A.selectedHint||0;var w=A.list;for(var E=0;E<w.length;++E){var B=D.appendChild(document.createElement("li")),x=w[E];var s=k+(E!=this.selectedHint?"":" "+a);if(x.className!=null){s=x.className+" "+s}B.className=s;if(x.render){x.render(B,A,x)}else{B.appendChild(document.createTextNode(x.displayText||j(x)))}B.hintId=E}var J=u.cursorCoords(v.options.alignWithWord?A.from:null);var F=J.left,M=J.bottom,q=true;D.style.left=F+"px";D.style.top=M+"px";var P=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);var O=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(v.options.container||document.body).appendChild(D);var r=D.getBoundingClientRect(),I=r.bottom-O;var K=D.scrollHeight>D.clientHeight+1;var L=u.getScrollInfo();if(I>0){var C=r.bottom-r.top,z=J.top-(J.bottom-r.top);if(z-C>0){D.style.top=(M=J.top-C)+"px";q=false}else{if(C>O){D.style.height=(O-5)+"px";D.style.top=(M=J.bottom-r.top)+"px";var y=u.getCursor();if(A.from.ch!=y.ch){J=u.cursorCoords(y);D.style.left=(F=J.left)+"px";r=D.getBoundingClientRect()}}}}var H=r.right-P;if(H>0){if(r.right-r.left>P){D.style.width=(P-5)+"px";H-=(r.right-r.left)-P}D.style.left=(F=J.left-H)+"px"}if(K){for(var G=D.firstChild;G;G=G.nextSibling){G.style.paddingRight=u.display.nativeBarWidth+"px"}}u.addKeyMap(this.keyMap=c(v,{moveFocus:function(R,Q){N.changeActive(N.selectedHint+R,Q)},setFocus:function(Q){N.changeActive(Q)},menuSize:function(){return N.screenAmount()},length:w.length,close:function(){v.close()},pick:function(){N.pick()},data:A}));if(v.options.closeOnUnfocus){var t;u.on("blur",this.onBlur=function(){t=setTimeout(function(){v.close()},100)});u.on("focus",this.onFocus=function(){clearTimeout(t)})}u.on("scroll",this.onScroll=function(){var Q=u.getScrollInfo(),R=u.getWrapperElement().getBoundingClientRect();var S=M+L.top-Q.top;var T=S-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(!q){T+=D.offsetHeight}if(T<=R.top||T>=R.bottom){return v.close()}D.style.top=S+"px";D.style.left=(F+L.left-Q.left)+"px"});e.on(D,"dblclick",function(Q){var R=i(D,Q.target||Q.srcElement);if(R&&R.hintId!=null){N.changeActive(R.hintId);N.pick()}});e.on(D,"click",function(Q){var R=i(D,Q.target||Q.srcElement);if(R&&R.hintId!=null){N.changeActive(R.hintId);if(v.options.completeOnSingleClick){N.pick()}}});e.on(D,"mousedown",function(){setTimeout(function(){u.focus()},20)});e.signal(A,"select",w[0],D.firstChild);return true}p.prototype={close:function(){if(this.completion.widget!=this){return}this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var q=this.completion.cm;if(this.completion.options.closeOnUnfocus){q.off("blur",this.onBlur);q.off("focus",this.onFocus)}q.off("scroll",this.onScroll)},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var q=this;this.keyMap={Enter:function(){q.picked=true}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(r,q){if(r>=this.data.list.length){r=q?this.data.list.length-1:0}else{if(r<0){r=q?0:this.data.list.length-1}}if(this.selectedHint==r){return}var s=this.hints.childNodes[this.selectedHint];s.className=s.className.replace(" "+a,"");s=this.hints.childNodes[this.selectedHint=r];s.className+=" "+a;if(s.offsetTop<this.hints.scrollTop){this.hints.scrollTop=s.offsetTop-3}else{if(s.offsetTop+s.offsetHeight>this.hints.scrollTop+this.hints.clientHeight){this.hints.scrollTop=s.offsetTop+s.offsetHeight-this.hints.clientHeight+3}}e.signal(this.data,"select",this.data.list[this.selectedHint],s)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};function b(q,r){if(!q.somethingSelected()){return r}var t=[];for(var s=0;s<r.length;s++){if(r[s].supportsSelection){t.push(r[s])}}return t}function h(s,r,t,q){if(s.async){s(r,q,t)}else{var u=s(r,t);if(u&&u.then){u.then(q)}else{q(u)}}}function o(q,s){var r=q.getHelpers(s,"hint"),u;if(r.length){var t=function(x,w,y){var v=b(x,r);function z(A){if(A==v.length){return w(null)}h(v[A],x,y,function(B){if(B&&B.list.length>0){w(B)}else{z(A+1)}})}z(0)};t.async=true;t.supportsSelection=true;return t}else{if(u=q.getHelper(q.getCursor(),"hintWords")){return function(v){return e.hint.fromList(v,{words:u})}}else{if(e.hint.anyword){return function(v,w){return e.hint.anyword(v,w)}}else{return function(){}}}}}e.registerHelper("hint","auto",{resolve:o});e.registerHelper("hint","fromList",function(q,v){var r=q.getCursor(),y=q.getTokenAt(r);var x=e.Pos(r.line,y.end);if(y.string&&/\w/.test(y.string[y.string.length-1])){var w=y.string,t=e.Pos(r.line,y.start)}else{var w="",t=x}var s=[];for(var u=0;u<v.words.length;u++){var z=v.words[u];if(z.slice(0,w.length)==w){s.push(z)}}if(s.length){return{list:s,from:t,to:x}}});e.commands.autocomplete=e.showHint;var g={hint:e.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:true,container:null,customKeys:null,extraKeys:null};e.defineOption("hintOptions",null)});