(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(c){var e={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"};var q=c.Pos;c.defineOption("autoCloseBrackets",false,function(i,s,r){if(r&&r!=c.Init){i.removeKeyMap(p);i.state.closeBrackets=null}if(s){i.state.closeBrackets=s;i.addKeyMap(p)}});function h(i,r){if(r=="pairs"&&typeof i=="string"){return i}if(typeof i=="object"&&i[r]!=null){return i[r]}return e[r]}var a=e.pairs+"`";var p={Backspace:j,Enter:l};for(var n=0;n<a.length;n++){p["'"+a.charAt(n)+"'"]=m(a.charAt(n))}function m(i){return function(r){return k(r,i)}}function g(i){var r=i.state.closeBrackets;if(!r){return null}var s=i.getModeAt(i.getCursor());return s.closeBrackets||r}function j(s){var t=g(s);if(!t||s.getOption("disableInput")){return c.Pass}var w=h(t,"pairs");var x=s.listSelections();for(var v=0;v<x.length;v++){if(!x[v].empty()){return c.Pass}var r=b(s,x[v].head);if(!r||w.indexOf(r)%2!=0){return c.Pass}}for(var v=x.length-1;v>=0;v--){var u=x[v].head;s.replaceRange("",q(u.line,u.ch-1),q(u.line,u.ch+1),"+delete")}}function l(s){var t=g(s);var u=t&&h(t,"explode");if(!u||s.getOption("disableInput")){return c.Pass}var w=s.listSelections();for(var v=0;v<w.length;v++){if(!w[v].empty()){return c.Pass}var r=b(s,w[v].head);if(!r||u.indexOf(r)%2!=0){return c.Pass}}s.operation(function(){s.replaceSelection("\n\n",null);s.execCommand("goCharLeft");w=s.listSelections();for(var x=0;x<w.length;x++){var y=w[x].head.line;s.indentLine(y,null,true);s.indentLine(y+1,null,true)}})}function d(r){var i=c.cmpPos(r.anchor,r.head)>0;return{anchor:new q(r.anchor.line,r.anchor.ch+(i?-1:1)),head:new q(r.head.line,r.head.ch+(i?1:-1))}}function k(s,r){var t=g(s);if(!t||s.getOption("disableInput")){return c.Pass}var B=h(t,"pairs");var C=B.indexOf(r);if(C==-1){return c.Pass}var G=h(t,"triples");var x=B.charAt(C+1)==r;var E=s.listSelections();var A=C%2==0;var H;for(var w=0;w<E.length;w++){var D=E[w],u=D.head,v;var z=s.getRange(u,q(u.line,u.ch+1));if(A&&!D.empty()){v="surround"}else{if((x||!A)&&z==r){if(G.indexOf(r)>=0&&s.getRange(u,q(u.line,u.ch+3))==r+r+r){v="skipThree"}else{v="skip"}}else{if(x&&u.ch>1&&G.indexOf(r)>=0&&s.getRange(q(u.line,u.ch-2),u)==r+r&&(u.ch<=2||s.getRange(q(u.line,u.ch-3),q(u.line,u.ch-2))!=r)){v="addFour"}else{if(x){if(!c.isWordChar(z)&&f(s,u,r)){v="both"}else{return c.Pass}}else{if(A&&(s.getLine(u.line).length==u.ch||o(z,B)||/\s/.test(z))){v="both"}else{return c.Pass}}}}}if(!H){H=v}else{if(H!=v){return c.Pass}}}var y=C%2?B.charAt(C-1):r;var F=C%2?r:B.charAt(C+1);s.operation(function(){if(H=="skip"){s.execCommand("goCharRight")}else{if(H=="skipThree"){for(var I=0;I<3;I++){s.execCommand("goCharRight")}}else{if(H=="surround"){var J=s.getSelections();for(var I=0;I<J.length;I++){J[I]=y+J[I]+F}s.replaceSelections(J,"around");J=s.listSelections().slice();for(var I=0;I<J.length;I++){J[I]=d(J[I])}s.setSelections(J)}else{if(H=="both"){s.replaceSelection(y+F,null);s.triggerElectric(y+F);s.execCommand("goCharLeft")}else{if(H=="addFour"){s.replaceSelection(y+y+y+y,"before");s.execCommand("goCharRight")}}}}}})}function o(i,r){var s=r.lastIndexOf(i);return s>-1&&s%2==1}function b(i,r){var s=i.getRange(q(r.line,r.ch-1),q(r.line,r.ch+1));return s.length==2?s:null}function f(r,t,i){var s=r.getLine(t.line);var v=r.getTokenAt(t);if(/\bstring2?\b/.test(v.type)){return false}var u=new c.StringStream(s.slice(0,t.ch)+i+s.slice(t.ch),4);u.pos=u.start=v.start;for(;;){var w=r.getMode().token(u,v.state);if(u.pos>=t.ch+1){return/\bstring2?\b/.test(w)}u.start=u.pos}}});