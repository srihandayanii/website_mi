(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){var e=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var h=a.Pos;var g={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function d(j,s,q,k){var n=j.getLineHandle(s.line),p=s.ch-1;var o=(p>=0&&g[n.text.charAt(p)])||g[n.text.charAt(++p)];if(!o){return null}var l=o.charAt(1)==">"?1:-1;if(q&&(l>0)!=(p==s.ch)){return null}var r=j.getTokenTypeAt(h(s.line,p+1));var m=i(j,h(s.line,p+(l>0?1:0)),l,r||null,k);if(m==null){return null}return{from:h(s.line,p),to:m&&m.pos,match:m&&m.ch==o.charAt(0),forward:l>0}}function i(k,y,m,x,l){var s=(l&&l.maxScanLineLength)||10000;var t=(l&&l.maxScanLines)||1000;var w=[];var v=l&&l.bracketRegex?l.bracketRegex:/[(){}[\]]/;var p=m>0?Math.min(y.line+t,k.lastLine()+1):Math.max(k.firstLine()-1,y.line-t);for(var q=y.line;q!=p;q+=m){var o=k.getLine(q);if(!o){continue}var u=m>0?0:o.length-1,n=m>0?o.length:-1;if(o.length>s){continue}if(q==y.line){u=y.ch-(m<0?1:0)}for(;u!=n;u+=m){var j=o.charAt(u);if(v.test(j)&&(x===undefined||k.getTokenTypeAt(h(q,u+1))==x)){var r=g[j];if((r.charAt(1)==">")==(m>0)){w.push(j)}else{if(!w.length){return{pos:h(q,u),ch:j}}else{w.pop()}}}}}return q-m==(m>0?k.lastLine():k.firstLine())?false:null}function f(l,j,m){var q=l.state.matchBrackets.maxHighlightLineLength||1000;var o=[],r=l.listSelections();for(var n=0;n<r.length;n++){var p=r[n].empty()&&d(l,r[n].head,false,m);if(p&&l.getLine(p.from.line).length<=q){var s=p.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";o.push(l.markText(p.from,h(p.from.line,p.from.ch+1),{className:s}));if(p.to&&l.getLine(p.to.line).length<=q){o.push(l.markText(p.to,h(p.to.line,p.to.ch+1),{className:s}))}}}if(o.length){if(e&&l.state.focused){l.focus()}var k=function(){l.operation(function(){for(var t=0;t<o.length;t++){o[t].clear()}})};if(j){setTimeout(k,800)}else{return k}}}var b=null;function c(j){j.operation(function(){if(b){b();b=null}b=f(j,false,j.state.matchBrackets)})}a.defineOption("matchBrackets",false,function(j,l,k){if(k&&k!=a.Init){j.off("cursorActivity",c);if(b){b();b=null}}if(l){j.state.matchBrackets=typeof l=="object"?l:{};j.on("cursorActivity",c)}});a.defineExtension("matchBrackets",function(){f(this,true)});a.defineExtension("findMatchingBracket",function(k,l,j){return d(this,k,l,j)});a.defineExtension("scanForBracket",function(l,k,m,j){return i(this,l,k,m,j)})});