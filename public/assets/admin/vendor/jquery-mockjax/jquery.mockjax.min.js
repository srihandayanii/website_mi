/* jQuery Mockjax
 * A Plugin providing simple and flexible mocking of ajax requests and responses
 * 
 * Version: 2.2.0
 * Home: https://github.com/jakerella/jquery-mockjax
 * Copyright (c) 2016 Jordan Kasper, formerly appendTo;
 * NOTE: This repository was taken over by Jordan Kasper (@jakerella) October, 2014
 * 
 * Dual licensed under the MIT or GPL licenses.
 * http://opensource.org/licenses/MIT OR http://www.gnu.org/licenses/gpl-2.0.html
 */
(function(b,a){if(typeof define==="function"&&define.amd&&define.amd.jQuery){define(["jquery"],function(c){return a(c,b)})}else{if(typeof exports==="object"){module.exports=a}else{return a(b.jQuery||b.$,b)}}}(this,function(a,C){var b=a.ajax,v=[],u=[],B=[],d=/=\?(&|$)/,p=(new Date()).getTime(),i=500;function x(H){if(C.DOMParser===undefined&&C.ActiveXObject){C.DOMParser=function(){};DOMParser.prototype.parseFromString=function(K){var J=new ActiveXObject("Microsoft.XMLDOM");J.async="false";J.loadXML(K);return J}}try{var I=(new DOMParser()).parseFromString(H,"text/xml");if(a.isXMLDoc(I)){var F=a("parsererror",I);if(F.length===1){throw new Error("Error: "+a(I).text())}}else{throw new Error("Unable to parse XML")}return I}catch(E){var G=(E.name===undefined?E:E.name+": "+E.message);a(document).trigger("xmlParseError",[G]);return undefined}}function n(G,F){s.debug(G,["Checking mock data against request data",G,F]);var E=true;if(a.isFunction(G)){return !!G(F)}if(typeof F==="string"){if(a.isFunction(G.test)){return G.test(F)}else{if(typeof G==="object"){F=k(F)}else{return G===F}}}a.each(G,function(H){if(F[H]===undefined){E=false;return E}else{if(typeof F[H]==="object"&&F[H]!==null){if(E&&a.isArray(F[H])){E=a.isArray(G[H])&&F[H].length===G[H].length}E=E&&n(G[H],F[H])}else{if(G[H]&&a.isFunction(G[H].test)){E=E&&G[H].test(F[H])}else{E=E&&(G[H]===F[H])}}}});return E}function k(K){var F,G,H,L,J={},I=String(K).split(/&/);for(F=0,G=I.length;F<G;++F){H=I[F];try{H=decodeURIComponent(H.replace(/\+/g," "));H=H.split(/=/)}catch(E){continue}if(J[H[0]]){if(!J[H[0]].splice){L=J[H[0]];J[H[0]]=[];J[H[0]].push(L)}J[H[0]].push(H[1])}else{J[H[0]]=H[1]}}s.debug(null,["Getting query params from string",K,J]);return J}function m(E,F){return E[F]===a.mockjaxSettings[F]}function j(E,I){if(a.isFunction(E)){return E(I)}if(a.isFunction(E.url.test)){if(!E.url.test(I.url)){return null}}else{var G=E.namespace||a.mockjaxSettings.namespace;if(!!G){var H=[G,E.url].join("/");H=H.replace(/(\/+)/g,"/");E.url=H}var J=E.url.indexOf("*");if(E.url!==I.url&&J===-1||!new RegExp(E.url.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".+")).test(I.url)){return null}}if(E.requestHeaders){if(I.headers===undefined){return null}else{var F=false;a.each(E.requestHeaders,function(K,M){var L=I.headers[K];if(L!==M){F=true;return false}});if(F){return null}}}if(E.data){if(!I.data||!n(E.data,I.data)){return null}}if(E&&E.type&&E.type.toLowerCase()!==I.type.toLowerCase()){return null}return E}function o(E){return typeof E==="number"&&E>=0}function w(G){if(a.isArray(G)&&G.length===2){var F=G[0];var E=G[1];if(o(F)&&o(E)){return Math.floor(Math.random()*(E-F))+F}}else{if(o(G)){return G}}return i}function c(E,H,F){s.debug(E,["Sending fake XHR request",E,H,F]);var G=(function(I){return function(){return(function(){this.status=E.status;this.statusText=E.statusText;this.readyState=1;var J=function(){this.readyState=4;var K;if(H.dataType==="json"&&(typeof E.responseText==="object")){this.responseText=JSON.stringify(E.responseText)}else{if(H.dataType==="xml"){if(typeof E.responseXML==="string"){this.responseXML=x(E.responseXML);this.responseText=E.responseXML}else{this.responseXML=E.responseXML}}else{if(typeof E.responseText==="object"&&E.responseText!==null){E.contentType="application/json";this.responseText=JSON.stringify(E.responseText)}else{this.responseText=E.responseText}}}if(typeof E.status==="number"||typeof E.status==="string"){this.status=E.status}if(typeof E.statusText==="string"){this.statusText=E.statusText}K=this.onload||this.onreadystatechange;if(a.isFunction(K)){if(E.isTimeout){this.status=-1}K.call(this,E.isTimeout?"timeout":undefined)}else{if(E.isTimeout){this.status=-1}}};if(a.isFunction(E.response)){if(E.response.length===2){E.response(F,function(){J.call(I)});return}else{E.response(F)}}J.call(I)}).apply(I)}})(this);if(E.proxy){s.info(E,["Retrieving proxy file: "+E.proxy,E]);b({global:false,url:E.proxy,type:E.proxyType,data:E.data,async:H.async,dataType:H.dataType==="script"?"text/plain":H.dataType,complete:function(I){E.responseXML=E.responseText=I.responseText;if(m(E,"status")){E.status=I.status}if(m(E,"statusText")){E.statusText=I.statusText}if(H.async===false){G()}else{this.responseTimer=setTimeout(G,w(E.responseTime))}}})}else{if(H.async===false){G()}else{this.responseTimer=setTimeout(G,w(E.responseTime))}}}function D(E,H,G,F){s.debug(E,["Creating new mock XHR object",E,H,G,F]);E=a.extend(true,{},a.mockjaxSettings,E);if(typeof E.headers==="undefined"){E.headers={}}if(typeof H.headers==="undefined"){H.headers={}}if(E.contentType){E.headers["content-type"]=E.contentType}return{status:E.status,statusText:E.statusText,readyState:1,open:function(){},send:function(){F.fired=true;c.call(this,E,H,G)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(I,J){H.headers[I]=J},getResponseHeader:function(I){if(E.headers&&E.headers[I]){return E.headers[I]}else{if(I.toLowerCase()==="last-modified"){return E.lastModified||(new Date()).toString()}else{if(I.toLowerCase()==="etag"){return E.etag||""}else{if(I.toLowerCase()==="content-type"){return E.contentType||"text/plain"}}}}},getAllResponseHeaders:function(){var I="";if(E.contentType){E.headers["Content-Type"]=E.contentType}a.each(E.headers,function(J,K){I+=J+": "+K+"\n"});return I}}}function y(J,E,G){A(J);J.dataType="json";if(J.data&&d.test(J.data)||d.test(J.url)){h(J,E,G);var K=/^(\w+:)?\/\/([^\/?#]+)/,H=K.exec(J.url),I=H&&(H[1]&&H[1]!==location.protocol||H[2]!==location.host);J.dataType="script";if(J.type.toUpperCase()==="GET"&&I){var F=z(J,E,G);if(F){return F}else{return true}}}return null}function A(E){if(E.type.toUpperCase()==="GET"){if(!d.test(E.url)){E.url+=(/\?/.test(E.url)?"&":"?")+(E.jsonp||"callback")+"=?"}}else{if(!E.data||!d.test(E.data)){E.data=(E.data?E.data+"&":"")+(E.jsonp||"callback")+"=?"}}}function z(I,F,H){s.debug(F,["Performing JSONP request",F,I,H]);var E=H&&H.context||I,G=(a.Deferred)?(new a.Deferred()):null;if(F.response&&a.isFunction(F.response)){F.response(H)}else{if(typeof F.responseText==="object"){a.globalEval("("+JSON.stringify(F.responseText)+")")}else{if(F.proxy){s.info(F,["Performing JSONP proxy request: "+F.proxy,F]);b({global:false,url:F.proxy,type:F.proxyType,data:F.data,dataType:I.dataType==="script"?"text/plain":I.dataType,complete:function(J){a.globalEval("("+J.responseText+")");f(I,F,E,G)}});return G}else{a.globalEval("("+((typeof F.responseText==="string")?('"'+F.responseText+'"'):F.responseText)+")")}}}f(I,F,E,G);return G}function f(I,G,E,H){var F;setTimeout(function(){r(I,E,G);q(I,E);if(H){try{F=a.parseJSON(G.responseText)}catch(J){}H.resolveWith(E,[F||G.responseText]);s.log(G,["JSONP mock call complete",G,H])}},w(G.responseTime))}function h(I,G,H){var E=H&&H.context||I;var F=(typeof I.jsonpCallback==="string"&&I.jsonpCallback)||("jsonp"+p++);if(I.data){I.data=(I.data+"").replace(d,"="+F+"$1")}I.url=I.url.replace(d,"="+F+"$1");C[F]=C[F]||function(){r(I,E,G);q(I,E);C[F]=undefined;try{delete C[F]}catch(J){}};I.jsonpCallback=F}function r(G,E,F){if(G.success){G.success.call(E,F.responseText||"","success",{})}if(G.global){(G.context?a(G.context):a.event).trigger("ajaxSuccess",[{},G])}}function q(F,E){if(F.complete){F.complete.call(E,{statusText:"success",status:200},"success")}if(F.global){(F.context?a(F.context):a.event).trigger("ajaxComplete",[{},F])}if(F.global&&!--a.active){a.event.trigger("ajaxStop")}}function l(K,H){var G,J,F,I;s.debug(null,["Ajax call intercepted",K,H]);if(typeof K==="object"){H=K;K=undefined}else{H=H||{};H.url=K||H.url}J=a.ajaxSetup({},H);J.type=J.method=J.method||J.type;I=function(L,M){var N=H[L.toLowerCase()];return function(){if(a.isFunction(N)){N.apply(this,[].slice.call(arguments))}M["onAfter"+L]()}};for(var E=0;E<v.length;E++){if(!v[E]){continue}F=j(v[E],J);if(!F){s.debug(v[E],["Mock does not match request",K,J]);continue}if(a.mockjaxSettings.retainAjaxCalls){u.push(J)}s.info(F,["MOCK "+J.type.toUpperCase()+": "+J.url,a.ajaxSetup({},J)]);if(J.dataType&&J.dataType.toUpperCase()==="JSONP"){if((G=y(J,F,H))){return G}}H.crossDomain=false;F.cache=J.cache;F.timeout=J.timeout;F.global=J.global;if(F.isTimeout){if(F.responseTime>1){H.timeout=F.responseTime-1}else{F.responseTime=2;H.timeout=1}}if(a.isFunction(F.onAfterSuccess)){H.success=I("Success",F)}if(a.isFunction(F.onAfterError)){H.error=I("Error",F)}if(a.isFunction(F.onAfterComplete)){H.complete=I("Complete",F)}g(F,H);(function(L,O,N,M){G=b.call(a,a.extend(true,{},N,{xhr:function(){return D(L,O,N,M)}}))})(F,J,H,v[E]);return G}s.log(null,["No mock matched to request",K,H]);if(a.mockjaxSettings.retainAjaxCalls){B.push(H)}if(a.mockjaxSettings.throwUnmocked===true){throw new Error("AJAX not mocked: "+H.url)}else{return b.apply(a,[H])}}function g(J,K){if(!(J.url instanceof RegExp)){return}if(!J.hasOwnProperty("urlParams")){return}var E=J.url.exec(K.url);if(E.length===1){return}E.shift();var G=0,F=E.length,L=J.urlParams.length,I=Math.min(F,L),M={};for(G;G<I;G++){var H=J.urlParams[G];M[H]=E[G]}K.urlParams=M}function e(J){var F,G,E,I=[],H=J instanceof RegExp?function(K){return J.test(K)}:function(K){return J===K};for(F=0,G=v.length;F<G;F++){E=v[F];if(!H(E.url)){I.push(E)}else{s.log(E,["Clearing mock: "+(E&&E.url),E])}}return I}a.extend({ajax:l});var s={_log:function s(H,E,F){var G=a.mockjaxSettings.logging;if(H&&typeof H.logging!=="undefined"){G=H.logging}F=(F===0)?F:(F||t.LOG);E=(E.splice)?E:[E];if(G===false||G<F){return}if(a.mockjaxSettings.log){return a.mockjaxSettings.log(H,E[1]||E[0])}else{if(a.mockjaxSettings.logger&&a.mockjaxSettings.logger[a.mockjaxSettings.logLevelMethods[F]]){return a.mockjaxSettings.logger[a.mockjaxSettings.logLevelMethods[F]].apply(a.mockjaxSettings.logger,E)}}},debug:function(F,E){return s._log(F,E,t.DEBUG)},log:function(F,E){return s._log(F,E,t.LOG)},info:function(F,E){return s._log(F,E,t.INFO)},warn:function(F,E){return s._log(F,E,t.WARN)},error:function(F,E){return s._log(F,E,t.ERROR)}};var t={DEBUG:4,LOG:3,INFO:2,WARN:1,ERROR:0};a.mockjaxSettings={log:null,logger:C.console,logging:2,logLevelMethods:["error","warn","info","log","debug"],namespace:null,status:200,statusText:"OK",responseTime:i,isTimeout:false,throwUnmocked:false,retainAjaxCalls:true,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}};a.mockjax=function(F){if(a.isArray(F)){return a.map(F,function(G){return a.mockjax(G)})}var E=v.length;v[E]=F;s.log(F,["Created new mock handler",F]);return E};a.mockjax._logger=s;a.mockjax.clear=function(E){if(typeof E==="string"||E instanceof RegExp){v=e(E)}else{if(E||E===0){s.log(v[E],["Clearing mock: "+(v[E]&&v[E].url),v[E]]);v[E]=null}else{s.log(null,"Clearing all mocks");v=[]}}u=[];B=[]};a.mockjax.clearRetainedAjaxCalls=function(){u=[];B=[];s.debug(null,"Cleared retained ajax calls")};a.mockjax.handler=function(E){if(arguments.length===1){return v[E]}};a.mockjax.mockedAjaxCalls=function(){return u};a.mockjax.unfiredHandlers=function(){var H=[];for(var F=0,G=v.length;F<G;F++){var E=v[F];if(E!==null&&!E.fired){H.push(E)}}return H};a.mockjax.unmockedAjaxCalls=function(){return B};return a.mockjax}));