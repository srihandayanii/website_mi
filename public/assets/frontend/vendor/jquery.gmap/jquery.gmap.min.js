(function(a){a.fn.gMap=function(c,b){switch(c){case"addMarker":return a(this).trigger("gMap.addMarker",[b.latitude,b.longitude,b.content,b.icon,b.popup]);case"centerAt":return a(this).trigger("gMap.centerAt",[b.latitude,b.longitude,b.zoom]);case"clearMarkers":return a(this).trigger("gMap.clearMarkers")}var d=a.extend({},a.fn.gMap.defaults,c);return this.each(function(){var f=new google.maps.Map(this);a(this).data("gMap.reference",f);var e=new google.maps.Geocoder();if(d.address){e.geocode({address:d.address},function(j,r){if(j&&j.length){f.setCenter(j[0].geometry.location)}})}else{if(d.latitude&&d.longitude){f.setCenter(new google.maps.LatLng(d.latitude,d.longitude))}else{if(a.isArray(d.markers)&&d.markers.length>0){if(d.markers[0].address){e.geocode({address:d.markers[0].address},function(j,r){if(j&&j.length>0){f.setCenter(j[0].geometry.location)}})}else{f.setCenter(new google.maps.LatLng(d.markers[0].latitude,d.markers[0].longitude))}}else{f.setCenter(new google.maps.LatLng(34.885931,9.84375))}}}f.setZoom(d.zoom);f.setMapTypeId(google.maps.MapTypeId[d.maptype]);var l={scrollwheel:d.scrollwheel,disableDoubleClickZoom:!d.doubleclickzoom};if(d.controls===false){a.extend(l,{disableDefaultUI:true})}else{if(d.controls.length!==0){a.extend(l,d.controls,{disableDefaultUI:true})}}f.setOptions(l);var h=new google.maps.Marker();var n;var o;n=new google.maps.MarkerImage(d.icon.image);n.size=new google.maps.Size(d.icon.iconsize[0],d.icon.iconsize[1]);n.anchor=new google.maps.Point(d.icon.iconanchor[0],d.icon.iconanchor[1]);h.setIcon(n);if(d.icon.shadow){o=new google.maps.MarkerImage(d.icon.shadow);o.size=new google.maps.Size(d.icon.shadowsize[0],d.icon.shadowsize[1]);o.anchor=new google.maps.Point(d.icon.shadowanchor[0],d.icon.shadowanchor[1]);h.setShadow(o)}a(this).bind("gMap.centerAt",function(j,r,s,t){if(t){f.setZoom(t)}f.panTo(new google.maps.LatLng(parseFloat(r),parseFloat(s)))});var p=[];a(this).bind("gMap.clearMarkers",function(){while(p[0]){p.pop().setMap(null)}});var k;a(this).bind("gMap.addMarker",function(r,w,x,j,u,A){var y;var z;var s=new google.maps.LatLng(parseFloat(w),parseFloat(x));var t=new google.maps.Marker({position:s});if(u){y=new google.maps.MarkerImage(u.image);y.size=new google.maps.Size(u.iconsize[0],u.iconsize[1]);y.anchor=new google.maps.Point(u.iconanchor[0],u.iconanchor[1]);t.setIcon(y);if(u.shadow){z=new google.maps.MarkerImage(u.shadow);z.size=new google.maps.Size(u.shadowsize[0],u.shadowsize[1]);z.anchor=new google.maps.Point(u.shadowanchor[0],u.shadowanchor[1]);h.setShadow(z)}}else{t.setIcon(h.getIcon());t.setShadow(h.getShadow())}if(j){if(j==="_latlng"){j=w+", "+x}var v=new google.maps.InfoWindow({content:d.html_prepend+j+d.html_append});google.maps.event.addListener(t,"click",function(){if(k){k.close()}v.open(f,t);k=v});if(A){google.maps.event.addListenerOnce(f,"tilesloaded",function(){v.open(f,t)})}}t.setMap(f);p.push(t)});var m;var q=this;var g=function(j){return function(r,s){if(r&&r.length>0){a(q).trigger("gMap.addMarker",[r[0].geometry.location.lat(),r[0].geometry.location.lng(),j.html,j.icon,j.popup])}}};for(var i=0;i<d.markers.length;i++){m=d.markers[i];if(m.address){if(m.html==="_address"){m.html=m.address}e.geocode({address:m.address},g(m))}else{a(this).trigger("gMap.addMarker",[m.latitude,m.longitude,m.html,m.icon,m.popup])}}})};a.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:false,doubleclickzoom:true,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}})(jQuery);